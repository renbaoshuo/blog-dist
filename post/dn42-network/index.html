<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"><meta charset="utf-8"><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="宝硕博客"><meta property="og:site_name" content="宝硕博客"><meta name="twitter:site" content="@renbaoshuo"><meta name="twitter:creator" content="@renbaoshuo"><title>初探 DN42 网络 - 宝硕博客</title><meta name="description" content="DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 BGP 网络。DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。"><meta property="og:description" content="DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 BGP 网络。DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。"><meta name="keywords" content="[object Object],[object Object]"><meta property="og:type" content="article"><meta property="og:title" content="初探 DN42 网络 - 宝硕博客"><meta property="og:url" content="/post/dn42-network/"><meta property="og:image" content="https://s1.baoshuo.ren/2021/04/03/R6IHLundNjpKxCD.png"><link rel="canonical" href="/post/dn42-network/"><meta name="twitter:card" content="summary_large_image"><meta name="next-head-count" content="16"><meta name="darkreader" content="disabled"><meta name="generator" content="Hexo 6.2.0"><script defer="" src="https://cdnjs.baoshuo.ren/ajax/libs/react/18.2.0/umd/react.production.min.js" crossorigin=""></script><script defer="" src="https://cdnjs.baoshuo.ren/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js" crossorigin=""></script><script defer="" nomodule="" src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/webpack-54fb4613fe17423e.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/framework-d9a53f0451e3b9af.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/main-c7b17abe470ec1b3.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/pages/_app-6ef496121349a883.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/193-db40c5e347ef5200.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/chunks/pages/post/%5Bslug%5D-23300ff5966a3c77.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/ZHps7nekETP2dTZivX4rd/_buildManifest.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/ZHps7nekETP2dTZivX4rd/_ssgManifest.js" defer=""></script><script src="https://static.cdn.baoshuo.ren/blog/_next/static/ZHps7nekETP2dTZivX4rd/_middlewareManifest.js" defer=""></script><style>.eDssNQ{pointer-events:none}.gZmUMJ{height:2px}.hJfaYF{z-index:200}.dJcTkO{box-shadow:0 0 10px var(--c-a),0 0 10px var(--c-a)}.gOeSjL{opacity:1}.fxkyut{transition:all .25s ease-in-out}.kaWzRu{transform:rotate(3deg) translateY(-4px)}.ktTKqx{width:5%}.cdfZWI:before{box-shadow:inset 0 0 32px}.zJreD:before{height:3px}.iSSyDr:before{left:1.5px}.jORRks:before{top:14px}.beaHbQ:before{width:3px}.haKUHj:after{box-sizing:border-box}.feNfPp:after{transform:translate(-50%,-50%)}.qMJeO:after{box-shadow:inset 0 0 0 2px,0 0 0 2px}.dUAgBC:after{height:27.5px}.hVfwnH:after{left:0}.jtnuen:after{top:100%}.iibzBM:after{width:27.5px}.bLLutt:before{height:.8em}.kUNXjX:before{transform:translate(0) rotate(45deg)}.kBZpXt:before{width:.8em}.kCTVgr:after{top:80%}.cDbGzW:after{left:80%}.eHPmEw:after{transform:translate(-50%,-50%) rotate(45deg)}.dmfenB:after{width:.5em}.kAVdUc{font-size:16px}.jLmWnd:before{height:100%}.jYPXoJ:before{top:0}.kKTZiz:before{left:0}.elJZFC:after{height:14px}.eLXBUo:after{width:7px}.ebtDcN:after{top:1px}.caItCN{height:2rem}.jYEAGD{align-items:stretch}.gKQCBv:after{content:"·"}.jbBqfU:before{transform:translate(-50%,-25%) rotate(45deg)}.dhOkuk:before{box-sizing:border-box}.jFCJJY:before{box-shadow:0 -.35em,0 .35em}.iqzSxf:before{transform:translate(-50%,-50%)}.bQvqKh:before{width:100%}.sKExc{right:1rem}.bjOGUo{bottom:1rem}.eSaSrN{contain:layout}.egGyMq{line-height:1}.IVbXa{justify-content:center}.bcjLCN{flex-grow:0}.WhAZY{top:0}.gdPTUr{height:100%}.dYbGIK{flex-grow:0}.bOjOhu{left:0}.ipEZTh{width:95%}.eRVtDl{max-width:var(--w)}.kKplrA{contain:content}.gifdxR{font-size:1.25rem}.laXLGQ{color:var(--c)}.kooHYa{text-align:center}.moyUB{color:#fff}.eAOGpx{user-select:none}.bLHLvQ{text-indent:-9999px}.jXmXEB{height:1em}.hHGIsI{width:1em}.jbzBdl:before{transform:translate(-25%,-50%) rotate(-45deg)}.fIXfpL:before{width:.65em}.ergVCo:before{height:.65em}.cqyuit:before{top:50%}.hCTuXM:before{left:50%}.gvwkfp{font-size:.9em}.bRNbBj{font-weight:500}.fPWmiY{justify-content:flex-start}.hmKFEM{text-align:left}.dQPgRK{flex-grow:1}.fXzCvR{justify-content:flex-end}.klEWBS{text-align:right}.foGVKH{align-items:center}.fygwnR{box-sizing:border-box}.kQBRAp{display:block}.iMyxuR:after{display:block}.bbRNPO:after{left:1px}.imhmwA{position:fixed}.dPAasc{box-shadow:var(--s)}.jqaXfP{z-index:100}.iVncgA::-webkit-scrollbar{height:var(--s-x)}.fQhDyl::-webkit-scrollbar{width:var(--s-y)}.bBVwIW{letter-spacing:1px}.jsvbrX{cursor:pointer}.kroOag{font-size:.9rem}.bEvNbr{position:absolute}.eLDTYY{vertical-align:middle}.iRjWhb{font-size:.925rem}.QcCvg{height:12.25em}.jdKAzd{width:12.25em}.krZeLX{right:-30px}.gjJDYK{top:-40px}.dZDNG{opacity:.1}.julXB:before{content:""}.kvHVCE:before{position:absolute}.fQfkux:before{height:3.75em}.dPenaT:before{width:3.75em}.NpaJd:before{left:1.5625em}.jgAayQ:before{top:3em}.fqXcHQ:after{content:""}.dyMCpl:after{position:absolute}.chpxwD:after{height:3.75em}.beuMzX:after{width:3.75em}.dbtvqd:after{right:1.5625em}.jPcnDC:after{top:3em}.bpQkXn{font-weight:700}.gcQrEv{font-size:.9em}.iMkoWi{flex-direction:column}.chVqDG{font-size:.8em}.fyuAJJ{color:inherit}.jYagCu{max-height:400px}.gWinOH{object-fit:cover}.cypeLb{font-size:1.75rem}.VFfNK{letter-spacing:.75px}.dgIPcR{color:var(--c-m)}.cjScYX{position:relative}.cRUUAa{width:100%}.gSBWlu{display:flex}.kJzccJ{justify-content:space-between}.cpOcAb{display:inline-block}.kpaoc{color:var(--c-s)}.kOZsAO{word-break:keep-all}.jBtqwC{background-color:var(--c-a)}.cTiRpf:after{border-top-left-radius:100px}.kLOwRz:after{border-top-right-radius:100px}.fEOdlm:after{border-bottom-right-radius:100px}.iiCJgG:after{border-bottom-left-radius:100px}.gbJvTx:before{border-top-left-radius:100px}.eqcbDJ:before{border-top-right-radius:100px}.efWRhG:before{border-bottom-right-radius:100px}.ciQIPM:before{border-bottom-left-radius:100px}.jVKJhP:before{border-top-left-radius:1000px}.qOQRo:before{border-top-right-radius:1000px}.ftrJDm:before{border-bottom-right-radius:1000px}.dnkCBy:before{border-bottom-left-radius:1000px}.eCTYLu:after{overflow-x:hidden}.fPEpYf:after{overflow-y:hidden}.fSuxSX:after{border-top-left-radius:1000px}.diZuuN:after{border-bottom-left-radius:1000px}.ihNVbP{flex-basis:0}.KqcXP{background-color:transparent}.eIJBjz{padding-right:.7rem}.hcJOFn{padding-left:.7rem}.iawFZL{margin-right:.4rem}.kswRdL{margin-left:.4rem}.eGElBa{padding-top:2.5rem}.eBrwtd{padding-bottom:4rem}.edKxdA{padding-top:.9rem}.osxXp{padding-right:.9rem}.foquGP{padding-bottom:.9rem}.lhTVEC{padding-left:.9rem}.eQmaZO{padding-top:.6rem}.dZrGlq{padding-bottom:.6rem}.gCwvuy{background-color:var(--g-m)}.dvivnl{overflow-x:auto}.jSOKOm{text-decoration-line:inherit}.bKjKUN{padding-top:.75rem}.jdraHW{margin-right:auto}.eqrBPF{margin-left:auto}.lexxaO{background-color:#946ce6}.ebVilo{border-top-left-radius:.25rem}.kyhYEz{border-top-right-radius:.25rem}.jIkFRm{border-bottom-right-radius:.25rem}.gpptow{border-bottom-left-radius:.25rem}.kMKXDC{padding-top:.25rem}.ftIldC{padding-right:1rem}.jOeduE{padding-bottom:.25rem}.iDuqPI{padding-left:1rem}.kUPESX{margin-left:.5rem}.eKlQYW{flex-shrink:1}.bLlOeF{flex-basis:50%}.hwgZgR:after{background-color:currentColor}.bcfNhz{background-color:var(--g-b)}.kRQsoY{border-top-left-radius:var(--r)}.jBvrhX{border-top-right-radius:var(--r)}.dgtTIu{border-bottom-right-radius:var(--r)}.eXJtsk{border-bottom-left-radius:var(--r)}.llUCyD{overflow-y:auto}.qlVwF::-webkit-scrollbar-thumb{background-color:#b5b5b5}.jOHNtp::-webkit-scrollbar-thumb{border-top-left-radius:var(--r)}.PvULj::-webkit-scrollbar-thumb{border-top-right-radius:var(--r)}.hTxdYE::-webkit-scrollbar-thumb{border-bottom-right-radius:var(--r)}.fUqTQL::-webkit-scrollbar-thumb{border-bottom-left-radius:var(--r)}.kVZHcH{padding-top:0}.cyerGB{margin-top:.5rem}.dSxtaa{margin-right:.5rem}.ctWdVF{border-top-left-radius:50%}.jkGfDR{border-top-right-radius:50%}.bSTogt{border-bottom-right-radius:50%}.hSDpeY{border-bottom-left-radius:50%}.cDxIqC:before{border-top-left-radius:50%}.jpWidM:before{border-top-right-radius:50%}.jzdNVF:before{border-bottom-right-radius:50%}.bPkdhG:before{border-bottom-left-radius:50%}.beJoMJ:after{border-top-left-radius:50%}.iJgiCW:after{border-top-right-radius:50%}.hqUHPA:after{border-bottom-right-radius:50%}.jWWlrr:after{border-bottom-left-radius:50%}.jnGacs{background-color:var(--g-l)}.cvPkWa{padding-bottom:1.25rem}.dUvWpK{overflow-x:hidden}.hRLVFh{overflow-y:hidden}.dLUwcr{text-decoration-line:underline}.kiDYix{flex-wrap:wrap}.hriXhD{flex-shrink:0}.jjryqL{margin-right:1rem}.jTjNVR{margin-top:0}.hNjeNG{margin-bottom:0}.kpCrIt{padding-top:1.25rem}.bMSzLf{padding-right:2rem}.iATxZH{padding-bottom:0}.iigETV{padding-left:2rem}.fClzDx{margin-top:.75rem}.iKck{margin-right:0}.hlBtvm{margin-bottom:.75rem}.bmFLeF{margin-left:0}.dwawJR{padding-right:0}.jQenOz{padding-left:0}.icKiSN{padding-top:1.5rem}.fZMRmg{padding-bottom:1.5rem}.cUXNmd{margin-top:1rem}.biWxPv{margin-bottom:1rem}.bbUXPo{text-decoration-line:none}.dmKgnC{padding-top:.5rem}.cVJMrm{padding-right:.5rem}.dPFrWx{padding-bottom:.5rem}.JxWnH{padding-left:.5rem}.dAseSU:after{border-top-width:4px}.gFfWNi:after{border-right-width:4px}.hQijyr:after{border-bottom-width:4px}.cKXpgz:after{border-left-width:4px}.jxivWg:after{border-top-color:transparent}.eoMfVT:after{border-bottom-color:transparent}.iOXMHb:after{border-left-color:transparent}.dbfKrc:after{border-top-width:2px}.jAobFs{border-top-style:none}.dQbyJV{border-right-style:none}.oTbqa{border-bottom-style:none}.gwsGKP{border-left-style:none}.SeaTL:before{border-top-width:2px}.gjJuRC:before{border-right-width:0}.iWYpgm:before{border-bottom-width:0}.iHkzF:before{border-left-width:2px}.gUiFRX:before{border-top-width:0}.dixaxG:before{border-right-width:2px}.jmWgOv:before{border-bottom-width:2px}.bTanCN:before{border-left-width:0}.gMDOZu{border-top-width:1.125em}.cgEEZJ{border-right-width:1.125em}.gqWyNB{border-bottom-width:1.125em}.ktfQGr{border-left-width:1.125em}.lpnDDz:before{border-top-width:1em}.ebRqqn:before{border-right-width:1em}.bWKMJW:before{border-bottom-width:1em}.eQlDDM:before{border-left-width:1em}.kSnqYR:before{border-top-style:solid}.fgiDpI:before{border-right-style:solid}.eeAUEW:before{border-bottom-style:solid}.ecjlX:before{border-left-style:solid}.bnSwfb:before{border-right-color:transparent}.jMYtKl:after{border-top-width:1em}.blQfIT:after{border-right-width:1em}.lijgUQ:after{border-bottom-width:1em}.ccSWYO:after{border-left-width:1em}.eGyfkC:after{border-top-style:solid}.hhBXzE:after{border-right-style:solid}.iyXZtO:after{border-bottom-style:solid}.jZLyOQ:after{border-left-style:solid}.hZGkn:after{border-right-color:transparent}.FwRrA{border-top-style:solid}.cDIyHz{border-right-style:solid}.hpBjJb{border-bottom-style:solid}.ycSPk{border-left-style:solid}@media (min-width:769px){.dXUryZ{padding-top:0}.dGtUgz{padding-right:1rem}.cQUTzq{padding-bottom:0}.bjXFvo{padding-left:1rem}.jzScEz{padding-top:2.5rem}.hMoAFf{padding-right:3rem}.bccxkr{padding-bottom:4rem}.cgjdEA{padding-left:3rem}.jZOgvY{display:flex}.uUxpw{justify-content:space-between}}@media (max-width:768px){.cElyNr{flex-direction:column}.gwFLA_D{align-items:center}}.cdhcuu:hover{color:var(--c-a)}.fItHnb:hover{background-color:var(--g-n)}*,:after,:before{box-sizing:border-box}html{-moz-tab-size:4;-o-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}button{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button{text-transform:none}button{-webkit-appearance:button}:root{--g:#f2f5f8;--g-m:#fff;--g-b:#fff;--g-s:#f6f7f8;--g-p:#f6f8fa;--g-c:rgba(174,184,193,.2);--g-n:rgba(67,90,111,.06);--g-t:#fff;--g-l:#f5f5f5;--g-i:#fff;--g-r:hsla(200,5%,89%,.5);--c:#2f3d4e;--c-a:#0969da;--c-s:#57606a;--c-m:#6f767d;--h6:#57606b;--b:#d8dee4;--b-t:#d0d7de;--r:0.5rem;--s-y:0.5rem;--s-x:0.35rem;--w:1000px;--s:0 4px 10px rgba(0,2,4,.06),0 0 1px rgba(0,2,4,.11);--i:0}@media(max-width:768px){:root{--s-y:0.35rem;--s-x:0.28rem}}@media(prefers-color-scheme:dark){:root:not(.light){color-scheme:dark;--g:#121212;--g-m:#21262d;--g-b:#364151;--g-s:#2f3542;--g-p:#161b22;--g-c:hsla(215,8%,47%,.4);--g-n:#3e4b5e;--g-t:#2f3542;--g-l:#2c343c;--g-i:#3b3b3b;--g-r:rgba(51,61,77,.5);--c:#c9d1d9;--c-a:#58a6ff;--c-s:#8b949e;--c-m:hsla(0,0%,100%,.659);--h6:#8b949e;--b:#757575;--b-t:#5f5f5f;--s:none;--i:1}:root:not(.light) img{filter:brightness(.8)}}body{line-height:1.5;background:var(--g);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,PingFang SC,Hiragino Sans GB,Source Han Sans SC,Noto Sans CJK SC,Microsoft YaHei,WenQuanYi Micro Hei,WenQuanYi Zen Hei,Helvetica Neue,Arial,sans-serif;color:var(--c);overflow-y:scroll}#__next{display:flex;flex-direction:column;justify-content:space-between;min-height:100vh}*{transition:background-color .25s ease-in-out}a{color:var(--c-a);text-decoration:none}#post_markdown__nRdJ1{line-height:1.5;word-wrap:break-word}#post_markdown__nRdJ1>:first-child{margin-top:0!important}#post_markdown__nRdJ1>:last-child{margin-bottom:0!important}#post_markdown__nRdJ1 a{color:var(--c-a);-webkit-text-decoration:underline transparent;text-decoration:underline transparent;text-underline-position:under;transition:-webkit-text-decoration-color 75ms ease-in-out;transition:text-decoration-color 75ms ease-in-out;transition:text-decoration-color 75ms ease-in-out,-webkit-text-decoration-color 75ms ease-in-out}#post_markdown__nRdJ1 a:active,#post_markdown__nRdJ1 a:hover{outline-width:0}#post_markdown__nRdJ1 a:hover{-webkit-text-decoration:underline var(--c-a);text-decoration:underline var(--c-a)}#post_markdown__nRdJ1 strong{font-weight:700}#post_markdown__nRdJ1 img{border-style:none;max-width:100%;box-sizing:content-box}#post_markdown__nRdJ1 hr{box-sizing:content-box;overflow:hidden;background:transparent;margin:1.5rem 0;border:0;border-bottom:.25rem solid var(--b)}#post_markdown__nRdJ1 h2,#post_markdown__nRdJ1 h3{margin-top:1.5rem;margin-bottom:1rem;font-weight:700;line-height:1.25}#post_markdown__nRdJ1 h2{font-size:1.5em}#post_markdown__nRdJ1 h3{font-size:1.25em}#post_markdown__nRdJ1 p{margin-top:0;margin-bottom:.625rem}#post_markdown__nRdJ1 ol,#post_markdown__nRdJ1 ul{margin-top:0;margin-bottom:0;padding-left:2em}#post_markdown__nRdJ1 li+li{margin-top:.25em}#post_markdown__nRdJ1 code{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:.75em;margin:0;padding:.2em .4em;background-color:var(--g-c);border-radius:6px}#post_markdown__nRdJ1 pre{padding:1rem;overflow:auto;font-size:.85em;line-height:1.45;background-color:var(--g-p);border-radius:6px;word-wrap:normal}#post_markdown__nRdJ1 pre::-webkit-scrollbar{height:var(--s-x);width:var(--s-y)}#post_markdown__nRdJ1 pre::-webkit-scrollbar-thumb{background:#b5b5b5;border-radius:var(--r)}#post_markdown__nRdJ1 pre code{font-size:100%;display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background:transparent;border:0}#post_markdown__nRdJ1 ol,#post_markdown__nRdJ1 p,#post_markdown__nRdJ1 pre,#post_markdown__nRdJ1 ul{margin-top:0;margin-bottom:1rem}#post_markdown__nRdJ1 .hljs-keyword,#post_markdown__nRdJ1 .hljs-type{color:#d73a49}#post_markdown__nRdJ1 .hljs-attr,#post_markdown__nRdJ1 .hljs-literal,#post_markdown__nRdJ1 .hljs-number{color:#005cc5}#post_markdown__nRdJ1 .hljs-string{color:#032f62}#post_markdown__nRdJ1 .hljs-built_in{color:#e36209}#post_markdown__nRdJ1 .hljs-section{color:#005cc5;font-weight:700}</style><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/3fc16492cd6995f6.css" data-n-g="" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/3fc16492cd6995f6.css"></noscript><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/1550b18fa9b2cc2d.css" data-n-g="" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/1550b18fa9b2cc2d.css"></noscript><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/49e3c9be9aebdd02.css" data-n-p="" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://static.cdn.baoshuo.ren/blog/_next/static/css/49e3c9be9aebdd02.css"></noscript><noscript data-n-css=""></noscript></head><body><div id="__next"><div class="eDssNQ imhmwA bOjOhu WhAZY cRUUAa gZmUMJ hJfaYF KqcXP "><div class="gdPTUr jBtqwC fxkyut " style="opacity:0;width:0%"><div class="bEvNbr ktTKqx gdPTUr fxkyut dJcTkO gOeSjL kaWzRu " style="left:-5.5%"></div></div></div><div><nav class="gSBWlu kJzccJ gCwvuy eAOGpx dPAasc eSaSrN cjScYX jqaXfP cElyNr gwFLA_D dXUryZ dGtUgz cQUTzq bjXFvo " role="navigation"><a class="gSBWlu bcjLCN hriXhD foGVKH gifdxR bpQkXn fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn bBVwIW " href="/"><svg id="Main" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="caItCN dSxtaa "><path d="M471,256A214.8122,214.8122,0,0,1,256,471a216.4337,216.4337,0,0,1-40.955-3.896A214.86,214.86,0,0,1,41,256,214.9809,214.9809,0,0,1,256,41a214.4584,214.4584,0,0,1,154.4137,65.4129q6.911,7.1214,13.146,14.8661c1.3337,1.6587,2.6413,3.3258,3.9229,5.0281A214.5854,214.5854,0,0,1,471,256Z" fill="#5897d1"></path><path d="M419.2572,204.2572A163.1145,163.1145,0,0,1,256,367.5136a164.3664,164.3664,0,0,1-31.0985-2.9579A163.271,163.271,0,1,1,419.2572,204.2572Z" fill="#9fc5e6"></path><path d="M418.8558,63.0971v44.65A10.5833,10.5833,0,0,1,408.2729,118.33H333.7074V52.5134h74.5655A10.584,10.584,0,0,1,418.8558,63.0971Z" fill="#ff668c"></path><path d="M329.7492,458.0118A215.2574,215.2574,0,0,1,60.2534,345.0537l67.6679-90.0019a30.79,30.79,0,0,1,49.2216,0l38.5328,51.2574Z" fill="#343a6e"></path><path d="M408.6937,77.1989a8.2229,8.2229,0,0,1-8.2229,8.223H371.8716a8.2271,8.2271,0,0,0,0,16.4542h9.8724a8.2271,8.2271,0,1,1,0,16.4542H333.7065V52.5134h46.87a8.2238,8.2238,0,0,1,8.2229,8.2313,8.2246,8.2246,0,0,0,8.2313,8.2229h3.44A8.23,8.23,0,0,1,408.6937,77.1989Z" fill="#ef487d"></path><path d="M328.6658,41.0008h0a7.2391,7.2391,0,0,0-7.2394,7.24V230.2126h14.4789V48.24A7.24,7.24,0,0,0,328.6658,41.0008Z" fill="#f9df73"></path><path d="M454.3619,339.0513q-2.87,6.8317-6.1872,13.4266A215.3468,215.3468,0,0,1,215.045,467.104a214.1378,214.1378,0,0,1-82.1653-34.83L299.2368,211.0171a36.8115,36.8115,0,0,1,58.8571,0Z" fill="#484b7f"></path><path d="M328.67,196.3173c-5.6429,0-11.285,4.8972-15.0584,14.699L215.045,467.104a213.7775,213.7775,0,0,1-82.1653-34.83L299.2461,211.0171A36.578,36.578,0,0,1,328.67,196.3173Z" fill="#343a6e"></path><path d="M448.1747,352.4779A215.3468,215.3468,0,0,1,215.045,467.104a213.4209,213.4209,0,0,1-59.4366-20.9382L264.82,337.7974c-17.0068,44.185,31.1885,55.6372,81.2087,37.2085C391.9237,358.0939,396.8116,340.0692,448.1747,352.4779Z" fill="#343a6e"></path><path d="M215.6766,306.31c-25.6245.886-50.9072,16.0419-67.0884,16.0419-25.0106,0-54.584-22.1845-20.6661-67.2992a30.79,30.79,0,0,1,49.2216,0Z" fill="#484b7f"></path></svg><span>宝硕博客</span></a><div class="gSBWlu jYEAGD dvivnl iVncgA fQhDyl qlVwF jOHNtp PvULj hTxdYE fUqTQL "><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/">首页</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/archives/">归档</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/categories/">分类</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/tags/">标签</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/friends/">友链</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/about/">关于</a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/atom.xml"><i class="cpOcAb cjScYX hHGIsI jXmXEB bLHLvQ eLDTYY kAVdUc dUvWpK hRLVFh julXB dhOkuk kvHVCE gbJvTx eqcbDJ efWRhG ciQIPM iqzSxf cdfZWI zJreD iSSyDr jORRks beaHbQ fqXcHQ haKUHj dyMCpl cTiRpf kLOwRz fEOdlm iiCJgG feNfPp dAseSU gFfWNi hQijyr cKXpgz eGyfkC hhBXzE iyXZtO jZLyOQ jxivWg hZGkn eoMfVT iOXMHb qMJeO dUAgBC hVfwnH jtnuen iibzBM "></i></a><a class="gSBWlu bcjLCN hriXhD foGVKH fyuAJJ bbUXPo eQmaZO eIJBjz dZrGlq hcJOFn fItHnb " href="/search/"><i class="fygwnR cpOcAb kAVdUc jXmXEB hHGIsI cjScYX bLHLvQ eLDTYY julXB kvHVCE SeaTL dixaxG jmWgOv iHkzF kSnqYR fgiDpI eeAUEW ecjlX gbJvTx eqcbDJ efWRhG ciQIPM bLLutt kKTZiz jYPXoJ kUNXjX kBZpXt fqXcHQ dyMCpl dbfKrc eGyfkC kCTVgr cDbGzW eHPmEw dmfenB "></i></a><div class="dYbGIK eKlQYW ihNVbP "><button class="jsvbrX gdPTUr gSBWlu foGVKH IVbXa eQmaZO eIJBjz dZrGlq hcJOFn jAobFs dQbyJV oTbqa gwsGKP KqcXP fItHnb "><i class="cpOcAb kAVdUc jXmXEB hHGIsI cjScYX bLHLvQ eLDTYY julXB kvHVCE bQvqKh jLmWnd SeaTL dixaxG jmWgOv iHkzF kSnqYR fgiDpI eeAUEW ecjlX jVKJhP qOQRo ftrJDm dnkCBy jYPXoJ kKTZiz fqXcHQ dyMCpl iMyxuR hwgZgR eCTYLu fPEpYf fSuxSX diZuuN elJZFC eLXBUo ebtDcN bbRNPO "></i></button></div></div></nav><main><article class="gCwvuy kRQsoY jBvrhX dgtTIu eXJtsk dvivnl llUCyD dPAasc ipEZTh eRVtDl cUXNmd jdraHW biWxPv eqrBPF"><img class="cRUUAa jYagCu gWinOH " src="https://s1.baoshuo.ren/2021/04/03/R6IHLundNjpKxCD.png" alt="初探 DN42 网络"><header class="jTjNVR iKck hNjeNG bmFLeF dmKgnC bMSzLf iATxZH iigETV "><h1 class="fClzDx iKck hlBtvm bmFLeF cypeLb VFfNK ">初探 DN42 网络</h1><div class="dmKgnC dwawJR dPFrWx jQenOz dgIPcR "><time datetime="2021-04-04T03:29:32.000Z">2021-04-04</time><span class="jTjNVR iawFZL hNjeNG kswRdL gKQCBv "></span><a class="fyuAJJ bbUXPo cdhcuu " href="/categories/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向</a><span class="jTjNVR iawFZL hNjeNG kswRdL gKQCBv "></span><span>约 5.2 千字</span></div></header><section class="jTjNVR iKck hNjeNG bmFLeF bKjKUN bMSzLf fZMRmg iigETV kKplrA " id="post_markdown__nRdJ1"><p>DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 BGP 网络。DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。</p><span id="more"></span><p>DN42 适合以下类别的用户：</p><ul><li>想要研究网络技术，练习服务器、路由器等网络设备配置，甚至后续在真实互联网建立 AS 的用户。</li><li>已经拥有真实 AS ，但担心自己<a href="https://blog.cloudflare.com/how-verizon-and-a-bgp-optimizer-knocked-large-parts-of-the-internet-offline-today/" rel="external nofollow noreferrer">配置错误广播出错误路由、干掉半个互联网</a>，希望有个地方测试的用户。</li></ul><p>DN42 不适合以下类别的用户：</p><ul><li>单纯想要保护隐私、规避网络审查的用户</li><li>在网内消耗大量流量，例如用于解锁流媒体服务的用户</li></ul><p>所以，DN42 的使用门槛还是比较高的。这与在真实互联网中一样，你要扮演一个 ISP （互联网服务提供商），注册自己的个人信息， ASN 号码，IPv4 和 IPv6 的地址池，并且使用 BGP 在自己的服务器上广播它们。你还要和其它的用户联系，和他们进行 Peering（对等互联），一步步进入完整的 DN42 网络。</p><hr><p>DN42 在 <code>172.20.0.0/14</code> 和 <code>fd00::/8</code> 上运行，而这两个 IP 段都是分配给内网使用的。换句话说，你在 DN42 上怎么折腾，都不会影响到服务器其它的互联网连接。</p><p>你可以通过加入 <a href="https://t.me/Dn42Chat" rel="external nofollow noreferrer">Telegram 群组</a> 或者 <a href="irc://irc.hackint.org/#dn42" rel="external nofollow noreferrer">IRC 频道</a> 来寻求帮助。</p><p>请注意，DN42 是一个测试网络，所有人都在帮助所有人。即使你不小心搞砸了，也没有人会指责你。</p><p>欢迎在搭建完成自己的内网以后与我进行对等互联，可以访问 <a href="https://dn42.baoshuo.ren" rel="external nofollow noreferrer">dn42.baoshuo.ren</a> 获取更多信息。</p><p>若无特别说明，本文中所使用的系统环境均为 <code>Ubuntu 20.04.2 LTS</code> ，本文中所有使用 <code>&lt;&gt;</code> 包裹的内容均需要自行替换。</p><h2 id="注册-dn42">注册 DN42</h2><p>在注册过程中会大量使用到一些 UNIX 工具（如 Git 、 GPG 等），所以最好使用 Linux 或者 macOS 系统完成整个流程，如果你正在使用 Windows 系统，那么可以使用 <a href="http://aka.ms/wsl" rel="external nofollow noreferrer">WSL</a> 。</p><h3 id="注册前的准备">注册前的准备</h3><ul><li>了解如何编写 RPSL （<a href="https://tools.ietf.org/html/rfc2622/" rel="external nofollow noreferrer">RFC2622</a>） 格式的配置文件。</li><li>了解如何使用 <a href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1" rel="external nofollow noreferrer">CIDR</a> （<a href="https://tools.ietf.org/html/rfc1518" rel="external nofollow noreferrer">RFC1518</a>，<a href="https://tools.ietf.org/html/rfc1519" rel="external nofollow noreferrer">RFC1519</a>） 格式表示 IP 地址块。</li><li>熟悉 <a href="https://dn42.dev" rel="external nofollow noreferrer">DN42 Wiki</a> 中的 <a href="https://dn42.dev/howto/Getting-Started" rel="external nofollow noreferrer">Getting-Started</a> 、 <a href="https://dn42.dev/howto/Address-Space" rel="external nofollow noreferrer">Address Space</a> 页面中的内容。</li><li>在 <a href="https://git.dn42.dev" rel="external nofollow noreferrer">DN42 Git</a> 中有一个注册好的账户。</li><li>会使用英文与他人交流。</li></ul><h3 id="克隆-dn42-注册表-git-仓库">克隆 DN42 注册表 Git 仓库</h3><p>将 <a href="https://git.dn42.dev/dn42/registry" rel="external nofollow noreferrer">dn42/registry</a> 这个仓库 clone 到本地。</p><p>新建一个名为 <code>&lt;用户名&gt;-&lt;日期, YYYYMMDD&gt;/&lt;自定义名称&gt;</code> 的分支。</p><pre><code class="hljs bash">git checkout -b &lt;用户名&gt;-&lt;日期, YYYYMMDD&gt;/register</code></pre><h3 id="注册维护者">注册维护者</h3><p>在仓库的 <code>data/mntner</code> 目录下新建一个文件，命名为 <code>&lt;昵称&gt;-MNT</code> 。</p><p>文件内填入以下内容：</p><pre><code class="hljs rpsl">mntner:             &lt;昵称&gt;-MNT
admin-c:            &lt;昵称&gt;-DN42
tech-c:             &lt;昵称&gt;-DN42
auth:               &lt;身份验证信息&gt;
mnt-by:             &lt;维护者&gt;
source:             DN42</code></pre><p>示例：<a href="https://git.dn42.dev/dn42/registry/src/branch/master/data/mntner/BAOSHUO-MNT" rel="external nofollow noreferrer"><code>data/mntner/BAOSHUO-MNT</code> at dn42/registry@master</a></p><ul><li><code>mntner</code> ：维护者（全称为 Maintainer），这个维护者的名称，与文件名相同。</li><li><code>admin-c</code> ：管理员联系信息（Admin Contact），需要指向 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中的 <code>person</code> 文件，一般为 <code>&lt;昵称&gt;-DN42</code> 。</li><li><code>tech-c</code> ：技术人员联系信息（Tech Contact），需要指向 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中的 <code>person</code> 文件，一般为 <code>&lt;昵称&gt;-DN42</code> 。</li><li><code>auth</code> ：身份验证信息，接受 <strong>GPG 公钥</strong> 和 <strong>SSH 公钥</strong> ，可以查看 <a href="https://dn42.dev/howto/Registry-Authentication" rel="external nofollow noreferrer">Registry Authentication</a> 页面获取详细信息。</li><li><code>mnt-by</code> ：由谁维护（全称为 Maintain by），此处需要指向这个维护者本身，即 <code>&lt;昵称&gt;-MNT</code> 。</li><li><code>source</code> ：信息来源，默认为 <code>DN42</code> 。</li></ul><h3 id="注册联系人">注册联系人</h3><p>在仓库的 <code>data/person</code> 目录下新建一个文件，命名为 <code>&lt;昵称&gt;-DN42</code> 。</p><pre><code class="hljs rpsl">person:             &lt;姓名&gt;
contact:            &lt;邮箱&gt;
nic-hdl:            &lt;NIC 句柄&gt;
mnt-by:             &lt;维护者&gt;
source:             DN42</code></pre><p>示例：<a href="https://git.dn42.dev/dn42/registry/src/branch/master/data/person/BAOSHUO-DN42" rel="external nofollow noreferrer"><code>data/person/BAOSHUO-DN42</code> at dn42/registry@master</a></p><ul><li><code>person</code> ：姓名。</li><li><code>contact</code> ：联系方式，一般为邮箱。</li><li><code>nic-hdl</code> ：NIC 句柄（即 <a href="https://en.wikipedia.org/wiki/NIC_handle" rel="external nofollow noreferrer">NIC handle</a>），指向文件本身，与文件名相同。</li><li><code>mnt-by</code> ：由谁维护（全称为 Maintain by），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85">注册维护者</a> 一节中注册的的维护者信息。</li><li><code>source</code> ：固定为 <code>DN42</code>。</li></ul><h3 id="注册-asn">注册 ASN</h3><p>在国际互联网上，ASN 范围 <code>4200000000 - 4294967294</code> 是被保留以供私人使用的，而 DN42 占用的就是其中的一块： <code>4242420000 - 4242429999</code> 。目前 DN42 开放注册的 ASN 范围是 <code>4242420000 - 4242423999</code> ，只需要在这个区间里面挑一个没有被他人占用的号码即可。</p><p>DN42 Registry 的管理员 burble 提供了一个在线查看可用 ASN 的工具: <a href="https://explorer.burble.com/free#/asn" rel="external nofollow noreferrer">DN42 Free ASN Explorer</a> 。访问该页面就会随机生成 10 个当前还未注册的 ASN 以便使用。</p><p>在仓库的 <code>data/aut-num</code> 目录下新建一个文件，命名为刚才选中的 AS 号码。</p><pre><code class="hljs rpsl">aut-num:            &lt;AS 号码, 带 AS 前缀&gt;
as-name:            &lt;AS 名称&gt;
descr:              &lt;AS 简介&gt;
admin-c:            &lt;NIC 句柄&gt;
tech-c:             &lt;NIC 句柄&gt;
mnt-by:             &lt;维护者&gt;
source:             DN42</code></pre><p>示例：<a href="https://git.dn42.dev/dn42/registry/src/branch/master/data/aut-num/AS4242420247" rel="external nofollow noreferrer"><code>data/aut-num/AS4242420247</code> at dn42/registry@master</a></p><ul><li><code>aut-num</code> ：AS 号，此处可以使用私有 AS 号码，也可以使用公网 AS 号码（不推荐）。</li><li><code>as-name</code> ：AS 的名称，可以设置为 <code>&lt;昵称&gt;-AS</code> 。</li><li><code>descr</code> ：（选填）AS 简介，随意填写。</li><li><code>admin-c</code> ：管理员联系信息（Admin Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>tech-c</code> ：技术员联系信息（Tech Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>mnt-by</code> ：由谁维护（Maintain by），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85">注册维护者</a> 一节中注册的的维护者信息。</li><li><code>source</code> ：如果使用私有 AS 号码则此处填写 <code>DN42</code> ，否则填写 ASN 所对应的 RIR 名称。</li></ul><h3 id="注册-ipv4-地址块">注册 IPv4 地址块</h3><p><em>如果您想在 DN42 上创建一个 IPv6 Only 网络，请不要注册 IPv4 地址块，并忽略 <a href="#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E8%AE%B0%E5%BD%95">添加路由记录</a> 一节中的 IPv4 部分。</em></p><p>在国际互联网上， <code>172.16.0.0/12</code> 是由 <a href="https://tools.ietf.org/html/rfc1918" rel="external nofollow noreferrer">RFC1918</a> 规定的由专用网络使用的 IP 地址块，而 DN42 占用的就是其中的一块： <code>172.20.0.0/14</code> 。目前 DN42 开放注册的地址块范围可以在 <a href="https://dn42.dev/howto/Address-Space#ipv4-address-space" rel="external nofollow noreferrer">Address Space</a> 页面上查看。</p><p>DN42 Registry 的管理员 burble 提供了一个在线查看可用 IPv4 地址块的网站，点击 <a href="https://explorer.burble.com/free#/4" rel="external nofollow noreferrer">DN42 Free IPv4 Explorer</a> 即可随机生成 10 个当前还未注册的 IPv4 地址块。</p><p>和在真实互联网上一样，DN42 的 IPv4 地址资源也是十分紧缺的，因此 IPv4 的申请原则是「够用就好」。如果节点数量足够少，只申请 <code>/28</code> 或 <code>/29</code> 大小的地址块就够用了。</p><p>在仓库的 <code>data/inetnum</code> 目录下新建一个文件，命名为 IP 地址块的 CIDR 格式，并使用 <code>_</code> 代替 <code>/</code>。</p><pre><code class="hljs rpsl">inetnum:            &lt;起始 IP 地址&gt; - &lt;结束 IP 地址&gt;
cidr:               &lt;IP 地址块的 CIDR 格式&gt;
netname:            &lt;IP 地址块名称&gt;
descr:              &lt;IP 地址块简介&gt;
country:            &lt;IP 地址块所属国家&gt;
admin-c:            &lt;NIC 句柄&gt;
tech-c:             &lt;NIC 句柄&gt;
mnt-by:             &lt;维护者&gt;
status:             ASSIGNED
source:             DN42</code></pre><p>示例：<a href="https://git.dn42.dev/dn42/registry/src/branch/master/data/inetnum/172.23.250.64_26" rel="external nofollow noreferrer"><code>data/inetnum/172.23.250.64_26</code> at dn42/registry@master</a></p><ul><li><code>inetnum</code> ：这个地址块的范围。</li><li><code>cidr</code> ：以 CIDR 格式表示的这个地址块的范围，含义与 <code>inetnum</code> 相同。</li><li><code>netname</code> ：这个地址块的名称。可以设置为 <code>&lt;昵称&gt;-IPV4</code> 。</li><li><code>descr</code> ：（选填）这个地址块的简介。</li><li><code>nserver</code> ：（选填）IP 地址反向解析的 DNS 服务器。</li><li><code>country</code> ：你的 <a href="https://zh.wikipedia.org/wiki/ISO_3166" rel="external nofollow noreferrer">ISO 3166</a> 国家代码，填 <code>CN</code> 代表中国大陆地区。</li><li><code>admin-c</code> ：管理员联系信息（Admin Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>tech-c</code> ：技术员联系信息（Tech Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>mnt-by</code> ：由谁维护（Maintain by），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85">注册维护者</a> 一节中注册的的维护者信息。</li><li><code>status</code> ：固定为 <code>ASSIGNED</code>。</li><li><code>source</code> ：固定为 <code>DN42</code>。</li></ul><h3 id="注册-ipv6-地址块">注册 IPv6 地址块</h3><p>在国际互联网上， <code>fc00::/7</code> 是由 <a href="https://tools.ietf.org/html/rfc4193" rel="external nofollow noreferrer">RFC4193</a> 定义的 <a href="https://en.wikipedia.org/wiki/Unique_local_address" rel="external nofollow noreferrer">唯一本地地址</a>，而 DN42 占用的就是其中的一块： <code>fd00::/8</code> 。目前 DN42 开放注册的地址块范围可以在 <a href="https://dn42.dev/howto/Address-Space#ipv6-address-space" rel="external nofollow noreferrer">Address Space</a> 页面上查看。</p><p>DN42 Registry 的管理员 burble 提供了一个在线查看可用 IPv6 地址块的网站，点击 <a href="https://explorer.burble.com/free#/6" rel="external nofollow noreferrer">DN42 Free IPv6 Explorer</a> 即可随机生成 10 个当前还未注册的 IPv6 地址块。</p><p>在仓库的 <code>data/inet6num</code> 目录下新建一个文件，命名为 IPv6 地址块的 CIDR 格式，并使用 <code>_</code> 代替 <code>/</code>。</p><pre><code class="hljs rpsl">inet6num:           &lt;起始 IPv6 地址&gt; - &lt;结束 IPv6 地址&gt;
cidr:               &lt;IPv6 地址块的 CIDR 格式&gt;
netname:            &lt;IPv6 地址块名称&gt;
descr:              &lt;IPv6 地址块简介&gt;
country:            &lt;IPv6 地址块所属国家&gt;
admin-c:            &lt;NIC 句柄&gt;
tech-c:             &lt;NIC 句柄&gt;
mnt-by:             &lt;维护者&gt;
status:             ASSIGNED
source:             DN42</code></pre><p>示例：<a href="https://git.dn42.dev/dn42/registry/src/branch/master/data/inet6num/fd42:4242:247::_48" rel="external nofollow noreferrer"><code>data/inet6num/fd42:4242:247::_48</code> at dn42/registry@master</a></p><ul><li><code>inet6num</code> ：这个地址块的范围。</li><li><code>cidr</code> ：使用 CIDR 格式表示的这个地址块的范围，含义与 <code>inet6num</code> 相同。</li><li><code>netname</code> ：这个地址块的名称。可以设置为 <code>&lt;昵称&gt;-IPV6</code> 。</li><li><code>descr</code> ：（选填）这个地址块的简介。</li><li><code>nserver</code> ：（选填）IP 地址反向解析的 DNS 服务器。</li><li><code>country</code> ：你的 <a href="https://zh.wikipedia.org/wiki/ISO_3166" rel="external nofollow noreferrer">ISO 3166</a> 国家代码，填 <code>CN</code> 代表中国大陆地区。</li><li><code>admin-c</code> ：管理员联系信息（Admin Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>tech-c</code> ：技术员联系信息（Tech Contact），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA">注册联系人</a> 一节中注册的 NIC 句柄。</li><li><code>mnt-by</code> ：由谁维护（Maintain by），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85">注册维护者</a> 一节中注册的的维护者信息。</li><li><code>status</code> ：固定为 <code>ASSIGNED</code>。</li><li><code>source</code> ：固定为 <code>DN42</code>。</li></ul><h3 id="添加路由记录">添加路由记录</h3><p>在仓库的 <code>data/route</code> 目录下新建一个文件，命名为 IP 地址块的 CIDR 格式，并使用 <code>_</code> 代替 <code>/</code>。</p><pre><code class="hljs rpsl">route:              &lt;IP 地址块的 CIDR 格式&gt;
descr:              &lt;简介&gt;
origin:             &lt;AS 号码, 带 AS 前缀&gt;
mnt-by:             &lt;维护者&gt;
source:             DN42</code></pre><ul><li><code>route</code> ：这个 IPv4 地址块的范围，CIDR 格式。</li><li><code>descr</code> ：（选填）路由简介。</li><li><code>origin</code> ：填写你的 AS 号码。</li><li><code>mnt-by</code> ：由谁维护（Maintain by），指向你在 <a href="#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85">注册维护者</a> 一节中注册的的维护者信息。</li><li><code>source</code> ：固定为 <code>DN42</code>。</li></ul><p>如需添加 IPv6 路由，将本节所述的 <code>route</code> 改为 <code>route6</code> 即可，此处不再赘述。</p><h3 id="上传更改到-dn42-注册表">上传更改到 DN42 注册表</h3><p>完成以上步骤之后，使用 <code>git diff</code> 查看文件变动，检查无误后，使用 <code>git add .</code> 暂存。</p><p><img src="https://s1.baoshuo.ren/2021/08/14/RhjwYHFGcaKUSye.png" alt="" loading="lazy"></p><p>运行仓库根目录下的 <code>./check-my-stuff &lt;维护者&gt;</code> 检查文件内容是否有误，确定无误后，提交。</p><p>在提交时，如果需要使用 GPG 签名，需要在添加 <code>-S</code> 参数，如 <code>git commit -S</code> ；如果使用 SSH 签名，请直接使用 <code>git commit</code> 进行提交，待提交后再进行签名工作。</p><p>使用下面的命令进行签名：</p><pre><code class="hljs bash">./sign-my-commit --ssh --key &lt;SSH 私钥文件&gt; &lt;维护者&gt;</code></pre><p>之后使用下面的命令上传即可：</p><pre><code class="hljs bash">git push --set-upstream origin &lt;用户名&gt;-&lt;日期, YYYYMMDD&gt;/register</code></pre><p><img src="https://s1.baoshuo.ren/2021/04/04/1YwNjs8uvOJMFoq.png" alt="" loading="lazy"></p><p>上传后在 DN42 Git 中切换到自己的分支，并创建一个合并请求，等待管理员审核。</p><h3 id="注意事项">注意事项</h3><ol><li>各个项目的键和值之间有一长串空格，键、冒号与空格的总长度必须是 20 个字符，且不能随意修改。为了编辑时的方便，注册表中提供了一个脚本 <code>fmt-my-stuff</code> ，只需要使用 <code>./fmt-my-stuff &lt;维护者&gt;</code> 即可自动完成此步骤。</li><li>DN42 Registry 的工作语言是英语。请使用英语完成全部流程，以免出现不必要的麻烦。</li><li>请认真对待管理员提出的更改请求，按照要求完成全部修改后直接上传到原分支下即可，无需再新开合并请求。</li><li>推荐使用随机的 IPv4 与 IPv6 地址块，避免与其他网络重复。请明白，DN42 并不是这些网络资源的权威注册机构。</li></ol><h2 id="dn42-bird2-使用入门">DN42 BIRD2 使用入门</h2><p>如无特别说明，本部分中所使用的 BIRD 版本为 <code>2.0.7</code> 。</p><h3 id="安装-bird2">安装 BIRD2</h3><pre><code class="hljs bash">apt update
apt install bird2 -y</code></pre><p>一般情况下，执行此命令即可自动安装 BIRD2 并启动系统服务。</p><h3 id="编写-bird-配置文件">编写 BIRD 配置文件</h3><p>对于刚刚加入 DN42 网络的新人来说，推荐使用 <a href="https://dn42.dev/howto/Bird2#example-configuration" rel="external nofollow noreferrer">howto/Bird2 - DN42 Wiki</a> 中的示例配置以节省配置时间。</p><p>这套配置默认使用了 Multi Protocol BGP ，如果不想使用此功能请自行编写配置文件，如果没有 DN42 IPv4 地址需要去掉文件中的 IPv4 部分。</p><p>将以下配置写入到 <code>/etc/bird/bird.conf</code> 中：</p><pre><code class="hljs pgsql">define OWNAS       = &lt;<span class="hljs-keyword">AS</span> 号&gt;;
define OWNIP       = &lt;DN42 IPv4 地址&gt;;
define OWNIPv6     = &lt;DN42 IPv6 地址&gt;;
define OWNNET      = &lt;DN42 IPv4 地址块, <span class="hljs-type">CIDR</span> 格式&gt;;
define OWNNETv6    = &lt;DN42 IPv6 地址块, <span class="hljs-type">CIDR</span> 格式&gt;;
define OWNNETSET   = [ &lt;DN42 IPv4 地址块, <span class="hljs-type">CIDR</span> 格式&gt;+ ];
define OWNNETSETv6 = [ &lt;DN42 IPv6 地址块, <span class="hljs-type">CIDR</span> 格式&gt;+ ];

router id OWNIP;

protocol device {
    scan <span class="hljs-type">time</span> <span class="hljs-number">10</span>;
}

<span class="hljs-keyword">function</span> is_self_net() {
    <span class="hljs-keyword">return</span> net ~ OWNNETSET;
}

<span class="hljs-keyword">function</span> is_self_net_v6() {
    <span class="hljs-keyword">return</span> net ~ OWNNETSETv6;
}

<span class="hljs-keyword">function</span> is_valid_network() {
    <span class="hljs-keyword">return</span> net ~ [
        <span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">14</span>{<span class="hljs-number">21</span>,<span class="hljs-number">29</span>}, # dn42
        <span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>{<span class="hljs-number">28</span>,<span class="hljs-number">32</span>}, # dn42 Anycast
        <span class="hljs-number">172.21</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>{<span class="hljs-number">28</span>,<span class="hljs-number">32</span>}, # dn42 Anycast
        <span class="hljs-number">172.22</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>{<span class="hljs-number">28</span>,<span class="hljs-number">32</span>}, # dn42 Anycast
        <span class="hljs-number">172.23</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>{<span class="hljs-number">28</span>,<span class="hljs-number">32</span>}, # dn42 Anycast
        <span class="hljs-number">172.31</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">16</span>+,       # ChaosVPN
        <span class="hljs-number">10.100</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">14</span>+,       # ChaosVPN
        <span class="hljs-number">10.127</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">16</span>{<span class="hljs-number">16</span>,<span class="hljs-number">32</span>}, # neonetwork
        <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">8</span>{<span class="hljs-number">15</span>,<span class="hljs-number">24</span>}     # Freifunk.net
    ];
}

roa4 <span class="hljs-keyword">table</span> dn42_roa;
roa6 <span class="hljs-keyword">table</span> dn42_roa_v6;

protocol static {
    roa4 { <span class="hljs-keyword">table</span> dn42_roa; };
    <span class="hljs-keyword">include</span> "/etc/bird/roa_dn42.conf";
};

protocol static {
    roa6 { <span class="hljs-keyword">table</span> dn42_roa_v6; };
    <span class="hljs-keyword">include</span> "/etc/bird/roa_dn42_v6.conf";
};

<span class="hljs-keyword">function</span> is_valid_network_v6() {
  <span class="hljs-keyword">return</span> net ~ [
    fd00::/<span class="hljs-number">8</span>{<span class="hljs-number">44</span>,<span class="hljs-number">64</span>} # ULA address space <span class="hljs-keyword">as</span> per RFC <span class="hljs-number">4193</span>
  ];
}

protocol kernel {
    scan <span class="hljs-type">time</span> <span class="hljs-number">20</span>;

    ipv6 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">none</span>;
        export <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> source = RTS_STATIC <span class="hljs-keyword">then</span> reject;
            krt_prefsrc = OWNIPv6;
            accept;
        };
    };
};

protocol kernel {
    scan <span class="hljs-type">time</span> <span class="hljs-number">20</span>;

    ipv4 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">none</span>;
        export <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> source = RTS_STATIC <span class="hljs-keyword">then</span> reject;
            krt_prefsrc = OWNIP;
            accept;
        };
    };
}

protocol static {
    route OWNNET reject;

    ipv4 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">all</span>;
        export <span class="hljs-keyword">none</span>;
    };
}

protocol static {
    route OWNNETv6 reject;

    ipv6 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">all</span>;
        export <span class="hljs-keyword">none</span>;
    };
}

<span class="hljs-keyword">template</span> bgp dnpeers {
    <span class="hljs-keyword">local</span> <span class="hljs-keyword">as</span> OWNAS;
    <span class="hljs-type">path</span> metric <span class="hljs-number">1</span>;

    ipv4 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> is_valid_network() &amp;&amp; !is_self_net() <span class="hljs-keyword">then</span> {
                <span class="hljs-keyword">if</span> (roa_check(dn42_roa, net, bgp_path.last) != ROA_VALID) <span class="hljs-keyword">then</span> {
                    print "[dn42] ROA check failed for ", net, " ASN ", bgp_path.last;
                    reject;
                }
                accept;
            }
            reject;
        };

        export <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> is_valid_network() &amp;&amp; source ~ [RTS_STATIC, RTS_BGP] <span class="hljs-keyword">then</span> accept;
            reject;
        };
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1000</span> action block;
    };

    ipv6 {
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> is_valid_network_v6() &amp;&amp; !is_self_net_v6() <span class="hljs-keyword">then</span> {
                <span class="hljs-keyword">if</span> (roa_check(dn42_roa_v6, net, bgp_path.last) != ROA_VALID) <span class="hljs-keyword">then</span> {
                    print "[dn42] ROA check failed for ", net, " ASN ", bgp_path.last;
                    reject;
                }
                accept;
            }
            reject;
        };
        export <span class="hljs-keyword">filter</span> {
            <span class="hljs-keyword">if</span> is_valid_network_v6() &amp;&amp; source ~ [RTS_STATIC, RTS_BGP] <span class="hljs-keyword">then</span> accept;
            reject;
        };
        <span class="hljs-keyword">import</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1000</span> action block;
    };
}


<span class="hljs-keyword">include</span> "/etc/bird/peers/*";</code></pre><p>然后在 <code>/etc/bird</code> 目录下创建一个文件夹，命名为 <code>peers</code> ，以便后续存储配置文件使用。</p><p>如果想更深入的学习如何编写 BIRD 配置文件，推荐查看 <a href="https://github.com/moesoha/bird-bgp-kickstart" rel="external nofollow noreferrer">BIRD 与 BGP 的新手开场</a> 和 <a href="https://bird.network.cz/?get_doc&amp;f=bird.html&amp;v=20" rel="external nofollow noreferrer">BIRD 官方文档</a> 。</p><h3 id="下载-roa-配置文件">下载 ROA 配置文件</h3><pre><code class="hljs bash">wget -4 -O /tmp/dn42_roa.conf https://dn42.burble.com/roa/dn42_roa_bird2_4.conf &amp;&amp; <span class="hljs-built_in">mv</span> -f /tmp/dn42_roa.conf /etc/bird/dn42_roa.conf
wget -4 -O /tmp/dn42_roa_v6.conf https://dn42.burble.com/roa/dn42_roa_bird2_6.conf &amp;&amp; <span class="hljs-built_in">mv</span> -f /tmp/dn42_roa_v6.conf /etc/bird/dn42_roa_v6.conf</code></pre><p>使用此命令即可将 ROA 文件下载到本机以供使用。</p><p>还需要将此命令添加为定时任务，推荐设置为每小时运行一次，否则不会更新到最新的 ROA ，每次更新后都需要使用 <code>birdc configure</code> 命令重载 BIRD 配置。</p><h3 id="重新加载-bird-配置">重新加载 BIRD 配置</h3><pre><code class="hljs bash">birdc configure</code></pre><p>使用该命令重新加载 BIRD 配置，并使用 <code>birdc show protocol</code> 查看状态。</p><p><img src="https://s1.baoshuo.ren/2021/08/16/ZSPe6a3fpuDATG2.png" alt="" loading="lazy"></p><h2 id="dn42-wireguard-使用入门">DN42 WireGuard 使用入门</h2><p>WireGuard 是一种简单易用、速度快、现代化的 VPN ，它利用了最先进的加密技术，并使用 UDP 协议传输数据。WireGuard 设计为通用 VPN ，可在嵌入式设备和超级计算机上运行，​​ 适用于许多不同的环境。WireGuard 起初是专为 Linux 编写并发布的，后来被移植到各个平台上。在 <a href="http://WireGuard.com" rel="external nofollow noreferrer">WireGuard.com</a> 上可以找到它的 <a href="https://www.wireguard.com/papers/wireguard.pdf" rel="external nofollow noreferrer">技术白皮书</a> 。</p><h3 id="安装-wireguard">安装 WireGuard</h3><pre><code class="hljs bash">apt update
apt install wireguard -y</code></pre><p>一般情况下，执行此命令即可直接安装 WireGuard 和 WireGuard Tools ，无需额外操作。</p><h3 id="生成公钥与私钥">生成公钥与私钥</h3><pre><code class="hljs bash">wg genkey | <span class="hljs-built_in">tee</span> privatekey | wg pubkey &gt; publickey</code></pre><p>使用此命令即可在当前目录下生成两个名叫 <code>privatekey</code> 和 <code>publickey</code> 的文件，分别代表私钥和公钥。</p><h3 id="搭建-wireguard-隧道">搭建 WireGuard 隧道</h3><p>搭建 WireGuard 隧道非常简便，只需要生成一对公钥与私钥并与对等端交换公钥即可。</p><p>如果需要通过 WireGuard 隧道建立 BGP 会话，不能使用 WireGuard 内建的多 Peer 功能，必须为每个对等端创建一条隧道。</p><p>在 <code>/etc/wireguard</code> 目录下新建一个名为 <code>&lt;隧道名&gt;.conf</code> 的文件：</p><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span>
<span class="hljs-attr">PrivateKey</span> = &lt;私钥&gt;
<span class="hljs-attr">ListenPort</span> = &lt;监听端口&gt;
<span class="hljs-attr">PostUp</span>     = ip address add &lt;链路本地地址&gt;/<span class="hljs-number">64</span> dev %i
<span class="hljs-attr">PostUp</span>     = ip addr add &lt;本地 IPv6 地址&gt;/<span class="hljs-number">128</span> peer &lt;对端 IPv6 地址&gt;/<span class="hljs-number">128</span> dev %i
<span class="hljs-attr">PostUp</span>     = ip addr add &lt;本地 IPv4 地址&gt;/<span class="hljs-number">32</span> peer &lt;对端 IPv4 地址&gt;/<span class="hljs-number">32</span> dev %i
<span class="hljs-attr">Table</span>      = <span class="hljs-literal">off</span></code></pre><ul><li><code>PrivateKey</code> ：私钥。</li><li><code>ListenPort</code> ：监听端口。</li><li>第一个 <code>PostUp</code> ：（可选，推荐）添加链路本地地址。</li><li>第二个 <code>PostUp</code> ：（可选）添加本地和对等端的 DN42 IPv6 地址。</li><li>第三个 <code>PostUp</code> ：（可选）添加本地和对等端的 DN42 IPv4 地址。</li><li><code>Table</code> ：必须设定为 <code>off</code> （不导入系统路由表），否则会导致系统断网。</li></ul><p>当使用链路本地地址建立 BGP 会话时，可以不设置 DN42 IPv4 和 DN42 IPv6 地址，但是机器上必须有一张网卡上绑定了本机的 DN42 IPv4 和 DN42 IPv6 地址。同理，如果不使用链路本地地址建立 BGP 会话则无需添加链路本地地址。</p><pre><code class="hljs ini"><span class="hljs-section">[Peer]</span>
<span class="hljs-attr">PublicKey</span>           = &lt;对端公钥&gt;
<span class="hljs-attr">PresharedKey</span>        = &lt;对端预共享密钥&gt;
<span class="hljs-attr">Endpoint</span>            = &lt;对端 IP/域名 和 端口号&gt;
<span class="hljs-attr">PersistentKeepalive</span> = <span class="hljs-number">30</span>
<span class="hljs-attr">AllowedIPs</span>          = <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span>, <span class="hljs-number">172.20</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">14</span>, <span class="hljs-number">172.31</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span>, fd00::/<span class="hljs-number">8</span>, fe80::/<span class="hljs-number">64</span></code></pre><ul><li><code>PublicKey</code> ：对端公钥。</li><li><code>PresharedKey</code> ：（可选）对端预共享密钥。</li><li><code>Endpoint</code> ：（可选）对端的连接域名/IP 及端口号。<br>如果对端没有公网 IP 地址，需要本地设置为被动模式则无需填写此项。</li><li><code>PersistentKeepalive</code> ：（可选）每隔多少秒发送一次握手信息防止连接被中断并更新对端 IP 。<br>如果本地没有公网 IP 地址，必须配置此项。</li><li><code>AllowedIPs</code> ：允许使用 WireGuard 转发流量的 IP 地址段。</li></ul><p>之后使用 <code>wg-quick up &lt;隧道名&gt;</code> 来启动隧道即可。</p><p>如需开机自启，可以在测试无误后执行 <code>systemctl enable wg-quick@&lt;隧道名&gt;</code> 。</p><h3 id="检测隧道状态">检测隧道状态</h3><pre><code class="hljs bash">wg show &lt;隧道名&gt;</code></pre><p>使用该命令即可查看隧道状态。</p><p><img src="https://s1.baoshuo.ren/2021/08/16/wxgUJNHnQAXFMdS.png" alt="" loading="lazy"></p><p>如上图所示，当 <code>latest handshake</code> 时间较近且 <code>transfer</code> 有收有发时可以认为隧道正常。</p><p>如需查看所有隧道的状态，直接使用 <code>wg</code> 命令即可。</p><h2 id="与其他网络进行对等互联">与其他网络进行对等互联</h2><h3 id="系统配置">系统配置</h3><p>在 DN42 网络中，没有绝对意义上的客户端，每个人都可能是他人的路由器，经常会出现数据包的来源网卡与回复使用的网卡不一致的情况，因此需要打开 Linux 内核的数据包转发功能，具体操作如下：</p><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.ip_forward=1"</span> &gt;&gt; /etc/sysctl.conf
<span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv6.conf.default.forwarding=1"</span> &gt;&gt; /etc/sysctl.conf
<span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv6.conf.all.forwarding=1"</span> &gt;&gt; /etc/sysctl.conf
sysctl -p</code></pre><p>同时，也需要关闭 Linux 内核的 <code>rp_filter</code> 的严格模式，具体操作如下：</p><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.conf.default.rp_filter=0"</span> &gt;&gt; /etc/sysctl.conf
<span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.conf.all.rp_filter=0"</span> &gt;&gt; /etc/sysctl.conf
sysctl -p</code></pre><p>除此之外，还需要关闭一些自动化的配置 iptables 防火墙的工具，如 UFW 。</p><h3 id="搭建-wireguard-隧道-2">搭建 WireGuard 隧道</h3><p>请参考 <a href="#DN42-WireGuard-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8">DN42 WireGuard 使用入门</a> 一节。</p><h3 id="配置-bgp-会话">配置 BGP 会话</h3><p>在 <code>/etc/bird/peers</code> 目录下新建一个文件，命名为 <code>&lt;名字&gt;.conf</code> 。</p><p>如果使用链路本地地址进行 Peer 的话，需要按照下面的配置示例进行配置：</p><pre><code class="hljs bird">protocol bgp &lt;名字&gt; from dnpeers {
    neighbor &lt;对端链路本地地址&gt; % '&lt;对端 WireGuard 隧道名&gt;' as &lt;对端 ASN&gt;;
    source address &lt;本地的链路本地地址&gt;;
}</code></pre><p>否则按照下面的配置示例进行配置：</p><pre><code class="hljs bird">protocol bgp &lt;名字&gt; from dnpeers {
    neighbor &lt;对端 IPv6 地址&gt; as &lt;对端 ASN&gt;;
}</code></pre><p>然后使用 <code>birdc configure</code> 重载配置即可。</p><h2 id="更新日志">更新日志</h2><ul><li>2021-04-04 第一版 <sup>（2021 年 8 月 10 日存档于 <a href="https://web.archive.org/web/20210810062825/https://blog.baoshuo.ren/post/dn42-network/" rel="external nofollow noreferrer">互联网档案馆</a>）</sup></li><li>2021-08-14 第二版</li></ul><h2 id="参考资料-6">参考资料</h2><ol><li><a href="https://dn42.dev/howto/Getting-Started" rel="external nofollow noreferrer">Getting Started - DN42 Wiki</a></li><li><a href="https://git.dn42.dev/dn42/registry/src/branch/master/README.md" rel="external nofollow noreferrer">Guide for creating a Pull Request - dn42/registry - DN42 Git</a></li><li><a href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/" rel="external nofollow noreferrer">DN42 实验网络介绍及注册教程（2020-10-01 更新） - Lan Tian @ Blog</a></li><li><a href="https://datatracker.ietf.org/" rel="external nofollow noreferrer">IETF Datatracker</a></li><li><a href="https://en.wikipedia.org/wiki/Unique_local_address" rel="external nofollow noreferrer">Unique local address - Wikipedia</a></li><li><a href="https://github.com/moesoha/bird-bgp-kickstart" rel="external nofollow noreferrer">BIRD 与 BGP 的新手开场 - Soha Jin - GitHub</a></li></ol></section><div class="cjScYX jnGacs kpCrIt bMSzLf cvPkWa iigETV dUvWpK hRLVFh "><div class="bpQkXn ">初探 DN42 网络</div><div><a class="kpaoc dLUwcr gcQrEv cdhcuu " href="/post/dn42-network/">https://blog.baoshuo.ren/post/dn42-network/</a></div><div class="gSBWlu kiDYix cUXNmd "><div class="gSBWlu iMkoWi hriXhD jjryqL biWxPv "><div class="chVqDG ">本文作者</div><div><a class="fyuAJJ bbUXPo cdhcuu " href="https://baoshuo.ren" target="_blank">宝硕</a></div></div><div class="gSBWlu iMkoWi hriXhD jjryqL biWxPv "><div class="chVqDG ">发布于</div><time datetime="2021-04-04T03:29:32.000Z">2021-04-04</time></div><div class="gSBWlu iMkoWi hriXhD jjryqL biWxPv "><div class="chVqDG ">更新于</div><time>2021-08-18</time></div><div class="gSBWlu iMkoWi hriXhD jjryqL biWxPv "><div class="chVqDG ">版权协议</div><div><a class="fyuAJJ bbUXPo cdhcuu " href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.zh-Hans" target="_blank" rel="license noopener noreferrer">CC BY-NC-SA 4.0</a></div></div></div><div class="chVqDG ">转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！</div><i class="cpOcAb bEvNbr eLDTYY iRjWhb QcCvg jdKAzd krZeLX gjJDYK dZDNG gMDOZu cgEEZJ gqWyNB ktfQGr FwRrA cDIyHz hpBjJb ycSPk ctWdVF jkGfDR bSTogt hSDpeY julXB kvHVCE lpnDDz ebRqqn bWKMJW eQlDDM kSnqYR fgiDpI eeAUEW ecjlX cDxIqC jpWidM jzdNVF bPkdhG bnSwfb fQfkux dPenaT NpaJd jgAayQ fqXcHQ dyMCpl jMYtKl blQfIT lijgUQ ccSWYO eGyfkC hhBXzE iyXZtO jZLyOQ beJoMJ iJgiCW hqUHPA jWWlrr hZGkn chpxwD beuMzX dbtvqd jPcnDC "></i></div><div class="kroOag icKiSN bMSzLf fZMRmg iigETV "><a class="kpaoc bbUXPo dSxtaa cdhcuu " href="/tags/BGP/"># <!-- -->BGP</a><a class="kpaoc bbUXPo dSxtaa cdhcuu " href="/tags/DN42/"># <!-- -->DN42</a></div></article><div class="gCwvuy kRQsoY jBvrhX dgtTIu eXJtsk dvivnl llUCyD dPAasc icKiSN bMSzLf fZMRmg iigETV ipEZTh eRVtDl cUXNmd jdraHW biWxPv eqrBPF kooHYa kroOag"><div>喜欢这篇文章？为什么不考虑打赏一下作者呢？</div><a class="cyerGB moyUB lexxaO ebVilo kyhYEz jIkFRm gpptow bbUXPo kMKXDC ftIldC jOeduE iDuqPI cpOcAb eAOGpx " href="https://afdian.net/@baoshuo" target="_blank" rel="noopener noreferrer">爱发电</a></div><div class="gSBWlu ipEZTh eRVtDl cUXNmd jdraHW biWxPv eqrBPF gvwkfp bRNbBj"><div class="gSBWlu dQPgRK eKlQYW bLlOeF fPWmiY hmKFEM "><a class="gSBWlu foGVKH dgIPcR kVZHcH cVJMrm iATxZH JxWnH " href="/post/bird-looking-glass/"><i class="dSxtaa bLHLvQ eLDTYY cjScYX cpOcAb jXmXEB hHGIsI julXB kvHVCE jbzBdl SeaTL gjJuRC iWYpgm iHkzF kSnqYR fgiDpI eeAUEW ecjlX fIXfpL ergVCo cqyuit hCTuXM "></i>搭建 BIRD Looking Glass 速成指北</a></div><div class="gSBWlu dQPgRK eKlQYW bLlOeF fXzCvR klEWBS "><a class="gSBWlu foGVKH dgIPcR kVZHcH cVJMrm iATxZH JxWnH " href="/post/my-own-asn/">年轻人的第一个 ASN<i class="kUPESX bLHLvQ eLDTYY cjScYX cpOcAb jXmXEB hHGIsI julXB kvHVCE jbzBdl gUiFRX dixaxG jmWgOv bTanCN kSnqYR fgiDpI eeAUEW ecjlX fIXfpL ergVCo cqyuit hCTuXM "></i></a></div></div><div></div></main></div><div class="imhmwA sKExc bjOGUo eSaSrN "><div class="fyuAJJ kQBRAp bcfNhz edKxdA osxXp foquGP lhTVEC kRQsoY jBvrhX dgtTIu eXJtsk cyerGB egGyMq jsvbrX dPAasc "><i class="cpOcAb cjScYX hHGIsI jXmXEB bLHLvQ eLDTYY dhOkuk julXB hCTuXM cqyuit kvHVCE SeaTL kSnqYR jFCJJY iqzSxf bQvqKh "></i></div><a class="fyuAJJ kQBRAp bcfNhz edKxdA osxXp foquGP lhTVEC kRQsoY jBvrhX dgtTIu eXJtsk cyerGB egGyMq jsvbrX dPAasc " href="#"><i class="cpOcAb cjScYX hHGIsI jXmXEB bLHLvQ eLDTYY dhOkuk julXB hCTuXM cqyuit kvHVCE kSnqYR fgiDpI eeAUEW ecjlX SeaTL gjJuRC iWYpgm iHkzF ergVCo jbBqfU fIXfpL "></i></a></div><footer class="eGElBa ftIldC eBrwtd iDuqPI kpaoc gCwvuy kooHYa eAOGpx dPAasc kKplrA jzScEz hMoAFf bccxkr cgjdEA "><div class="kQBRAp kroOag jZOgvY uUxpw "><div>Copyright © 2019 - <!-- -->2022<!-- --> <a class="fyuAJJ jSOKOm cdhcuu kOZsAO " href="/">宝硕博客</a><span class="jTjNVR iawFZL hNjeNG kswRdL gKQCBv "></span><a class="fyuAJJ jSOKOm cdhcuu kOZsAO " href="https://beian.miit.gov.cn" target="_blank" rel="noopener noreferer nofollow">冀ICP备15024669号-3</a></div><div>Powered by<!-- --> <a class="laXLGQ jSOKOm cdhcuu " href="https://nextjs.org" target="_blank" rel="noopener noreferer nofollow">Next.js</a> &amp; <a class="laXLGQ jSOKOm cdhcuu " href="https://hexo.io" target="_blank" rel="noopener noreferer nofollow">Hexo</a><span class="jTjNVR iawFZL hNjeNG kswRdL gKQCBv "></span>Theme by<!-- --> <a class="laXLGQ jSOKOm cdhcuu " href="https://baoshuo.ren" target="_blank">Baoshuo</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"初探 DN42 网络 - 宝硕博客","post":{"title":"初探 DN42 网络","excerpt":"DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 BGP 网络。DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。","content":[["$","p",{},["DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 BGP 网络。DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。"]],["$","span",{"id":"more"},[]],["$","p",{},["DN42 适合以下类别的用户："]],["$","ul",{},[["$","li",{},["想要研究网络技术，练习服务器、路由器等网络设备配置，甚至后续在真实互联网建立 AS 的用户。"]],["$","li",{},["已经拥有真实 AS ，但担心自己",["$","a",{"href":"https://blog.cloudflare.com/how-verizon-and-a-bgp-optimizer-knocked-large-parts-of-the-internet-offline-today/","rel":"external nofollow noreferrer"},["配置错误广播出错误路由、干掉半个互联网"]],"，希望有个地方测试的用户。"]]]],["$","p",{},["DN42 不适合以下类别的用户："]],["$","ul",{},[["$","li",{},["单纯想要保护隐私、规避网络审查的用户"]],["$","li",{},["在网内消耗大量流量，例如用于解锁流媒体服务的用户"]]]],["$","p",{},["所以，DN42 的使用门槛还是比较高的。这与在真实互联网中一样，你要扮演一个 ISP （互联网服务提供商），注册自己的个人信息， ASN 号码，IPv4 和 IPv6 的地址池，并且使用 BGP 在自己的服务器上广播它们。你还要和其它的用户联系，和他们进行 Peering（对等互联），一步步进入完整的 DN42 网络。"]],["$","hr",{},[]],["$","p",{},["DN42 在 ",["$","code",{},["172.20.0.0/14"]]," 和 ",["$","code",{},["fd00::/8"]]," 上运行，而这两个 IP 段都是分配给内网使用的。换句话说，你在 DN42 上怎么折腾，都不会影响到服务器其它的互联网连接。"]],["$","p",{},["你可以通过加入 ",["$","a",{"href":"https://t.me/Dn42Chat","rel":"external nofollow noreferrer"},["Telegram 群组"]]," 或者 ",["$","a",{"href":"irc://irc.hackint.org/#dn42","rel":"external nofollow noreferrer"},["IRC 频道"]]," 来寻求帮助。"]],["$","p",{},["请注意，DN42 是一个测试网络，所有人都在帮助所有人。即使你不小心搞砸了，也没有人会指责你。"]],["$","p",{},["欢迎在搭建完成自己的内网以后与我进行对等互联，可以访问 ",["$","a",{"href":"https://dn42.baoshuo.ren","rel":"external nofollow noreferrer"},["dn42.baoshuo.ren"]]," 获取更多信息。"]],["$","p",{},["若无特别说明，本文中所使用的系统环境均为 ",["$","code",{},["Ubuntu 20.04.2 LTS"]]," ，本文中所有使用 ",["$","code",{},["\u003c\u003e"]]," 包裹的内容均需要自行替换。"]],["$","h2",{"id":"注册-dn42"},["注册 DN42"]],["$","p",{},["在注册过程中会大量使用到一些 UNIX 工具（如 Git 、 GPG 等），所以最好使用 Linux 或者 macOS 系统完成整个流程，如果你正在使用 Windows 系统，那么可以使用 ",["$","a",{"href":"http://aka.ms/wsl","rel":"external nofollow noreferrer"},["WSL"]]," 。"]],["$","h3",{"id":"注册前的准备"},["注册前的准备"]],["$","ul",{},[["$","li",{},["了解如何编写 RPSL （",["$","a",{"href":"https://tools.ietf.org/html/rfc2622/","rel":"external nofollow noreferrer"},["RFC2622"]],"） 格式的配置文件。"]],["$","li",{},["了解如何使用 ",["$","a",{"href":"https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1","rel":"external nofollow noreferrer"},["CIDR"]]," （",["$","a",{"href":"https://tools.ietf.org/html/rfc1518","rel":"external nofollow noreferrer"},["RFC1518"]],"，",["$","a",{"href":"https://tools.ietf.org/html/rfc1519","rel":"external nofollow noreferrer"},["RFC1519"]],"） 格式表示 IP 地址块。"]],["$","li",{},["熟悉 ",["$","a",{"href":"https://dn42.dev","rel":"external nofollow noreferrer"},["DN42 Wiki"]]," 中的 ",["$","a",{"href":"https://dn42.dev/howto/Getting-Started","rel":"external nofollow noreferrer"},["Getting-Started"]]," 、 ",["$","a",{"href":"https://dn42.dev/howto/Address-Space","rel":"external nofollow noreferrer"},["Address Space"]]," 页面中的内容。"]],["$","li",{},["在 ",["$","a",{"href":"https://git.dn42.dev","rel":"external nofollow noreferrer"},["DN42 Git"]]," 中有一个注册好的账户。"]],["$","li",{},["会使用英文与他人交流。"]]]],["$","h3",{"id":"克隆-dn42-注册表-git-仓库"},["克隆 DN42 注册表 Git 仓库"]],["$","p",{},["将 ",["$","a",{"href":"https://git.dn42.dev/dn42/registry","rel":"external nofollow noreferrer"},["dn42/registry"]]," 这个仓库 clone 到本地。"]],["$","p",{},["新建一个名为 ",["$","code",{},["\u003c用户名\u003e-\u003c日期, YYYYMMDD\u003e/\u003c自定义名称\u003e"]]," 的分支。"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["git checkout -b \u003c用户名\u003e-\u003c日期, YYYYMMDD\u003e/register"]]]],["$","h3",{"id":"注册维护者"},["注册维护者"]],["$","p",{},["在仓库的 ",["$","code",{},["data/mntner"]]," 目录下新建一个文件，命名为 ",["$","code",{},["\u003c昵称\u003e-MNT"]]," 。"]],["$","p",{},["文件内填入以下内容："]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["mntner:             \u003c昵称\u003e-MNT\nadmin-c:            \u003c昵称\u003e-DN42\ntech-c:             \u003c昵称\u003e-DN42\nauth:               \u003c身份验证信息\u003e\nmnt-by:             \u003c维护者\u003e\nsource:             DN42"]]]],["$","p",{},["示例：",["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/data/mntner/BAOSHUO-MNT","rel":"external nofollow noreferrer"},[["$","code",{},["data/mntner/BAOSHUO-MNT"]]," at dn42/registry@master"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["mntner"]]," ：维护者（全称为 Maintainer），这个维护者的名称，与文件名相同。"]],["$","li",{},[["$","code",{},["admin-c"]]," ：管理员联系信息（Admin Contact），需要指向 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中的 ",["$","code",{},["person"]]," 文件，一般为 ",["$","code",{},["\u003c昵称\u003e-DN42"]]," 。"]],["$","li",{},[["$","code",{},["tech-c"]]," ：技术人员联系信息（Tech Contact），需要指向 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中的 ",["$","code",{},["person"]]," 文件，一般为 ",["$","code",{},["\u003c昵称\u003e-DN42"]]," 。"]],["$","li",{},[["$","code",{},["auth"]]," ：身份验证信息，接受 ",["$","strong",{},["GPG 公钥"]]," 和 ",["$","strong",{},["SSH 公钥"]]," ，可以查看 ",["$","a",{"href":"https://dn42.dev/howto/Registry-Authentication","rel":"external nofollow noreferrer"},["Registry Authentication"]]," 页面获取详细信息。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（全称为 Maintain by），此处需要指向这个维护者本身，即 ",["$","code",{},["\u003c昵称\u003e-MNT"]]," 。"]],["$","li",{},[["$","code",{},["source"]]," ：信息来源，默认为 ",["$","code",{},["DN42"]]," 。"]]]],["$","h3",{"id":"注册联系人"},["注册联系人"]],["$","p",{},["在仓库的 ",["$","code",{},["data/person"]]," 目录下新建一个文件，命名为 ",["$","code",{},["\u003c昵称\u003e-DN42"]]," 。"]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["person:             \u003c姓名\u003e\ncontact:            \u003c邮箱\u003e\nnic-hdl:            \u003cNIC 句柄\u003e\nmnt-by:             \u003c维护者\u003e\nsource:             DN42"]]]],["$","p",{},["示例：",["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/data/person/BAOSHUO-DN42","rel":"external nofollow noreferrer"},[["$","code",{},["data/person/BAOSHUO-DN42"]]," at dn42/registry@master"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["person"]]," ：姓名。"]],["$","li",{},[["$","code",{},["contact"]]," ：联系方式，一般为邮箱。"]],["$","li",{},[["$","code",{},["nic-hdl"]]," ：NIC 句柄（即 ",["$","a",{"href":"https://en.wikipedia.org/wiki/NIC_handle","rel":"external nofollow noreferrer"},["NIC handle"]],"），指向文件本身，与文件名相同。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（全称为 Maintain by），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85"},["注册维护者"]]," 一节中注册的的维护者信息。"]],["$","li",{},[["$","code",{},["source"]]," ：固定为 ",["$","code",{},["DN42"]],"。"]]]],["$","h3",{"id":"注册-asn"},["注册 ASN"]],["$","p",{},["在国际互联网上，ASN 范围 ",["$","code",{},["4200000000 - 4294967294"]]," 是被保留以供私人使用的，而 DN42 占用的就是其中的一块： ",["$","code",{},["4242420000 - 4242429999"]]," 。目前 DN42 开放注册的 ASN 范围是 ",["$","code",{},["4242420000 - 4242423999"]]," ，只需要在这个区间里面挑一个没有被他人占用的号码即可。"]],["$","p",{},["DN42 Registry 的管理员 burble 提供了一个在线查看可用 ASN 的工具: ",["$","a",{"href":"https://explorer.burble.com/free#/asn","rel":"external nofollow noreferrer"},["DN42 Free ASN Explorer"]]," 。访问该页面就会随机生成 10 个当前还未注册的 ASN 以便使用。"]],["$","p",{},["在仓库的 ",["$","code",{},["data/aut-num"]]," 目录下新建一个文件，命名为刚才选中的 AS 号码。"]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["aut-num:            \u003cAS 号码, 带 AS 前缀\u003e\nas-name:            \u003cAS 名称\u003e\ndescr:              \u003cAS 简介\u003e\nadmin-c:            \u003cNIC 句柄\u003e\ntech-c:             \u003cNIC 句柄\u003e\nmnt-by:             \u003c维护者\u003e\nsource:             DN42"]]]],["$","p",{},["示例：",["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/data/aut-num/AS4242420247","rel":"external nofollow noreferrer"},[["$","code",{},["data/aut-num/AS4242420247"]]," at dn42/registry@master"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["aut-num"]]," ：AS 号，此处可以使用私有 AS 号码，也可以使用公网 AS 号码（不推荐）。"]],["$","li",{},[["$","code",{},["as-name"]]," ：AS 的名称，可以设置为 ",["$","code",{},["\u003c昵称\u003e-AS"]]," 。"]],["$","li",{},[["$","code",{},["descr"]]," ：（选填）AS 简介，随意填写。"]],["$","li",{},[["$","code",{},["admin-c"]]," ：管理员联系信息（Admin Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["tech-c"]]," ：技术员联系信息（Tech Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（Maintain by），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85"},["注册维护者"]]," 一节中注册的的维护者信息。"]],["$","li",{},[["$","code",{},["source"]]," ：如果使用私有 AS 号码则此处填写 ",["$","code",{},["DN42"]]," ，否则填写 ASN 所对应的 RIR 名称。"]]]],["$","h3",{"id":"注册-ipv4-地址块"},["注册 IPv4 地址块"]],["$","p",{},[["$","em",{},["如果您想在 DN42 上创建一个 IPv6 Only 网络，请不要注册 IPv4 地址块，并忽略 ",["$","a",{"href":"#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E8%AE%B0%E5%BD%95"},["添加路由记录"]]," 一节中的 IPv4 部分。"]]]],["$","p",{},["在国际互联网上， ",["$","code",{},["172.16.0.0/12"]]," 是由 ",["$","a",{"href":"https://tools.ietf.org/html/rfc1918","rel":"external nofollow noreferrer"},["RFC1918"]]," 规定的由专用网络使用的 IP 地址块，而 DN42 占用的就是其中的一块： ",["$","code",{},["172.20.0.0/14"]]," 。目前 DN42 开放注册的地址块范围可以在 ",["$","a",{"href":"https://dn42.dev/howto/Address-Space#ipv4-address-space","rel":"external nofollow noreferrer"},["Address Space"]]," 页面上查看。"]],["$","p",{},["DN42 Registry 的管理员 burble 提供了一个在线查看可用 IPv4 地址块的网站，点击 ",["$","a",{"href":"https://explorer.burble.com/free#/4","rel":"external nofollow noreferrer"},["DN42 Free IPv4 Explorer"]]," 即可随机生成 10 个当前还未注册的 IPv4 地址块。"]],["$","p",{},["和在真实互联网上一样，DN42 的 IPv4 地址资源也是十分紧缺的，因此 IPv4 的申请原则是「够用就好」。如果节点数量足够少，只申请 ",["$","code",{},["/28"]]," 或 ",["$","code",{},["/29"]]," 大小的地址块就够用了。"]],["$","p",{},["在仓库的 ",["$","code",{},["data/inetnum"]]," 目录下新建一个文件，命名为 IP 地址块的 CIDR 格式，并使用 ",["$","code",{},["_"]]," 代替 ",["$","code",{},["/"]],"。"]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["inetnum:            \u003c起始 IP 地址\u003e - \u003c结束 IP 地址\u003e\ncidr:               \u003cIP 地址块的 CIDR 格式\u003e\nnetname:            \u003cIP 地址块名称\u003e\ndescr:              \u003cIP 地址块简介\u003e\ncountry:            \u003cIP 地址块所属国家\u003e\nadmin-c:            \u003cNIC 句柄\u003e\ntech-c:             \u003cNIC 句柄\u003e\nmnt-by:             \u003c维护者\u003e\nstatus:             ASSIGNED\nsource:             DN42"]]]],["$","p",{},["示例：",["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/data/inetnum/172.23.250.64_26","rel":"external nofollow noreferrer"},[["$","code",{},["data/inetnum/172.23.250.64_26"]]," at dn42/registry@master"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["inetnum"]]," ：这个地址块的范围。"]],["$","li",{},[["$","code",{},["cidr"]]," ：以 CIDR 格式表示的这个地址块的范围，含义与 ",["$","code",{},["inetnum"]]," 相同。"]],["$","li",{},[["$","code",{},["netname"]]," ：这个地址块的名称。可以设置为 ",["$","code",{},["\u003c昵称\u003e-IPV4"]]," 。"]],["$","li",{},[["$","code",{},["descr"]]," ：（选填）这个地址块的简介。"]],["$","li",{},[["$","code",{},["nserver"]]," ：（选填）IP 地址反向解析的 DNS 服务器。"]],["$","li",{},[["$","code",{},["country"]]," ：你的 ",["$","a",{"href":"https://zh.wikipedia.org/wiki/ISO_3166","rel":"external nofollow noreferrer"},["ISO 3166"]]," 国家代码，填 ",["$","code",{},["CN"]]," 代表中国大陆地区。"]],["$","li",{},[["$","code",{},["admin-c"]]," ：管理员联系信息（Admin Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["tech-c"]]," ：技术员联系信息（Tech Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（Maintain by），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85"},["注册维护者"]]," 一节中注册的的维护者信息。"]],["$","li",{},[["$","code",{},["status"]]," ：固定为 ",["$","code",{},["ASSIGNED"]],"。"]],["$","li",{},[["$","code",{},["source"]]," ：固定为 ",["$","code",{},["DN42"]],"。"]]]],["$","h3",{"id":"注册-ipv6-地址块"},["注册 IPv6 地址块"]],["$","p",{},["在国际互联网上， ",["$","code",{},["fc00::/7"]]," 是由 ",["$","a",{"href":"https://tools.ietf.org/html/rfc4193","rel":"external nofollow noreferrer"},["RFC4193"]]," 定义的 ",["$","a",{"href":"https://en.wikipedia.org/wiki/Unique_local_address","rel":"external nofollow noreferrer"},["唯一本地地址"]],"，而 DN42 占用的就是其中的一块： ",["$","code",{},["fd00::/8"]]," 。目前 DN42 开放注册的地址块范围可以在 ",["$","a",{"href":"https://dn42.dev/howto/Address-Space#ipv6-address-space","rel":"external nofollow noreferrer"},["Address Space"]]," 页面上查看。"]],["$","p",{},["DN42 Registry 的管理员 burble 提供了一个在线查看可用 IPv6 地址块的网站，点击 ",["$","a",{"href":"https://explorer.burble.com/free#/6","rel":"external nofollow noreferrer"},["DN42 Free IPv6 Explorer"]]," 即可随机生成 10 个当前还未注册的 IPv6 地址块。"]],["$","p",{},["在仓库的 ",["$","code",{},["data/inet6num"]]," 目录下新建一个文件，命名为 IPv6 地址块的 CIDR 格式，并使用 ",["$","code",{},["_"]]," 代替 ",["$","code",{},["/"]],"。"]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["inet6num:           \u003c起始 IPv6 地址\u003e - \u003c结束 IPv6 地址\u003e\ncidr:               \u003cIPv6 地址块的 CIDR 格式\u003e\nnetname:            \u003cIPv6 地址块名称\u003e\ndescr:              \u003cIPv6 地址块简介\u003e\ncountry:            \u003cIPv6 地址块所属国家\u003e\nadmin-c:            \u003cNIC 句柄\u003e\ntech-c:             \u003cNIC 句柄\u003e\nmnt-by:             \u003c维护者\u003e\nstatus:             ASSIGNED\nsource:             DN42"]]]],["$","p",{},["示例：",["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/data/inet6num/fd42:4242:247::_48","rel":"external nofollow noreferrer"},[["$","code",{},["data/inet6num/fd42:4242:247::_48"]]," at dn42/registry@master"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["inet6num"]]," ：这个地址块的范围。"]],["$","li",{},[["$","code",{},["cidr"]]," ：使用 CIDR 格式表示的这个地址块的范围，含义与 ",["$","code",{},["inet6num"]]," 相同。"]],["$","li",{},[["$","code",{},["netname"]]," ：这个地址块的名称。可以设置为 ",["$","code",{},["\u003c昵称\u003e-IPV6"]]," 。"]],["$","li",{},[["$","code",{},["descr"]]," ：（选填）这个地址块的简介。"]],["$","li",{},[["$","code",{},["nserver"]]," ：（选填）IP 地址反向解析的 DNS 服务器。"]],["$","li",{},[["$","code",{},["country"]]," ：你的 ",["$","a",{"href":"https://zh.wikipedia.org/wiki/ISO_3166","rel":"external nofollow noreferrer"},["ISO 3166"]]," 国家代码，填 ",["$","code",{},["CN"]]," 代表中国大陆地区。"]],["$","li",{},[["$","code",{},["admin-c"]]," ：管理员联系信息（Admin Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["tech-c"]]," ：技术员联系信息（Tech Contact），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E8%81%94%E7%B3%BB%E4%BA%BA"},["注册联系人"]]," 一节中注册的 NIC 句柄。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（Maintain by），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85"},["注册维护者"]]," 一节中注册的的维护者信息。"]],["$","li",{},[["$","code",{},["status"]]," ：固定为 ",["$","code",{},["ASSIGNED"]],"。"]],["$","li",{},[["$","code",{},["source"]]," ：固定为 ",["$","code",{},["DN42"]],"。"]]]],["$","h3",{"id":"添加路由记录"},["添加路由记录"]],["$","p",{},["在仓库的 ",["$","code",{},["data/route"]]," 目录下新建一个文件，命名为 IP 地址块的 CIDR 格式，并使用 ",["$","code",{},["_"]]," 代替 ",["$","code",{},["/"]],"。"]],["$","pre",{},[["$","code",{"class":"hljs rpsl"},["route:              \u003cIP 地址块的 CIDR 格式\u003e\ndescr:              \u003c简介\u003e\norigin:             \u003cAS 号码, 带 AS 前缀\u003e\nmnt-by:             \u003c维护者\u003e\nsource:             DN42"]]]],["$","ul",{},[["$","li",{},[["$","code",{},["route"]]," ：这个 IPv4 地址块的范围，CIDR 格式。"]],["$","li",{},[["$","code",{},["descr"]]," ：（选填）路由简介。"]],["$","li",{},[["$","code",{},["origin"]]," ：填写你的 AS 号码。"]],["$","li",{},[["$","code",{},["mnt-by"]]," ：由谁维护（Maintain by），指向你在 ",["$","a",{"href":"#%E6%B3%A8%E5%86%8C%E7%BB%B4%E6%8A%A4%E8%80%85"},["注册维护者"]]," 一节中注册的的维护者信息。"]],["$","li",{},[["$","code",{},["source"]]," ：固定为 ",["$","code",{},["DN42"]],"。"]]]],["$","p",{},["如需添加 IPv6 路由，将本节所述的 ",["$","code",{},["route"]]," 改为 ",["$","code",{},["route6"]]," 即可，此处不再赘述。"]],["$","h3",{"id":"上传更改到-dn42-注册表"},["上传更改到 DN42 注册表"]],["$","p",{},["完成以上步骤之后，使用 ",["$","code",{},["git diff"]]," 查看文件变动，检查无误后，使用 ",["$","code",{},["git add ."]]," 暂存。"]],["$","p",{},[["$","img",{"src":"https://s1.baoshuo.ren/2021/08/14/RhjwYHFGcaKUSye.png","alt":"","loading":"lazy"},[]]]],["$","p",{},["运行仓库根目录下的 ",["$","code",{},["./check-my-stuff \u003c维护者\u003e"]]," 检查文件内容是否有误，确定无误后，提交。"]],["$","p",{},["在提交时，如果需要使用 GPG 签名，需要在添加 ",["$","code",{},["-S"]]," 参数，如 ",["$","code",{},["git commit -S"]]," ；如果使用 SSH 签名，请直接使用 ",["$","code",{},["git commit"]]," 进行提交，待提交后再进行签名工作。"]],["$","p",{},["使用下面的命令进行签名："]],["$","pre",{},[["$","code",{"class":"hljs bash"},["./sign-my-commit --ssh --key \u003cSSH 私钥文件\u003e \u003c维护者\u003e"]]]],["$","p",{},["之后使用下面的命令上传即可："]],["$","pre",{},[["$","code",{"class":"hljs bash"},["git push --set-upstream origin \u003c用户名\u003e-\u003c日期, YYYYMMDD\u003e/register"]]]],["$","p",{},[["$","img",{"src":"https://s1.baoshuo.ren/2021/04/04/1YwNjs8uvOJMFoq.png","alt":"","loading":"lazy"},[]]]],["$","p",{},["上传后在 DN42 Git 中切换到自己的分支，并创建一个合并请求，等待管理员审核。"]],["$","h3",{"id":"注意事项"},["注意事项"]],["$","ol",{},[["$","li",{},["各个项目的键和值之间有一长串空格，键、冒号与空格的总长度必须是 20 个字符，且不能随意修改。为了编辑时的方便，注册表中提供了一个脚本 ",["$","code",{},["fmt-my-stuff"]]," ，只需要使用 ",["$","code",{},["./fmt-my-stuff \u003c维护者\u003e"]]," 即可自动完成此步骤。"]],["$","li",{},["DN42 Registry 的工作语言是英语。请使用英语完成全部流程，以免出现不必要的麻烦。"]],["$","li",{},["请认真对待管理员提出的更改请求，按照要求完成全部修改后直接上传到原分支下即可，无需再新开合并请求。"]],["$","li",{},["推荐使用随机的 IPv4 与 IPv6 地址块，避免与其他网络重复。请明白，DN42 并不是这些网络资源的权威注册机构。"]]]],["$","h2",{"id":"dn42-bird2-使用入门"},["DN42 BIRD2 使用入门"]],["$","p",{},["如无特别说明，本部分中所使用的 BIRD 版本为 ",["$","code",{},["2.0.7"]]," 。"]],["$","h3",{"id":"安装-bird2"},["安装 BIRD2"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["apt update\napt install bird2 -y"]]]],["$","p",{},["一般情况下，执行此命令即可自动安装 BIRD2 并启动系统服务。"]],["$","h3",{"id":"编写-bird-配置文件"},["编写 BIRD 配置文件"]],["$","p",{},["对于刚刚加入 DN42 网络的新人来说，推荐使用 ",["$","a",{"href":"https://dn42.dev/howto/Bird2#example-configuration","rel":"external nofollow noreferrer"},["howto/Bird2 - DN42 Wiki"]]," 中的示例配置以节省配置时间。"]],["$","p",{},["这套配置默认使用了 Multi Protocol BGP ，如果不想使用此功能请自行编写配置文件，如果没有 DN42 IPv4 地址需要去掉文件中的 IPv4 部分。"]],["$","p",{},["将以下配置写入到 ",["$","code",{},["/etc/bird/bird.conf"]]," 中："]],["$","pre",{},[["$","code",{"class":"hljs pgsql"},["define OWNAS       = \u003c",["$","span",{"class":"hljs-keyword"},["AS"]]," 号\u003e;\ndefine OWNIP       = \u003cDN42 IPv4 地址\u003e;\ndefine OWNIPv6     = \u003cDN42 IPv6 地址\u003e;\ndefine OWNNET      = \u003cDN42 IPv4 地址块, ",["$","span",{"class":"hljs-type"},["CIDR"]]," 格式\u003e;\ndefine OWNNETv6    = \u003cDN42 IPv6 地址块, ",["$","span",{"class":"hljs-type"},["CIDR"]]," 格式\u003e;\ndefine OWNNETSET   = [ \u003cDN42 IPv4 地址块, ",["$","span",{"class":"hljs-type"},["CIDR"]]," 格式\u003e+ ];\ndefine OWNNETSETv6 = [ \u003cDN42 IPv6 地址块, ",["$","span",{"class":"hljs-type"},["CIDR"]]," 格式\u003e+ ];\n\nrouter id OWNIP;\n\nprotocol device {\n    scan ",["$","span",{"class":"hljs-type"},["time"]]," ",["$","span",{"class":"hljs-number"},["10"]],";\n}\n\n",["$","span",{"class":"hljs-keyword"},["function"]]," is_self_net() {\n    ",["$","span",{"class":"hljs-keyword"},["return"]]," net ~ OWNNETSET;\n}\n\n",["$","span",{"class":"hljs-keyword"},["function"]]," is_self_net_v6() {\n    ",["$","span",{"class":"hljs-keyword"},["return"]]," net ~ OWNNETSETv6;\n}\n\n",["$","span",{"class":"hljs-keyword"},["function"]]," is_valid_network() {\n    ",["$","span",{"class":"hljs-keyword"},["return"]]," net ~ [\n        ",["$","span",{"class":"hljs-number"},["172.20"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["14"]],"{",["$","span",{"class":"hljs-number"},["21"]],",",["$","span",{"class":"hljs-number"},["29"]],"}, # dn42\n        ",["$","span",{"class":"hljs-number"},["172.20"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["24"]],"{",["$","span",{"class":"hljs-number"},["28"]],",",["$","span",{"class":"hljs-number"},["32"]],"}, # dn42 Anycast\n        ",["$","span",{"class":"hljs-number"},["172.21"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["24"]],"{",["$","span",{"class":"hljs-number"},["28"]],",",["$","span",{"class":"hljs-number"},["32"]],"}, # dn42 Anycast\n        ",["$","span",{"class":"hljs-number"},["172.22"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["24"]],"{",["$","span",{"class":"hljs-number"},["28"]],",",["$","span",{"class":"hljs-number"},["32"]],"}, # dn42 Anycast\n        ",["$","span",{"class":"hljs-number"},["172.23"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["24"]],"{",["$","span",{"class":"hljs-number"},["28"]],",",["$","span",{"class":"hljs-number"},["32"]],"}, # dn42 Anycast\n        ",["$","span",{"class":"hljs-number"},["172.31"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["16"]],"+,       # ChaosVPN\n        ",["$","span",{"class":"hljs-number"},["10.100"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["14"]],"+,       # ChaosVPN\n        ",["$","span",{"class":"hljs-number"},["10.127"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["16"]],"{",["$","span",{"class":"hljs-number"},["16"]],",",["$","span",{"class":"hljs-number"},["32"]],"}, # neonetwork\n        ",["$","span",{"class":"hljs-number"},["10.0"]],["$","span",{"class":"hljs-number"},[".0"]],["$","span",{"class":"hljs-number"},[".0"]],"/",["$","span",{"class":"hljs-number"},["8"]],"{",["$","span",{"class":"hljs-number"},["15"]],",",["$","span",{"class":"hljs-number"},["24"]],"}     # Freifunk.net\n    ];\n}\n\nroa4 ",["$","span",{"class":"hljs-keyword"},["table"]]," dn42_roa;\nroa6 ",["$","span",{"class":"hljs-keyword"},["table"]]," dn42_roa_v6;\n\nprotocol static {\n    roa4 { ",["$","span",{"class":"hljs-keyword"},["table"]]," dn42_roa; };\n    ",["$","span",{"class":"hljs-keyword"},["include"]]," \"/etc/bird/roa_dn42.conf\";\n};\n\nprotocol static {\n    roa6 { ",["$","span",{"class":"hljs-keyword"},["table"]]," dn42_roa_v6; };\n    ",["$","span",{"class":"hljs-keyword"},["include"]]," \"/etc/bird/roa_dn42_v6.conf\";\n};\n\n",["$","span",{"class":"hljs-keyword"},["function"]]," is_valid_network_v6() {\n  ",["$","span",{"class":"hljs-keyword"},["return"]]," net ~ [\n    fd00::/",["$","span",{"class":"hljs-number"},["8"]],"{",["$","span",{"class":"hljs-number"},["44"]],",",["$","span",{"class":"hljs-number"},["64"]],"} # ULA address space ",["$","span",{"class":"hljs-keyword"},["as"]]," per RFC ",["$","span",{"class":"hljs-number"},["4193"]],"\n  ];\n}\n\nprotocol kernel {\n    scan ",["$","span",{"class":"hljs-type"},["time"]]," ",["$","span",{"class":"hljs-number"},["20"]],";\n\n    ipv6 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["none"]],";\n        export ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," source = RTS_STATIC ",["$","span",{"class":"hljs-keyword"},["then"]]," reject;\n            krt_prefsrc = OWNIPv6;\n            accept;\n        };\n    };\n};\n\nprotocol kernel {\n    scan ",["$","span",{"class":"hljs-type"},["time"]]," ",["$","span",{"class":"hljs-number"},["20"]],";\n\n    ipv4 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["none"]],";\n        export ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," source = RTS_STATIC ",["$","span",{"class":"hljs-keyword"},["then"]]," reject;\n            krt_prefsrc = OWNIP;\n            accept;\n        };\n    };\n}\n\nprotocol static {\n    route OWNNET reject;\n\n    ipv4 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["all"]],";\n        export ",["$","span",{"class":"hljs-keyword"},["none"]],";\n    };\n}\n\nprotocol static {\n    route OWNNETv6 reject;\n\n    ipv6 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["all"]],";\n        export ",["$","span",{"class":"hljs-keyword"},["none"]],";\n    };\n}\n\n",["$","span",{"class":"hljs-keyword"},["template"]]," bgp dnpeers {\n    ",["$","span",{"class":"hljs-keyword"},["local"]]," ",["$","span",{"class":"hljs-keyword"},["as"]]," OWNAS;\n    ",["$","span",{"class":"hljs-type"},["path"]]," metric ",["$","span",{"class":"hljs-number"},["1"]],";\n\n    ipv4 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," is_valid_network() \u0026\u0026 !is_self_net() ",["$","span",{"class":"hljs-keyword"},["then"]]," {\n                ",["$","span",{"class":"hljs-keyword"},["if"]]," (roa_check(dn42_roa, net, bgp_path.last) != ROA_VALID) ",["$","span",{"class":"hljs-keyword"},["then"]]," {\n                    print \"[dn42] ROA check failed for \", net, \" ASN \", bgp_path.last;\n                    reject;\n                }\n                accept;\n            }\n            reject;\n        };\n\n        export ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," is_valid_network() \u0026\u0026 source ~ [RTS_STATIC, RTS_BGP] ",["$","span",{"class":"hljs-keyword"},["then"]]," accept;\n            reject;\n        };\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["limit"]]," ",["$","span",{"class":"hljs-number"},["1000"]]," action block;\n    };\n\n    ipv6 {\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," is_valid_network_v6() \u0026\u0026 !is_self_net_v6() ",["$","span",{"class":"hljs-keyword"},["then"]]," {\n                ",["$","span",{"class":"hljs-keyword"},["if"]]," (roa_check(dn42_roa_v6, net, bgp_path.last) != ROA_VALID) ",["$","span",{"class":"hljs-keyword"},["then"]]," {\n                    print \"[dn42] ROA check failed for \", net, \" ASN \", bgp_path.last;\n                    reject;\n                }\n                accept;\n            }\n            reject;\n        };\n        export ",["$","span",{"class":"hljs-keyword"},["filter"]]," {\n            ",["$","span",{"class":"hljs-keyword"},["if"]]," is_valid_network_v6() \u0026\u0026 source ~ [RTS_STATIC, RTS_BGP] ",["$","span",{"class":"hljs-keyword"},["then"]]," accept;\n            reject;\n        };\n        ",["$","span",{"class":"hljs-keyword"},["import"]]," ",["$","span",{"class":"hljs-keyword"},["limit"]]," ",["$","span",{"class":"hljs-number"},["1000"]]," action block;\n    };\n}\n\n\n",["$","span",{"class":"hljs-keyword"},["include"]]," \"/etc/bird/peers/*\";"]]]],["$","p",{},["然后在 ",["$","code",{},["/etc/bird"]]," 目录下创建一个文件夹，命名为 ",["$","code",{},["peers"]]," ，以便后续存储配置文件使用。"]],["$","p",{},["如果想更深入的学习如何编写 BIRD 配置文件，推荐查看 ",["$","a",{"href":"https://github.com/moesoha/bird-bgp-kickstart","rel":"external nofollow noreferrer"},["BIRD 与 BGP 的新手开场"]]," 和 ",["$","a",{"href":"https://bird.network.cz/?get_doc\u0026f=bird.html\u0026v=20","rel":"external nofollow noreferrer"},["BIRD 官方文档"]]," 。"]],["$","h3",{"id":"下载-roa-配置文件"},["下载 ROA 配置文件"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["wget -4 -O /tmp/dn42_roa.conf https://dn42.burble.com/roa/dn42_roa_bird2_4.conf \u0026\u0026 ",["$","span",{"class":"hljs-built_in"},["mv"]]," -f /tmp/dn42_roa.conf /etc/bird/dn42_roa.conf\nwget -4 -O /tmp/dn42_roa_v6.conf https://dn42.burble.com/roa/dn42_roa_bird2_6.conf \u0026\u0026 ",["$","span",{"class":"hljs-built_in"},["mv"]]," -f /tmp/dn42_roa_v6.conf /etc/bird/dn42_roa_v6.conf"]]]],["$","p",{},["使用此命令即可将 ROA 文件下载到本机以供使用。"]],["$","p",{},["还需要将此命令添加为定时任务，推荐设置为每小时运行一次，否则不会更新到最新的 ROA ，每次更新后都需要使用 ",["$","code",{},["birdc configure"]]," 命令重载 BIRD 配置。"]],["$","h3",{"id":"重新加载-bird-配置"},["重新加载 BIRD 配置"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["birdc configure"]]]],["$","p",{},["使用该命令重新加载 BIRD 配置，并使用 ",["$","code",{},["birdc show protocol"]]," 查看状态。"]],["$","p",{},[["$","img",{"src":"https://s1.baoshuo.ren/2021/08/16/ZSPe6a3fpuDATG2.png","alt":"","loading":"lazy"},[]]]],["$","h2",{"id":"dn42-wireguard-使用入门"},["DN42 WireGuard 使用入门"]],["$","p",{},["WireGuard 是一种简单易用、速度快、现代化的 VPN ，它利用了最先进的加密技术，并使用 UDP 协议传输数据。WireGuard 设计为通用 VPN ，可在嵌入式设备和超级计算机上运行，​​ 适用于许多不同的环境。WireGuard 起初是专为 Linux 编写并发布的，后来被移植到各个平台上。在 ",["$","a",{"href":"http://WireGuard.com","rel":"external nofollow noreferrer"},["WireGuard.com"]]," 上可以找到它的 ",["$","a",{"href":"https://www.wireguard.com/papers/wireguard.pdf","rel":"external nofollow noreferrer"},["技术白皮书"]]," 。"]],["$","h3",{"id":"安装-wireguard"},["安装 WireGuard"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["apt update\napt install wireguard -y"]]]],["$","p",{},["一般情况下，执行此命令即可直接安装 WireGuard 和 WireGuard Tools ，无需额外操作。"]],["$","h3",{"id":"生成公钥与私钥"},["生成公钥与私钥"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["wg genkey | ",["$","span",{"class":"hljs-built_in"},["tee"]]," privatekey | wg pubkey \u003e publickey"]]]],["$","p",{},["使用此命令即可在当前目录下生成两个名叫 ",["$","code",{},["privatekey"]]," 和 ",["$","code",{},["publickey"]]," 的文件，分别代表私钥和公钥。"]],["$","h3",{"id":"搭建-wireguard-隧道"},["搭建 WireGuard 隧道"]],["$","p",{},["搭建 WireGuard 隧道非常简便，只需要生成一对公钥与私钥并与对等端交换公钥即可。"]],["$","p",{},["如果需要通过 WireGuard 隧道建立 BGP 会话，不能使用 WireGuard 内建的多 Peer 功能，必须为每个对等端创建一条隧道。"]],["$","p",{},["在 ",["$","code",{},["/etc/wireguard"]]," 目录下新建一个名为 ",["$","code",{},["\u003c隧道名\u003e.conf"]]," 的文件："]],["$","pre",{},[["$","code",{"class":"hljs ini"},[["$","span",{"class":"hljs-section"},["[Interface]"]],"\n",["$","span",{"class":"hljs-attr"},["PrivateKey"]]," = \u003c私钥\u003e\n",["$","span",{"class":"hljs-attr"},["ListenPort"]]," = \u003c监听端口\u003e\n",["$","span",{"class":"hljs-attr"},["PostUp"]],"     = ip address add \u003c链路本地地址\u003e/",["$","span",{"class":"hljs-number"},["64"]]," dev %i\n",["$","span",{"class":"hljs-attr"},["PostUp"]],"     = ip addr add \u003c本地 IPv6 地址\u003e/",["$","span",{"class":"hljs-number"},["128"]]," peer \u003c对端 IPv6 地址\u003e/",["$","span",{"class":"hljs-number"},["128"]]," dev %i\n",["$","span",{"class":"hljs-attr"},["PostUp"]],"     = ip addr add \u003c本地 IPv4 地址\u003e/",["$","span",{"class":"hljs-number"},["32"]]," peer \u003c对端 IPv4 地址\u003e/",["$","span",{"class":"hljs-number"},["32"]]," dev %i\n",["$","span",{"class":"hljs-attr"},["Table"]],"      = ",["$","span",{"class":"hljs-literal"},["off"]]]]]],["$","ul",{},[["$","li",{},[["$","code",{},["PrivateKey"]]," ：私钥。"]],["$","li",{},[["$","code",{},["ListenPort"]]," ：监听端口。"]],["$","li",{},["第一个 ",["$","code",{},["PostUp"]]," ：（可选，推荐）添加链路本地地址。"]],["$","li",{},["第二个 ",["$","code",{},["PostUp"]]," ：（可选）添加本地和对等端的 DN42 IPv6 地址。"]],["$","li",{},["第三个 ",["$","code",{},["PostUp"]]," ：（可选）添加本地和对等端的 DN42 IPv4 地址。"]],["$","li",{},[["$","code",{},["Table"]]," ：必须设定为 ",["$","code",{},["off"]]," （不导入系统路由表），否则会导致系统断网。"]]]],["$","p",{},["当使用链路本地地址建立 BGP 会话时，可以不设置 DN42 IPv4 和 DN42 IPv6 地址，但是机器上必须有一张网卡上绑定了本机的 DN42 IPv4 和 DN42 IPv6 地址。同理，如果不使用链路本地地址建立 BGP 会话则无需添加链路本地地址。"]],["$","pre",{},[["$","code",{"class":"hljs ini"},[["$","span",{"class":"hljs-section"},["[Peer]"]],"\n",["$","span",{"class":"hljs-attr"},["PublicKey"]],"           = \u003c对端公钥\u003e\n",["$","span",{"class":"hljs-attr"},["PresharedKey"]],"        = \u003c对端预共享密钥\u003e\n",["$","span",{"class":"hljs-attr"},["Endpoint"]],"            = \u003c对端 IP/域名 和 端口号\u003e\n",["$","span",{"class":"hljs-attr"},["PersistentKeepalive"]]," = ",["$","span",{"class":"hljs-number"},["30"]],"\n",["$","span",{"class":"hljs-attr"},["AllowedIPs"]],"          = ",["$","span",{"class":"hljs-number"},["10.0"]],".",["$","span",{"class":"hljs-number"},["0.0"]],"/",["$","span",{"class":"hljs-number"},["8"]],", ",["$","span",{"class":"hljs-number"},["172.20"]],".",["$","span",{"class":"hljs-number"},["0.0"]],"/",["$","span",{"class":"hljs-number"},["14"]],", ",["$","span",{"class":"hljs-number"},["172.31"]],".",["$","span",{"class":"hljs-number"},["0.0"]],"/",["$","span",{"class":"hljs-number"},["16"]],", fd00::/",["$","span",{"class":"hljs-number"},["8"]],", fe80::/",["$","span",{"class":"hljs-number"},["64"]]]]]],["$","ul",{},[["$","li",{},[["$","code",{},["PublicKey"]]," ：对端公钥。"]],["$","li",{},[["$","code",{},["PresharedKey"]]," ：（可选）对端预共享密钥。"]],["$","li",{},[["$","code",{},["Endpoint"]]," ：（可选）对端的连接域名/IP 及端口号。",["$","br",{},[]],"如果对端没有公网 IP 地址，需要本地设置为被动模式则无需填写此项。"]],["$","li",{},[["$","code",{},["PersistentKeepalive"]]," ：（可选）每隔多少秒发送一次握手信息防止连接被中断并更新对端 IP 。",["$","br",{},[]],"如果本地没有公网 IP 地址，必须配置此项。"]],["$","li",{},[["$","code",{},["AllowedIPs"]]," ：允许使用 WireGuard 转发流量的 IP 地址段。"]]]],["$","p",{},["之后使用 ",["$","code",{},["wg-quick up \u003c隧道名\u003e"]]," 来启动隧道即可。"]],["$","p",{},["如需开机自启，可以在测试无误后执行 ",["$","code",{},["systemctl enable wg-quick@\u003c隧道名\u003e"]]," 。"]],["$","h3",{"id":"检测隧道状态"},["检测隧道状态"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["wg show \u003c隧道名\u003e"]]]],["$","p",{},["使用该命令即可查看隧道状态。"]],["$","p",{},[["$","img",{"src":"https://s1.baoshuo.ren/2021/08/16/wxgUJNHnQAXFMdS.png","alt":"","loading":"lazy"},[]]]],["$","p",{},["如上图所示，当 ",["$","code",{},["latest handshake"]]," 时间较近且 ",["$","code",{},["transfer"]]," 有收有发时可以认为隧道正常。"]],["$","p",{},["如需查看所有隧道的状态，直接使用 ",["$","code",{},["wg"]]," 命令即可。"]],["$","h2",{"id":"与其他网络进行对等互联"},["与其他网络进行对等互联"]],["$","h3",{"id":"系统配置"},["系统配置"]],["$","p",{},["在 DN42 网络中，没有绝对意义上的客户端，每个人都可能是他人的路由器，经常会出现数据包的来源网卡与回复使用的网卡不一致的情况，因此需要打开 Linux 内核的数据包转发功能，具体操作如下："]],["$","pre",{},[["$","code",{"class":"hljs bash"},[["$","span",{"class":"hljs-built_in"},["echo"]]," ",["$","span",{"class":"hljs-string"},["\"net.ipv4.ip_forward=1\""]]," \u003e\u003e /etc/sysctl.conf\n",["$","span",{"class":"hljs-built_in"},["echo"]]," ",["$","span",{"class":"hljs-string"},["\"net.ipv6.conf.default.forwarding=1\""]]," \u003e\u003e /etc/sysctl.conf\n",["$","span",{"class":"hljs-built_in"},["echo"]]," ",["$","span",{"class":"hljs-string"},["\"net.ipv6.conf.all.forwarding=1\""]]," \u003e\u003e /etc/sysctl.conf\nsysctl -p"]]]],["$","p",{},["同时，也需要关闭 Linux 内核的 ",["$","code",{},["rp_filter"]]," 的严格模式，具体操作如下："]],["$","pre",{},[["$","code",{"class":"hljs bash"},[["$","span",{"class":"hljs-built_in"},["echo"]]," ",["$","span",{"class":"hljs-string"},["\"net.ipv4.conf.default.rp_filter=0\""]]," \u003e\u003e /etc/sysctl.conf\n",["$","span",{"class":"hljs-built_in"},["echo"]]," ",["$","span",{"class":"hljs-string"},["\"net.ipv4.conf.all.rp_filter=0\""]]," \u003e\u003e /etc/sysctl.conf\nsysctl -p"]]]],["$","p",{},["除此之外，还需要关闭一些自动化的配置 iptables 防火墙的工具，如 UFW 。"]],["$","h3",{"id":"搭建-wireguard-隧道-2"},["搭建 WireGuard 隧道"]],["$","p",{},["请参考 ",["$","a",{"href":"#DN42-WireGuard-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8"},["DN42 WireGuard 使用入门"]]," 一节。"]],["$","h3",{"id":"配置-bgp-会话"},["配置 BGP 会话"]],["$","p",{},["在 ",["$","code",{},["/etc/bird/peers"]]," 目录下新建一个文件，命名为 ",["$","code",{},["\u003c名字\u003e.conf"]]," 。"]],["$","p",{},["如果使用链路本地地址进行 Peer 的话，需要按照下面的配置示例进行配置："]],["$","pre",{},[["$","code",{"class":"hljs bird"},["protocol bgp \u003c名字\u003e from dnpeers {\n    neighbor \u003c对端链路本地地址\u003e % '\u003c对端 WireGuard 隧道名\u003e' as \u003c对端 ASN\u003e;\n    source address \u003c本地的链路本地地址\u003e;\n}"]]]],["$","p",{},["否则按照下面的配置示例进行配置："]],["$","pre",{},[["$","code",{"class":"hljs bird"},["protocol bgp \u003c名字\u003e from dnpeers {\n    neighbor \u003c对端 IPv6 地址\u003e as \u003c对端 ASN\u003e;\n}"]]]],["$","p",{},["然后使用 ",["$","code",{},["birdc configure"]]," 重载配置即可。"]],["$","h2",{"id":"更新日志"},["更新日志"]],["$","ul",{},[["$","li",{},["2021-04-04 第一版 ",["$","sup",{},["（2021 年 8 月 10 日存档于 ",["$","a",{"href":"https://web.archive.org/web/20210810062825/https://blog.baoshuo.ren/post/dn42-network/","rel":"external nofollow noreferrer"},["互联网档案馆"]],"）"]]]],["$","li",{},["2021-08-14 第二版"]]]],["$","h2",{"id":"参考资料-6"},["参考资料"]],["$","ol",{},[["$","li",{},[["$","a",{"href":"https://dn42.dev/howto/Getting-Started","rel":"external nofollow noreferrer"},["Getting Started - DN42 Wiki"]]]],["$","li",{},[["$","a",{"href":"https://git.dn42.dev/dn42/registry/src/branch/master/README.md","rel":"external nofollow noreferrer"},["Guide for creating a Pull Request - dn42/registry - DN42 Git"]]]],["$","li",{},[["$","a",{"href":"https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/","rel":"external nofollow noreferrer"},["DN42 实验网络介绍及注册教程（2020-10-01 更新） - Lan Tian @ Blog"]]]],["$","li",{},[["$","a",{"href":"https://datatracker.ietf.org/","rel":"external nofollow noreferrer"},["IETF Datatracker"]]]],["$","li",{},[["$","a",{"href":"https://en.wikipedia.org/wiki/Unique_local_address","rel":"external nofollow noreferrer"},["Unique local address - Wikipedia"]]]],["$","li",{},[["$","a",{"href":"https://github.com/moesoha/bird-bgp-kickstart","rel":"external nofollow noreferrer"},["BIRD 与 BGP 的新手开场 - Soha Jin - GitHub"]]]]]]],"thumb":"https://s1.baoshuo.ren/2021/04/03/R6IHLundNjpKxCD.png","date":"2021-04-04","updated":"2021-08-18","isoDate":"2021-04-04T03:29:32.000Z","isoUpdate":"2021-08-18T08:27:30.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"BGP","url":"/tags/BGP/"},{"name":"DN42","url":"/tags/DN42/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/dn42-network/","url":"/post/dn42-network/","prev":{"title":"搭建 BIRD Looking Glass 速成指北","url":"/post/bird-looking-glass/"},"next":{"title":"年轻人的第一个 ASN","url":"/post/my-own-asn/"},"toc":{"0":{"0":{"text":"注册前的准备","id":"注册前的准备"},"1":{"text":"克隆 DN42 注册表 Git 仓库","id":"克隆-dn42-注册表-git-仓库"},"2":{"text":"注册维护者","id":"注册维护者"},"3":{"text":"注册联系人","id":"注册联系人"},"4":{"text":"注册 ASN","id":"注册-asn"},"5":{"text":"注册 IPv4 地址块","id":"注册-ipv4-地址块"},"6":{"text":"注册 IPv6 地址块","id":"注册-ipv6-地址块"},"7":{"text":"添加路由记录","id":"添加路由记录"},"8":{"text":"上传更改到 DN42 注册表","id":"上传更改到-dn42-注册表"},"9":{"text":"注意事项","id":"注意事项"},"text":"注册 DN42","id":"注册-dn42"},"1":{"0":{"text":"安装 BIRD2","id":"安装-bird2"},"1":{"text":"编写 BIRD 配置文件","id":"编写-bird-配置文件"},"2":{"text":"下载 ROA 配置文件","id":"下载-roa-配置文件"},"3":{"text":"重新加载 BIRD 配置","id":"重新加载-bird-配置"},"text":"DN42 BIRD2 使用入门","id":"dn42-bird2-使用入门"},"2":{"0":{"text":"安装 WireGuard","id":"安装-wireguard"},"1":{"text":"生成公钥与私钥","id":"生成公钥与私钥"},"2":{"text":"搭建 WireGuard 隧道","id":"搭建-wireguard-隧道"},"3":{"text":"检测隧道状态","id":"检测隧道状态"},"text":"DN42 WireGuard 使用入门","id":"dn42-wireguard-使用入门"},"3":{"0":{"text":"系统配置","id":"系统配置"},"1":{"text":"搭建 WireGuard 隧道","id":"搭建-wireguard-隧道-2"},"2":{"text":"配置 BGP 会话","id":"配置-bgp-会话"},"text":"与其他网络进行对等互联","id":"与其他网络进行对等互联"},"4":{"text":"更新日志","id":"更新日志"},"5":{"text":"参考资料","id":"参考资料-6"}},"hasToc":true,"comments":true,"wordCount":"约 5.2 千字"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"dn42-network"},"buildId":"ZHps7nekETP2dTZivX4rd","assetPrefix":"https://static.cdn.baoshuo.ren/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>