"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{9238:function(e,s,t){t.r(s),t.d(s,{default:function(){return H}});var r,n=t(5893);let o=e=>{let s;let t=new Set,r=(e,r)=>{let n="function"==typeof e?e(s):e;if(n!==s){let o=s;s=r?n:Object.assign({},s,n),t.forEach(e=>e(s,o))}},n=()=>s,o=e=>(t.add(e),()=>t.delete(e)),a=()=>t.clear(),l={setState:r,getState:n,subscribe:o,destroy:a};return s=e(r,n,l),l},a=e=>e?o(e):o;var l=t(7667),i=t(2798);let d=e=>{let s="function"==typeof e?a(e):e,t=(e,t)=>(function(e,s=e.getState,t){let r=(0,i.useSyncExternalStoreWithSelector)(e.subscribe,e.getState,e.getServerState||e.getState,s,t);return(0,l.useDebugValue)(r),r})(s,e,t);return Object.assign(t,s),t},c="undefined"!=typeof window,u=(e,s)=>{let t=new URL(s);return t.searchParams.set("api_key",e),fetch(t.toString()).then(e=>e.json())},m=e=>new Date(e).getTime(),h=e=>e.replace(/a\.disquscdn\.com/g,"c.disquscdn.com"),j=null,f=e=>{let s=h(e).replace(/https?:\/\/disq.us\/url\?url=(.+)%3A[\w-]+&amp;cuid=\d+/gm,(e,s)=>decodeURIComponent(s));j||=new DOMParser;let t=j.parseFromString(s,"text/html");return t.querySelectorAll("script").forEach(e=>e.remove()),t.querySelectorAll("a").forEach(e=>{e.target="_blank",e.rel="external noopener nofollow noreferrer"}),t.body.innerHTML},p=new Date().getTimezoneOffset(),q=e=>String(e).padStart(2,"0"),x=e=>{let s=m(e),t=new Date(s-6e4*p);return`${t.getFullYear()}-${q(t.getMonth()+1)}-${q(t.getDate())} ${q(t.getHours())}:${q(t.getMinutes())}`},g=e=>new Promise((s,t)=>{let r=new Image,n=()=>{r.onload=null,r.onerror=null,r.remove()},o=setTimeout(()=>{n(),t()},3e3);r.onerror=()=>{clearTimeout(o),n(),t()},r.onload=()=>{clearTimeout(o),n(),s()},r.src=`https://${e}/favicon.ico?${+new Date}=${+new Date}`}),v={mode:(()=>{if(c){let e=localStorage.getItem("dsqjs_mode");if("dsqjs"===e||"disqus"===e)return e}return null})(),sortType:(()=>{if(c){let e=localStorage.getItem("dsqjs_sort");if("popular"===e||"asc"===e||"desc"===e)return e}return null})(),error:!1,msg:null,thread:null,posts:[],loadingPosts:!1,morePostsError:!1},b=(r=(e,s)=>({...v,setMode(s){e({mode:s}),c&&s&&Promise.resolve().then(()=>{null===s?localStorage.removeItem("dsqjs_mode"):localStorage.setItem("dsqjs_mode",s)})},checkMode(s){e({msg:"正在检查 Disqus 能否访问..."}),Promise.all(["disqus.com",`${s}.disqus.com`].map(g)).then(()=>{e({mode:"disqus"}),localStorage.setItem("dsqjs_mode","disqus")},()=>{e({mode:"dsqjs"}),localStorage.setItem("dsqjs_mode","dsqjs")})},setSortType(s){e({sortType:s}),c&&s&&Promise.resolve().then(()=>{localStorage.setItem("dsqjs_sort",s)})},setError(s){e({error:s})},setMsg(s){e({msg:s})},async fetchThread(s,t,r,n="https://disqus.skk.moe/disqus/"){try{let o=await u(r,`${n}3.0/threads/list.json?forum=${encodeURIComponent(s)}&thread=${encodeURIComponent(`ident:${t}`)}`);0===o.code?e({thread:o}):e({error:!0})}catch{e({error:!0})}},async fetchMorePosts(t,r,n,o="https://disqus.skk.moe/disqus/",a=!1){if(!r)return;e({...a&&{posts:[]},loadingPosts:!0,morePostsError:!1});let l=a?[]:s().posts,i=s().sortType,d=l.at(-1);if(d&&!d.cursor.hasNext)return;let c=`${o}3.0/threads/listPostsThreaded?forum=${t}&thread=${r}&order=${i??"desc"}${0!==l.length&&d?.cursor.next?`&cursor=${encodeURIComponent(d.cursor.next)}`:""}`,m=()=>{0===l.length?e({error:!0,loadingPosts:!1}):e({morePostsError:!0,loadingPosts:!1})};try{let h=await u(n,c);0===h.code?e(e=>({posts:e.posts.concat(h),loadingPosts:!1})):m()}catch{m()}},reset(){e({...v})}}))?d(r):d,S=(0,l.memo)(e=>{let{isError:s,isLoading:t,...r}=e;return(0,n.jsx)("a",{...r,id:"dsqjs-load-more",className:`dsqjs-load-more ${s?"is-error":""}`,role:"button",children:s?"加载失败，请重试":t?"正在加载...":"加载更多评论"})}),y=(0,l.memo)(e=>{let s=b(e=>e.setMode),t=(0,l.useCallback)(()=>s("disqus"),[s]);return(0,n.jsx)("a",{id:"dsqjs-force-disqus",className:"dsqjs-msg-btn",onClick:t,children:e.children})}),w=(0,l.memo)(e=>{let s=b(e=>e.setMode),t=(0,l.useCallback)(()=>s(null),[s]);return(0,n.jsx)("a",{id:"dsqjs-test-disqus",className:"dsqjs-msg-btn",onClick:t,children:e.children})}),N=(0,l.memo)(e=>{let s=b(e=>e.setMode),t=(0,l.useCallback)(()=>s("dsqjs"),[s]);return(0,n.jsx)("a",{id:"dsqjs-force-dsqjs",className:"dsqjs-msg-btn",onClick:t,children:e.children})}),k=(0,l.memo)(e=>{let s=b(e=>e.setError),t=(0,l.useCallback)(()=>{s(!1)},[s]);return(0,n.jsx)("a",{id:"dsqjs-reload-dsqjs",className:"dsqjs-msg-btn",onClick:t,children:e.children})}),E="disqus_thread",C="dsq-embed-scr",D=(0,l.memo)(e=>{let s=b(e=>e.setMsg),[t,r]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(s(null),c){let t=()=>{if(c){window.disqus_config=void 0;let e=document.getElementById(C);e&&(document.head.removeChild(e),e.remove()),window.DISQUS?.reset({});try{delete window.DISQUS}catch{window.DISQUS=void 0}let s=document.getElementById(E);if(s)for(;s.hasChildNodes();)s.removeChild(s.firstChild);document.querySelectorAll('link[href*="disquscdn.com/next"], link[href*="disqus.com/next"], script[src*="disquscdn.com/next/embed"], script[src*="disqus.com/count-data.js"], iframe[title="Disqus"]').forEach(e=>{e.parentNode?.removeChild(e),e.parentElement?.removeChild(e),e.remove()})}};window.disqus_shortname!==e.shortname&&t();let n=()=>function(){e.identifier&&(this.page.identifier=e.identifier),e.url&&(this.page.url=e.url),e.title&&(this.page.title=e.title),this.callbacks.onReady=[()=>{r(!0)}]};if(window.DISQUS&&document.getElementById(C))window.DISQUS.reset({reload:!0,config:n()});else{window.disqus_config=n(),window.disqus_shortname=e.shortname;let o=document.createElement("script");o.id=C,o.src=`https://${e.shortname}.disqus.com/embed.js`,o.async=!0,document.head.appendChild(o)}return t}},[e.shortname,e.identifier,e.url,e.title,s]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{id:E,children:["评论完整模式加载中... 如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理，或切换至 ",(0,n.jsx)(N,{children:"评论基础模式"})]}),!t&&(0,n.jsxs)("div",{id:"dsqjs-msg",children:["评论完整模式加载中... 如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理，或切换至 ",(0,n.jsx)(N,{children:"评论基础模式"})]})]})}),$=(0,l.memo)(()=>(0,n.jsxs)("div",{id:"dsqjs-msg",children:["评论基础模式加载失败，请"," ",(0,n.jsx)(k,{children:"重载"})," ","或"," ",(0,n.jsx)(w,{children:"尝试完整 Disqus 模式"})]})),_=(0,l.memo)(()=>(0,n.jsxs)("div",{id:"dsqjs-msg",children:["当前 Thread 尚未创建。是否切换至"," ",(0,n.jsx)(y,{children:"完整 Disqus 模式"}),"？"]})),T=(0,l.memo)(e=>(0,n.jsx)("p",{className:"dsqjs-no-comment",children:e.text}));function I(e){let s=e.comment.author.profileUrl,t=f(e.comment.author.avatar.cache);return(0,n.jsxs)("li",{id:`comment-${e.comment.id}`,children:[(0,n.jsxs)("div",{className:"dsqjs-post-item dsqjs-clearfix",children:[(0,n.jsx)("div",{className:"dsqjs-post-avatar",children:s?(0,n.jsx)("a",{href:s,target:"_blank",rel:"noreferrer noopenner nofollow external",children:(0,n.jsx)("img",{alt:e.comment.author.username,src:t})}):(0,n.jsx)("img",{alt:e.comment.author.username,src:t})}),(0,n.jsxs)("div",{className:"dsqjs-post-body",children:[(0,n.jsxs)("div",{className:"dsqjs-post-header",children:[s?(0,n.jsx)("span",{className:"dsqjs-post-author",children:(0,n.jsx)("a",{href:s,target:"_blank",rel:"noreferrer noopenner nofollow external",children:e.comment.author.name})}):(0,n.jsx)("span",{className:"dsqjs-post-author",children:e.comment.author.name}),e.admin===e.comment.author.username&&(0,n.jsx)("span",{className:"dsqjs-admin-badge",children:e.adminLabel})," ",(0,n.jsx)("span",{className:"dsqjs-bullet"})," ",e.comment.createdAt&&(0,n.jsx)("span",{className:"dsqjs-meta",children:(0,n.jsx)("time",{children:x(e.comment.createdAt)})})]}),e.comment.isDeleted?(0,n.jsx)("div",{className:"dsqjs-post-content",children:(0,n.jsx)("small",{children:"此评论已被删除"})}):(0,n.jsx)("div",{className:"dsqjs-post-content",dangerouslySetInnerHTML:{__html:f(e.comment.message)}})]})]}),(0,n.jsx)(M,{...e,currentNesting:e.nesting}),e.comment.hasMore&&(0,n.jsxs)("p",{className:"dsqjs-has-more",children:["切换至 ",(0,n.jsx)(y,{children:"完整 Disqus 模式"})," 显示更多回复"]})]})}function M(e){return e.children&&0!==e.children.length?(0,n.jsx)("ul",{className:`dsqjs-post-list ${(e.currentNesting??1)<(e.nestingSetting??4)?"dsqjs-children":""}`,children:e.children.map(s=>(0,l.createElement)(I,{...s,admin:e.admin,adminLabel:e.adminLabel,key:s.comment.id}))}):null}let P=e=>{let s=(0,l.useMemo)(()=>{let s=[],t=[],r=e.comments.slice();return r.map((e,s)=>({i:s,p:e.parent,d:m(e.createdAt)})).sort((e,s)=>e.p&&s.p?e.d-s.d:0).map(({i:e})=>r[e]).forEach(e=>(e.parent?t:s).push(e)),s.map(e=>(function e(s,t,r){let n={comment:s,children:function(s,t,r){if(0===s.length)return null;let n=[];return s.forEach(o=>{o.parent===t&&n.unshift(e(o,s,r))}),n}(t,Number(s.id),r+1),nesting:r+1};return n})(e,t,0))},[e.comments]);return(0,n.jsx)("ul",{className:"dsqjs-post-list",id:"dsqjs-post-container",children:s.map(s=>(0,l.createElement)(I,{...s,key:s.comment.id,admin:e.admin,adminLabel:e.adminLabel}))})},R=e=>(0,l.useMemo)(()=>Array.isArray(e)?e[Math.random()*(e.length-1-0+1)+0|0]:e,[e]),L=e=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{className:"dsqjs-order-radio",id:`dsqjs-order-${e.sortType}`,type:"radio",name:"comment-order",value:e.sortType,onChange:e.onChange,checked:e.checked}),(0,n.jsx)("label",{className:"dsqjs-order-label",htmlFor:`dsqjs-order-${e.sortType}`,title:e.title,children:e.label})]}),F=(0,l.memo)(()=>{let e=b(e=>e.sortType),s=b(e=>e.setSortType),t=(0,l.useCallback)(e=>()=>s(e),[s]);return(0,n.jsxs)("div",{className:"dsqjs-order",children:[(0,n.jsx)(L,{checked:"desc"===e||null===e,sortType:"desc",title:"按从新到旧",label:"最新",onChange:t("desc")}),(0,n.jsx)(L,{checked:"asc"===e,sortType:"asc",title:"按从旧到新",label:"最早",onChange:t("asc")}),(0,n.jsx)(L,{checked:"popular"===e,sortType:"popular",title:"按评分从高到低",label:"最佳",onChange:t("popular")})]})}),U=(0,l.memo)(e=>(0,n.jsx)("header",{className:"dsqjs-header",id:"dsqjs-header",children:(0,n.jsxs)("nav",{className:"dsqjs-nav dsqjs-clearfix",children:[(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{className:"dsqjs-nav-tab dsqjs-tab-active",children:(0,n.jsxs)("span",{children:[e.totalComments," Comments"]})}),(0,n.jsx)("li",{className:"dsqjs-nav-tab",children:e.siteName})]}),(0,n.jsx)(F,{})]})})),A=e=>{let s=(0,l.useRef)(R(e.apikey)),t=b(e=>e.posts),r=b(e=>e.sortType),o=(0,l.useRef)(r),a=b(e=>e.morePostsError),i=b(e=>e.loadingPosts),d=b(e=>e.fetchMorePosts),c=(0,l.useRef)(null),u=(0,l.useCallback)(()=>d(e.shortname,e.id,s.current,e.api,!0),[d,e.api,e.id,e.shortname]),m=(0,l.useCallback)(()=>d(e.shortname,e.id,s.current,e.api,!1),[d,e.api,e.id,e.shortname]);return((0,l.useEffect)(()=>{c.current!==e.id?(c.current=e.id,u()):o.current!==r&&(o.current=r,c.current=e.id,u())},[t,u,e.id,i,r]),t.length>0)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P,{comments:t.filter(Boolean).map(e=>e.response).flat(),admin:e.admin,adminLabel:e.adminLabel}),t.at(-1)?.cursor.hasNext&&(0,n.jsx)(S,{isLoading:i,isError:a,onClick:i?void 0:m})]}):null},O=e=>{let s=(0,l.useRef)(R(e.apikey)),t=b(e=>e.thread),r=b(e=>e.fetchThread),o=b(e=>e.setMsg),a=(0,l.useRef)(null),i=e.identifier??document.location.origin+document.location.pathname+document.location.search;return((0,l.useEffect)(()=>{a.current!==i?(o((0,n.jsxs)(n.Fragment,{children:["评论基础模式加载中... 如需完整体验请针对 disq.us | disquscdn.com | disqus.com 启用代理并 ",(0,n.jsx)(w,{children:"尝试完整 Disqus 模式"})," | ",(0,n.jsx)(y,{children:"强制完整 Disqus 模式"})]})),a.current=i,r(e.shortname,i,s.current,e.api)):o((0,n.jsxs)(n.Fragment,{children:["你可能无法访问 Disqus，已启用评论基础模式。如需完整体验请针对 disq.us | disquscdn.com | disqus.com 启用代理并 ",(0,n.jsx)(w,{children:"尝试完整 Disqus 模式"})," | ",(0,n.jsx)(y,{children:"强制完整 Disqus 模式"})]}))},[t,r,i,o,e.shortname,e.api]),t)?1===t.response.length?0===t.response[0].posts?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(U,{totalComments:0,siteName:e.siteName??""}),(0,n.jsx)(T,{text:e.nocomment??"这里空荡荡的，一个人都没有"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(U,{totalComments:t.response[0].posts,siteName:e.siteName??""}),(0,n.jsx)(A,{...e,id:t.response[0].id})]}):(0,n.jsx)(_,{}):null},V=(0,l.memo)(()=>(0,n.jsx)("footer",{className:"dsqjs-footer-container",children:(0,n.jsxs)("p",{className:"dsqjs-footer",children:["Powered by ",(0,n.jsx)("a",{className:"dsqjs-disqus-logo",href:"https://disqus.com",target:"_blank",rel:"external nofollow noopener noreferrer"})," ","&"," ",(0,n.jsx)("a",{className:"dsqjs-dsqjs-logo",href:"https://disqusjs.skk.moe",target:"_blank",rel:"noreferrer",children:"DisqusJS"})]})}));var Q={dsqjs:"__dsqjs_oc95o1"};let B=e=>{let s=b(e=>e.mode),t=b(e=>e.checkMode);return((0,l.useEffect)(()=>{"disqus"!==s&&"dsqjs"!==s&&t(e.shortname)},[t,s,e.shortname]),"disqus"===s)?(0,n.jsx)(D,{shortname:e.shortname,identifier:e.identifier,url:e.url,title:e.title}):"dsqjs"===s?(0,n.jsx)(O,{...e}):null},H=(0,l.forwardRef)((e,s)=>{let t=b(e=>e.msg),r=b(e=>e.error),{shortname:o,siteName:a,identifier:i,url:d,title:c,api:u,apikey:m,nesting:h,nocomment:j,admin:f,adminLabel:p,className:q,...x}=e,[g,v]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{v(!0)},[]),g)?(0,n.jsx)("div",{ref:s,...x,className:`${Q.dsqjs} ${q??""}`,children:(0,n.jsxs)("section",{id:"dsqjs",children:[r?(0,n.jsx)($,{}):(0,n.jsxs)(n.Fragment,{children:[t&&(0,n.jsx)("div",{id:"dsqjs-msg",children:t}),(0,n.jsx)(B,{shortname:o,siteName:a,identifier:i,url:d,title:c,api:u,apikey:m,nesting:h,nocomment:j,admin:f,adminLabel:p})]}),(0,n.jsx)(V,{})]})}):null})},3250:function(e,s,t){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=t(7667),n="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},o=r.useState,a=r.useEffect,l=r.useLayoutEffect,i=r.useDebugValue;function d(e){var s=e.getSnapshot;e=e.value;try{var t=s();return!n(e,t)}catch(r){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,s){return s()}:function(e,s){var t=s(),r=o({inst:{value:t,getSnapshot:s}}),n=r[0].inst,c=r[1];return l(function(){n.value=t,n.getSnapshot=s,d(n)&&c({inst:n})},[e,t,s]),a(function(){return d(n)&&c({inst:n}),e(function(){d(n)&&c({inst:n})})},[e]),i(t),t};s.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:c},139:function(e,s,t){/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=t(7667),n=t(1688),o="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},a=n.useSyncExternalStore,l=r.useRef,i=r.useEffect,d=r.useMemo,c=r.useDebugValue;s.useSyncExternalStoreWithSelector=function(e,s,t,r,n){var u=l(null);if(null===u.current){var m={hasValue:!1,value:null};u.current=m}else m=u.current;u=d(function(){function e(e){if(!i){if(i=!0,a=e,e=r(e),void 0!==n&&m.hasValue){var s=m.value;if(n(s,e))return l=s}return l=e}if(s=l,o(a,e))return s;var t=r(e);return void 0!==n&&n(s,t)?s:(a=e,l=t)}var a,l,i=!1,d=void 0===t?null:t;return[function(){return e(s())},null===d?void 0:function(){return e(d())}]},[s,t,r,n]);var h=a(e,u[0],u[1]);return i(function(){m.hasValue=!0,m.value=h},[h]),c(h),h}},1688:function(e,s,t){e.exports=t(3250)},2798:function(e,s,t){e.exports=t(139)}}]);