{"pageProps":{"title":"【随笔】下载自己在 SM.MS 图床上的所有图片 - 宝硕博客","post":{"title":"【随笔】下载自己在 SM.MS 图床上的所有图片","excerpt":null,"content":[{"tag":"p","content":["前提条件：有 ",{"tag":"a","attrs":{"href":"http://SM.MS","rel":"external nofollow noreferrer"},"content":["SM.MS"]}," 图床账号，并且图片存储在该账号下。"]},{"tag":"p","content":["思路：先请求 API，获取图片列表。遍历列表，判断本地是否存在该图片，若不存在则下载该图片。"]},{"tag":"p","content":["代码如下。"]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs python"},"content":[{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["import"]}," requests\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["import"]}," os\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["import"]}," json\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["import"]}," pathlib\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["import"]}," sys\n\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["def"]}," ",{"tag":"span","attrs":{"class":"hljs-title function_"},"content":["getUploadedImages"]},"(",{"tag":"span","attrs":{"class":"hljs-params"},"content":["token"]},") -&gt; ",{"tag":"span","attrs":{"class":"hljs-built_in"},"content":["str"]},":\n    url = ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;https://sm.ms/api/v2/upload_history&quot;"]},"\n    headers = &#123;",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;Authorization&quot;"]},": token&#125;\n    ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["return"]}," requests.get(url, headers=headers).text\n\ndata = json.loads(getUploadedImages(sys.argv[",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]},"]))\n\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["for"]}," img ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["in"]}," data[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;data&quot;"]},"]:\n    path = ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;./data/&quot;"]}," + img[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;storename&quot;"]},"]\n    ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["if"]}," ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["not"]}," pathlib.Path(path).is_file():\n        pic = requests.get(img[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;url&quot;"]},"]).content\n        f = ",{"tag":"span","attrs":{"class":"hljs-built_in"},"content":["open"]},"(path, ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;wb&quot;"]},")\n        f.write(pic)\n        f.close()\n        ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["del"]}," pic\n        ",{"tag":"span","attrs":{"class":"hljs-built_in"},"content":["print"]},"(",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;Successfully get &quot;"]},"+img[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;storename&quot;"]},"]+",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot; .&quot;"]},")\n    ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["else"]},":\n        ",{"tag":"span","attrs":{"class":"hljs-built_in"},"content":["print"]},"(",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;&quot;"]},"+img[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;storename&quot;"]},"]+",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot; is already exists.&quot;"]},")"]}]},{"tag":"p","content":["使用方法：",{"tag":"code","content":["python3 smms-image.py &quot;[your token here]&quot;"]}]},{"tag":"p","content":["下载下来的图片会存到 ",{"tag":"code","content":["./data/"]}," 目录下（请提前新建）。"]}],"thumb":null,"date":"2020-11-28","updated":"2020-11-28","isoDate":"2020-11-28T13:39:32.000Z","isoUpdate":"2020-11-28T13:39:32.000Z","categories":[{"name":"笔记本","url":"/categories/%E7%AC%94%E8%AE%B0%E6%9C%AC/"}],"tags":[],"license":null,"permalink":"https://blog.baoshuo.ren/post/download-smms-image/","url":"/post/download-smms-image/","prev":{"title":"NOIP 2020 游记","url":"/post/noip-2020/"},"next":{"title":"洛谷爬虫","url":"/post/luogu-spider/"},"toc":{},"hasToc":false,"comments":true,"wordCount":"206 字"},"__post":true},"__N_SSG":true}