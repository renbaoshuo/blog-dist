{"pageProps":{"title":"搭建 BIRD Looking Glass 速成指北 - 宝硕博客","post":{"title":"搭建 BIRD Looking Glass 速成指北","excerpt":"BIRD 是 Linux 上常用的一款 BGP 路由软件。bird-lg-go 是 蓝天 使用 Go 语言编写的 Looking Glass 程序，内存占用比原版 bird-lg 更低。它提供了一个网页面板，可以显示各个服务器上的 BIRD 路由软件的状态，以及查询到指定 IP 的路由。","content":[{"tag":"p","content":["BIRD 是 Linux 上常用的一款 BGP 路由软件。bird-lg-go 是 ",{"tag":"a","attrs":{"href":"https://lantian.pub","rel":"external nofollow noreferrer"},"content":["蓝天"]}," 使用 Go 语言编写的 Looking Glass 程序，内存占用比原版 bird-lg 更低。它提供了一个网页面板，可以显示各个服务器上的 BIRD 路由软件的状态，以及查询到指定 IP 的路由。"]},{"tag":"span","attrs":{"id":"more"},"content":[]},{"tag":"ul","content":[{"tag":"li","content":["项目地址：",{"tag":"a","attrs":{"href":"https://github.com/xddxdd/bird-lg-go","rel":"external nofollow noreferrer"},"content":["https://github.com/xddxdd/bird-lg-go"]}]},{"tag":"li","content":["成品： ",{"tag":"a","attrs":{"href":"https://lg.dn42.as141776.net","rel":"external nofollow noreferrer"},"content":["https://lg.dn42.as141776.net"]}]}]},{"tag":"h2","attrs":{"id":"安装-docker-和-docker-compose"},"content":["安装 Docker 和 Docker Compose"]},{"tag":"p","content":["虽然这个程序可以直接运行，但我还是比较喜欢套个 Docker 防止污染环境。"]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs bash"},"content":["curl -sSL https://get.docker.com | sh\npip install docker-compose"]}]},{"tag":"h2","attrs":{"id":"编排-docker-compose-服务"},"content":["编排 Docker Compose 服务"]},{"tag":"p","content":["在运行 web 的服务器上找个地方（如 ",{"tag":"code","content":["/var/bird-lg/"]},"），将下面的内容修改后写入 ",{"tag":"code","content":["docker-compose.yml"]}," 中："]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs yml"},"content":[{"tag":"span","attrs":{"class":"hljs-attr"},"content":["version:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'3'"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["services:"]},"\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["bird-lg:"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["image:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["xddxdd/bird-lg-go"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["container_name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["bird-lg"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["restart:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["always"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["environment:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_SERVERS=cn1,eu1"]}," ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# 节点列表，以逗号分隔"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_DOMAIN=dn42.as141776.net"]}," ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# 节点 endpiont 后缀"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_TITLE_BRAND=Looking"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Glass"]}," ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# 标签栏上显示的名称"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_NAVBAR_BRAND=Looking"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Glass"]}," ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# 页面上显示的名称"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_WHOIS=whois.lantian.dn42"]}," ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Whois 服务器地址"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["BIRDLG_DNS_INTERFACE=asn.dn42"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["ports:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'5000:5000'"]},"\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["bird-lgproxy:"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["image:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["xddxdd/bird-lgproxy-go"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["container_name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["bird-lgproxy"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["restart:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["always"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["volumes:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'/var/run/bird/bird.ctl:/var/run/bird/bird.ctl'"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["ports:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'8000:8000'"]}]}]},{"tag":"p","content":["在各个节点上只需要写入下面内容即可："]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs yml"},"content":[{"tag":"span","attrs":{"class":"hljs-attr"},"content":["version:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'3'"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["services:"]},"\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["bird-lgproxy:"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["image:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["xddxdd/bird-lgproxy-go"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["container_name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["bird-lgproxy"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["restart:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["always"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["volumes:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'/var/run/bird/bird.ctl:/var/run/bird/bird.ctl'"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["ports:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["'8000:8000'"]}]}]},{"tag":"p","content":["之后启动 Docker 容器："]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs bash"},"content":["docker-compose up -d"]}]},{"tag":"h2","attrs":{"id":"使用-nginx-反代页面"},"content":["使用 nginx 反代页面"]},{"tag":"p","content":["使用下方的配置启动反向代理即可。"]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs nginx"},"content":[{"tag":"span","attrs":{"class":"hljs-section"},"content":["server"]}," {\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"      *:",{"tag":"span","attrs":{"class":"hljs-number"},"content":["80"]},";\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"      [::]:",{"tag":"span","attrs":{"class":"hljs-number"},"content":["80"]},";\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["server_name"]}," lg.dn42.as141776.net;\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# reverse proxy"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-section"},"content":["location"]}," / {\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_pass"]},"                         http://127.0.0.1:5000;\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_http_version"]},"                 ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]},".",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_cache_bypass"]},"                 ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$http_upgrade"]},";\n\n        ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Proxy headers"]},"\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," Upgrade           ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$http_upgrade"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," Host              ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$host"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," X-Real-IP         ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$remote_addr"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," X-Forwarded-For   ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$proxy_add_x_forwarded_for"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," X-Forwarded-Proto ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$scheme"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," X-Forwarded-Host  ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$host"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_set_header"]}," X-Forwarded-Port  ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$server_port"]},";\n\n        ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Proxy timeouts"]},"\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_connect_timeout"]},"              ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["60s"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_send_timeout"]},"                 ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["60s"]},";\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["proxy_read_timeout"]},"                 ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["60s"]},";\n    }\n}"]}]},{"tag":"h2","attrs":{"id":"配置-dns-解析"},"content":["配置 DNS 解析"]},{"tag":"p","content":["bird-lg-go 的节点 endpiont 生成逻辑是 ",{"tag":"code","content":["http://[节点].[endpoint后缀]:8000"]}," ，如 ",{"tag":"code","content":["http://eu1.dn42.as141776.net:8000"]}," ，所以只需要去配置对应的解析。"]},{"tag":"blockquote","content":[{"tag":"p","content":[{"tag":"strong","content":["警告"]}]},{"tag":"p","content":["建议解析到节点的公网 IP 上，以免 DN42 炸掉时 Looking Glass 也一并炸掉。"]}]},{"tag":"p","content":["配置示例："]},{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs stylus"},"content":["eu1",{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".dn42"]},{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".as141776"]},{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".net"]},".  ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["3600"]},"    IN      A       ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["136.243"]},".",{"tag":"span","attrs":{"class":"hljs-number"},"content":["221.96"]},"\ncn1",{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".dn42"]},{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".as141776"]},{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".net"]},".  ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["3600"]},"    IN      CNAME   home",{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".baoshuo"]},{"tag":"span","attrs":{"class":"hljs-selector-class"},"content":[".ren"]},"."]}]},{"tag":"h2","attrs":{"id":"成果"},"content":["成果"]},{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2021/05/03/iaFfTWAhpdZGJ9t.png","alt":"","loading":"lazy"},"content":[]}]}],"thumb":null,"date":"2021-05-03","updated":"2021-05-03","isoDate":"2021-05-03T04:23:00.000Z","isoUpdate":"2021-05-03T04:23:00.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"BIRD","url":"/tags/BIRD/"},{"name":"BGP","url":"/tags/BGP/"},{"name":"DN42","url":"/tags/DN42/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/bird-looking-glass/","url":"/post/bird-looking-glass/","prev":{"title":"使用 Cloudflare Warp 为单栈 VPS 添加双栈网络访问","url":"/post/vps-cloudflare-warp/"},"next":{"title":"初探 DN42 网络","url":"/post/dn42-network/"},"toc":{"1":{"text":"安装 Docker 和 Docker Compose","id":"安装-docker-和-docker-compose"},"2":{"text":"编排 Docker Compose 服务","id":"编排-docker-compose-服务"},"3":{"text":"使用 nginx 反代页面","id":"使用-nginx-反代页面"},"4":{"text":"配置 DNS 解析","id":"配置-dns-解析"},"5":{"text":"成果","id":"成果"}},"hasToc":true,"comments":true,"wordCount":"548 字"},"__post":true},"__N_SSG":true}