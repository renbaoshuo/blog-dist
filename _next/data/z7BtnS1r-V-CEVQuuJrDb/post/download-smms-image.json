{"pageProps":{"title":"下载自己在 SM.MS 图床上的所有图片 - 宝硕博客","post":{"title":"下载自己在 SM.MS 图床上的所有图片","excerpt":null,"content":[["$","p",{},["前提条件：有 ",["$","a",{"href":"http://SM.MS","rel":"external nofollow noreferrer"},["SM.MS"]]," 图床账号，并且图片存储在该账号下。"]],["$","p",{},["思路：先请求 API，获取图片列表。遍历列表，判断本地是否存在该图片，若不存在则下载该图片。"]],["$","p",{},["代码如下。"]],["$","pre",{},[["$","code",{"class":"hljs python"},[["$","span",{"class":"hljs-keyword"},["import"]]," requests\n",["$","span",{"class":"hljs-keyword"},["import"]]," os\n",["$","span",{"class":"hljs-keyword"},["import"]]," json\n",["$","span",{"class":"hljs-keyword"},["import"]]," pathlib\n",["$","span",{"class":"hljs-keyword"},["import"]]," sys\n\n",["$","span",{"class":"hljs-keyword"},["def"]]," ",["$","span",{"class":"hljs-title function_"},["getUploadedImages"]],"(",["$","span",{"class":"hljs-params"},["token"]],") -> ",["$","span",{"class":"hljs-built_in"},["str"]],":\n    url = ",["$","span",{"class":"hljs-string"},["\"https://sm.ms/api/v2/upload_history\""]],"\n    headers = {",["$","span",{"class":"hljs-string"},["\"Authorization\""]],": token}\n    ",["$","span",{"class":"hljs-keyword"},["return"]]," requests.get(url, headers=headers).text\n\ndata = json.loads(getUploadedImages(sys.argv[",["$","span",{"class":"hljs-number"},["1"]],"]))\n\n",["$","span",{"class":"hljs-keyword"},["for"]]," img ",["$","span",{"class":"hljs-keyword"},["in"]]," data[",["$","span",{"class":"hljs-string"},["\"data\""]],"]:\n    path = ",["$","span",{"class":"hljs-string"},["\"./data/\""]]," + img[",["$","span",{"class":"hljs-string"},["\"storename\""]],"]\n    ",["$","span",{"class":"hljs-keyword"},["if"]]," ",["$","span",{"class":"hljs-keyword"},["not"]]," pathlib.Path(path).is_file():\n        pic = requests.get(img[",["$","span",{"class":"hljs-string"},["\"url\""]],"]).content\n        f = ",["$","span",{"class":"hljs-built_in"},["open"]],"(path, ",["$","span",{"class":"hljs-string"},["\"wb\""]],")\n        f.write(pic)\n        f.close()\n        ",["$","span",{"class":"hljs-keyword"},["del"]]," pic\n        ",["$","span",{"class":"hljs-built_in"},["print"]],"(",["$","span",{"class":"hljs-string"},["\"Successfully get \""]],"+img[",["$","span",{"class":"hljs-string"},["\"storename\""]],"]+",["$","span",{"class":"hljs-string"},["\" .\""]],")\n    ",["$","span",{"class":"hljs-keyword"},["else"]],":\n        ",["$","span",{"class":"hljs-built_in"},["print"]],"(",["$","span",{"class":"hljs-string"},["\"\""]],"+img[",["$","span",{"class":"hljs-string"},["\"storename\""]],"]+",["$","span",{"class":"hljs-string"},["\" is already exists.\""]],")"]]]],["$","p",{},["使用方法：",["$","code",{},["python3 smms-image.py \"[your token here]\""]]]],["$","p",{},["下载下来的图片会存到 ",["$","code",{},["./data/"]]," 目录下（请提前新建）。"]]],"thumb":null,"date":"2020-11-28","updated":"2020-11-28","isoDate":"2020-11-28T13:39:32.000Z","isoUpdate":"2020-11-28T13:39:32.000Z","categories":[{"name":"便签格","url":"/categories/%E4%BE%BF%E7%AD%BE%E6%A0%BC/"}],"tags":[],"license":null,"permalink":"https://blog.baoshuo.ren/post/download-smms-image/","url":"/post/download-smms-image/","prev":{"title":"NOIP 2020 游记","url":"/post/noip-2020/"},"next":{"title":"洛谷爬虫","url":"/post/luogu-spider/"},"toc":{},"hasToc":false,"comments":true,"wordCount":"206 字"}},"__N_SSG":true}