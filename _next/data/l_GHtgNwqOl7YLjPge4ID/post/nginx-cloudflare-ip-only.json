{"pageProps":{"title":"配置 Nginx 只允许 Cloudflare 的 IP 回源 - 宝硕博客","post":{"title":"配置 Nginx 只允许 Cloudflare 的 IP 回源","excerpt":"配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。","content":[{"tag":"p","content":["配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。"]},"\n",{"tag":"span","attrs":{"id":"more"},"content":[""]},"\n",{"tag":"h2","attrs":{"id":"配置"},"content":["配置"]},"\n",{"tag":"p","content":["在站点配置文件中增加以下内容："]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs nginx"},"content":[{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Cloudflare (IPv4 - https://www.cloudflare.com/ips-v4)"]},"\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["173.245.48.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["20"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["103.21.244.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["22"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["103.22.200.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["22"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["103.31.4.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["22"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["141.101.64.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["18"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["108.162.192.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["18"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["190.93.240.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["20"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["188.114.96.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["20"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["197.234.240.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["22"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["198.41.128.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["17"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["162.158.0.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["15"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["104.16.0.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["12"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["172.64.0.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["13"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["131.0.72.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["22"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["36.27.212.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["24"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["123.129.232.0"]},"/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["24"]},";\n\n",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Cloudflare (IPv6 - https://www.cloudflare.com/ips-v6)"]},"\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2400"]},":cb00::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2405"]},":",{"tag":"span","attrs":{"class":"hljs-number"},"content":["8100"]},"::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2405"]},":b500::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2606"]},":",{"tag":"span","attrs":{"class":"hljs-number"},"content":["4700"]},"::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2803"]},":f800::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," 2c0f:f248::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["32"]},";\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," 2a06:98c0::/",{"tag":"span","attrs":{"class":"hljs-number"},"content":["29"]},";\n\n",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# Others"]},"\n",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["deny"]}," all;"]}]},"\n",{"tag":"h2","attrs":{"id":"后记-3"},"content":["后记"]},"\n",{"tag":"p","content":["这个配置文件可以自己生成。"]},"\n",{"tag":"h2","attrs":{"id":"参考资料-8"},"content":["参考资料"]},"\n",{"tag":"ol","content":["\n",{"tag":"li","content":[{"tag":"a","attrs":{"href":"https://www.cloudflare.com/ips/","rel":"external nofollow noreferrer"},"content":["Cloudflare IP Ranges (Last updated: February 21, 2019)"]}]},"\n"]},"\n"],"thumb":null,"date":"2020-08-18","updated":"2020-08-18","isoDate":"2020-08-18T05:32:04.000Z","isoUpdate":"2020-08-18T05:32:04.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"笔记本","url":"/tags/%E7%AC%94%E8%AE%B0%E6%9C%AC/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/","url":"/post/nginx-cloudflare-ip-only/","prev":{"title":"给腾讯云服务器免费增加第二个 IP","url":"/post/tencent-cloud-cvm-dual-ip/"},"next":{"title":"在 VMware 上安装 macOS 11 Big Sur Beta","url":"/post/vmware-macos-bigsur/"},"toc":{"1":{"text":"配置","id":"配置"},"2":{"text":"后记","id":"后记-3"},"3":{"text":"参考资料","id":"参考资料-8"}},"hasToc":true,"comments":true,"wordCount":"213 字"},"__post":true},"__N_SSG":true}