{"pageProps":{"title":"你好，2021 —— 博客迁移记录 - 宝硕博客","post":{"title":"你好，2021 —— 博客迁移记录","excerpt":"再见，2020。","content":[{"tag":"p","content":["再见，2020。"]},"\n",{"tag":"span","attrs":{"id":"more"},"content":[""]},"\n",{"tag":"p","content":["最近总是觉得博客太慢了，于是乎，我把博客迁移到自己的服务器上面了。"]},"\n",{"tag":"h2","attrs":{"id":"服务器端操作"},"content":["服务器端操作"]},"\n",{"tag":"h3","attrs":{"id":"安装-nginx"},"content":["安装 nginx"]},"\n",{"tag":"p","content":["apt 一把梭，省时又省力。"]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs shell"},"content":["apt install nginx -y"]}]},"\n",{"tag":"h3","attrs":{"id":"配置-nginx"},"content":["配置 nginx"]},"\n",{"tag":"p","content":["简简单单配置了一下，没有什么过于复杂的东西。"]},"\n",{"tag":"p","content":["在申请 SSL 证书之前，不要写 HTTPS 的配置。"]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs nginx"},"content":[{"tag":"span","attrs":{"class":"hljs-section"},"content":["server"]}," &#123;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"      ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["80"]},";\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"      [::]:",{"tag":"span","attrs":{"class":"hljs-number"},"content":["80"]},";\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["server_name"]}," blog.baoshuo.ren;\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# ACME-challenge"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-section"},"content":["location"]},{"tag":"span","attrs":{"class":"hljs-regexp"},"content":[" ^~"]}," /.well-known/acme-challenge/ &#123;\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["allow"]}," all;\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["root"]}," /var/www/_letsencrypt;\n    &#125;\n\n    ",{"tag":"span","attrs":{"class":"hljs-section"},"content":["location"]}," / &#123;\n        ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["return"]}," ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["301"]}," https://blog.baoshuo.ren",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$request_uri"]},";\n    &#125;\n&#125;"]}]},"\n",{"tag":"h3","attrs":{"id":"申请-ssl-证书"},"content":["申请 SSL 证书"]},"\n",{"tag":"p","content":["由于笔者懒得每年换证书，所以就用了 ",{"tag":"a","attrs":{"href":"https://letsencrypt.org/","rel":"external nofollow noreferrer"},"content":["Let’s Encrypt"]}," + ",{"tag":"a","attrs":{"href":"https://acme.sh","rel":"external nofollow noreferrer"},"content":["acme.sh"]}," 的组合套装来配置 SSL 。\n当然，ECC 证书也是少不了的。"]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs bash"},"content":["acme.sh --issue -d baoshuo.ren -d www.baoshuo.ren -d blog.baoshuo.ren \\\n    -w /var/www/_letsencrypt/ \\\n    --renew-hook ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;acme.sh --install-cert -d baoshuo.ren \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --key-file /***/baoshuo.ren.key \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --fullchain-file /***/baoshuo.ren.cer \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --reloadcmd \\&quot;service nginx force-reload\\&quot;&quot;"]},"\nacme.sh --issue --keylength ec-256 \\\n    -d baoshuo.ren -d www.baoshuo.ren -d blog.baoshuo.ren \\\n    -w /var/www/_letsencrypt/ \\\n    --renew-hook ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;acme.sh --install-cert -d baoshuo.ren --ecc \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --key-file /***/baoshuo.ren.ecc.key \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --fullchain-file /***/baoshuo.ren.ecc.cer \\"]},"\n",{"tag":"span","attrs":{"class":"hljs-string"},"content":["    --reloadcmd \\&quot;service nginx force-reload\\&quot;&quot;"]}]}]},"\n",{"tag":"p","content":["申请完成后，将 RSA 和 ECC 证书添加到 nginx 配置中，在配置文件中写入以下内容："]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs nginx"},"content":[{"tag":"span","attrs":{"class":"hljs-section"},"content":["server"]}," &#123;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"                               ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["443"]}," ssl http2;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["listen"]},"                               [::]:",{"tag":"span","attrs":{"class":"hljs-number"},"content":["443"]}," ssl http2;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["server_name"]},"                          blog.baoshuo.ren;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["root"]},"                                 /var/www/blog/;\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# SSL"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_certificate"]},"                      /***/baoshuo.ren.cer;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_certificate_key"]},"                  /***/baoshuo.ren.key;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_certificate"]},"                      /***/baoshuo.ren.ecc.cer;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_certificate_key"]},"                  /***/baoshuo.ren.ecc.key;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_protocols"]},"                        TLSv1.",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2"]}," TLSv1.",{"tag":"span","attrs":{"class":"hljs-number"},"content":["3"]},";\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_ciphers"]},"                          ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["ssl_prefer_server_ciphers"]}," ",{"tag":"span","attrs":{"class":"hljs-literal"},"content":["off"]},";\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# HSTS"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["add_header"]}," Strict-Transport-Security ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;max-age=31536000&#x27;"]},";\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# logging"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["error_log"]},"                            /var/log/nginx/blog.baoshuo.ren.",{"tag":"span","attrs":{"class":"hljs-literal"},"content":["error"]},".log ",{"tag":"span","attrs":{"class":"hljs-literal"},"content":["warn"]},";\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["# 404 page"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attribute"},"content":["error_page"]},"                           ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["404"]}," /",{"tag":"span","attrs":{"class":"hljs-number"},"content":["404"]},".html;\n&#125;"]}]},"\n",{"tag":"p","content":["上方使用的 SSL 配置是 Mozilla 推荐的现代化配置 ，如果需要更好的兼容性，可以使用 Mozilla 提供的中等安全性配置 ："]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs ruby"},"content":["ssl_protocols TLSv1 TLSv1.",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]}," TLSv1.",{"tag":"span","attrs":{"class":"hljs-number"},"content":["2"]}," TLSv1.",{"tag":"span","attrs":{"class":"hljs-number"},"content":["3"]},";\nssl_ciphers ",{"tag":"span","attrs":{"class":"hljs-variable constant_"},"content":["ECDHE"]},"-",{"tag":"span","attrs":{"class":"hljs-variable constant_"},"content":["ECDSA"]},"-",{"tag":"span","attrs":{"class":"hljs-variable constant_"},"content":["AES128"]},"-",{"tag":"span","attrs":{"class":"hljs-variable constant_"},"content":["GCM"]},"-",{"tag":"span","attrs":{"class":"hljs-variable constant_"},"content":["SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES128-GCM-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-AES256-GCM-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES256-GCM-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-CHACHA20-POLY1305"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-CHACHA20-POLY1305"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DHE-RSA-AES128-GCM-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DHE-RSA-AES256-GCM-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DHE-RSA-CHACHA20-POLY1305"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-AES128-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES128-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-AES128-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES128-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-AES256-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES256-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-ECDSA-AES256-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":ECDHE-RSA-AES256-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DHE-RSA-AES128-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DHE-RSA-AES256-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES128-GCM-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES256-GCM-SHA384"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES128-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES256-SHA256"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES128-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":AES256-SHA"]},{"tag":"span","attrs":{"class":"hljs-symbol"},"content":[":DES-CBC3-SHA"]},";\nssl_prefer_server_ciphers on;"]}]},"\n",{"tag":"h2","attrs":{"id":"将博客文件同步到服务器上"},"content":["将博客文件同步到服务器上"]},"\n",{"tag":"p","content":["在 ",{"tag":"code","content":[".github/workflows"]}," 目录下创建一个 ",{"tag":"code","content":["server.yml"]}," 文件，写入以下内容："]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs yaml"},"content":[{"tag":"span","attrs":{"class":"hljs-attr"},"content":["name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Deploy"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["blog"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["to"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Server"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["on:"]},"\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["push:"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["branches:"]}," [ ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["master"]}," ]\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["workflow_dispatch:"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["jobs:"]},"\n  ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["deploy:"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["runs-on:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["ubuntu-latest"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["steps:"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Checkout"]},"\n        ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["uses:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["actions/checkout@v2"]},"\n      ",{"tag":"span","attrs":{"class":"hljs-bullet"},"content":["-"]}," ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["name:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["Deploy"]},"\n        ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["uses:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["easingthemes/ssh-deploy@v2.1.5"]},"\n        ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["env:"]},"\n          ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["SSH_PRIVATE_KEY:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["$&#123;&#123;"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["secrets.SSH_PRIVATE_KEY"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#125;&#125;"]},"\n          ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["ARGS:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;-avz --delete  --exclude &#x27;.git/*&#x27; --exclude &#x27;.github/*&#x27; --exclude &#x27;.gitlab-ci.yml&#x27; --exclude &#x27;.nojekyll&#x27;&quot;"]},"\n          ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["REMOTE_HOST:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["$&#123;&#123;"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["secrets.REMOTE_HOST"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#125;&#125;"]},"\n          ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["REMOTE_USER:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["$&#123;&#123;"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["secrets.REMOTE_USER"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#125;&#125;"]},"\n          ",{"tag":"span","attrs":{"class":"hljs-attr"},"content":["TARGET:"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["$&#123;&#123;"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["secrets.TARGET"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#125;&#125;"]}]}]},"\n",{"tag":"p","content":["之后在 ",{"tag":"code","content":["https://github.com/&#123;username&#125;/&#123;repo&#125;/settings/secrets/actions"]}," 中添加四个 Secrets 。"]},"\n",{"tag":"table","content":["\n",{"tag":"thead","content":["\n",{"tag":"tr","content":["\n",{"tag":"th","content":["名称"]},"\n",{"tag":"th","content":["内容"]},"\n"]},"\n"]},"\n",{"tag":"tbody","content":["\n",{"tag":"tr","content":["\n",{"tag":"td","content":["REMOTE_HOST"]},"\n",{"tag":"td","content":["服务器 IP 地址"]},"\n"]},"\n",{"tag":"tr","content":["\n",{"tag":"td","content":["REMOTE_USER"]},"\n",{"tag":"td","content":["服务器用户名"]},"\n"]},"\n",{"tag":"tr","content":["\n",{"tag":"td","content":["SSH_PRIVATE_KEY"]},"\n",{"tag":"td","content":["连接到服务器的 SSH 私钥"]},"\n"]},"\n",{"tag":"tr","content":["\n",{"tag":"td","content":["TARGET"]},"\n",{"tag":"td","content":["存放文件的路径"]},"\n"]},"\n"]},"\n"]},"\n",{"tag":"p","content":["将博客文件 push 到仓库中，就能在服务器上查看到文件了。"]},"\n",{"tag":"h2","attrs":{"id":"参考资料-5"},"content":["参考资料"]},"\n",{"tag":"ol","content":["\n",{"tag":"li","content":[{"tag":"a","attrs":{"href":"https://ssl-config.mozilla.org/#server=nginx&amp;version=1.18.0&amp;config=modern&amp;openssl=1.1.1f&amp;ocsp=false&amp;guideline=5.6","rel":"external nofollow noreferrer"},"content":["nginx 1.18.0, modern config, OpenSSL 1.1.1f - Mozilla SSL Configuration Generator"]}]},"\n",{"tag":"li","content":[{"tag":"a","attrs":{"href":"https://ssl-config.mozilla.org/#server=nginx&amp;version=1.18.0&amp;config=intermediate&amp;openssl=1.1.1f&amp;ocsp=false&amp;guideline=5.6","rel":"external nofollow noreferrer"},"content":["nginx 1.18.0, intermediate config, OpenSSL 1.1.1f - Mozilla SSL Configuration Generator"]}]},"\n"]},"\n"],"thumb":null,"date":"2020-12-31","updated":"2020-12-31","isoDate":"2020-12-31T16:00:00.000Z","isoUpdate":"2020-12-31T16:00:00.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"折腾","url":"/tags/%E6%8A%98%E8%85%BE/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/hello-2021/","url":"/post/hello-2021/","prev":{"title":"Linux Systemd 入门","url":"/post/linux-systemd/"},"next":{"title":"NOIP 2020 游记","url":"/post/noip-2020/"},"toc":{"1":{"1":{"text":"安装 nginx","id":"安装-nginx"},"2":{"text":"配置 nginx","id":"配置-nginx"},"3":{"text":"申请 SSL 证书","id":"申请-ssl-证书"},"text":"服务器端操作","id":"服务器端操作"},"2":{"text":"将博客文件同步到服务器上","id":"将博客文件同步到服务器上"},"3":{"text":"参考资料","id":"参考资料-5"}},"hasToc":true,"comments":true,"wordCount":"796 字"},"__post":true},"__N_SSG":true}