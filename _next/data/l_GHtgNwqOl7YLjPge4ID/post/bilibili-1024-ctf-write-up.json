{"pageProps":{"title":"Bilibili 1024 节 CTF Write Up - 宝硕博客","post":{"title":"Bilibili 1024 节 CTF Write Up","excerpt":null,"content":[{"tag":"p","content":["比赛地址： ",{"tag":"a","attrs":{"href":"https://security.bilibili.com/sec1024/","rel":"external nofollow noreferrer"},"content":["https://security.bilibili.com/sec1024/"]}]},"\n",{"tag":"h2","attrs":{"id":"t1：页面的背后是什么？"},"content":["T1：页面的背后是什么？"]},"\n",{"tag":"p","content":[{"tag":"s","content":["F12 解决一切问题"]}]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/XrLpIf2OHs4YAxJ.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"h2","attrs":{"id":"t2：真正的秘密只有特殊的设备才能看到"},"content":["T2：真正的秘密只有特殊的设备才能看到"]},"\n",{"tag":"p","content":["改下 UA 就行了，轻松到手"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/WPLCUHNYiE2nFwJ.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/83GrjFbTwJf1BHn.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"h2","attrs":{"id":"t3：密码是啥？"},"content":["T3：密码是啥？"]},"\n",{"tag":"p","content":["看了看源码，没啥思路，最后随便试了试 ",{"tag":"code","content":["admin"]}," ",{"tag":"code","content":["root"]}," ",{"tag":"code","content":["bilibili"]}," 什么的，竟然是对的。"]},"\n",{"tag":"ul","content":["\n",{"tag":"li","content":["用户名 ",{"tag":"code","content":["admin"]}]},"\n",{"tag":"li","content":["密码 ",{"tag":"code","content":["bilibili"]}]},"\n"]},"\n",{"tag":"p","content":["另外，你告诉我什么是 ",{"tag":"strong","content":["falg"]}," ？"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/eg9kBtR1aQizGYE.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"h2","attrs":{"id":"t4：对不起，权限不足～"},"content":["T4：对不起，权限不足～"]},"\n",{"tag":"p","content":["第一次访问："]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/roVjXTfs4v8ibP5.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["第二次访问："]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/RpEsGn8c9KY16MH.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["查看源码可以发现有个 API 请求，查看请求数据得到以下信息。"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/nhF7pCTQsVYxKdj.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["role 里面的东西，贴进谷歌一搜就知道它是 ",{"tag":"code","content":["user"]}," 的 MD5 。"]},"\n",{"tag":"p","content":["和超级管理员相关的名字相信大家都知道，无非就是 ",{"tag":"code","content":["admin"]}," ",{"tag":"code","content":["Administrator"]}," ",{"tag":"code","content":["root"]}," 之类的东西。"]},"\n",{"tag":"p","content":["挨个试，最后发现 ",{"tag":"code","content":["Administrator"]}," 是正确的。"]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs shell"},"content":["curl &quot;http://45.113.201.36/api/ctf/4&quot; --cookie &quot;role=7b7bc2512ee1fedcd76bdc68926d4f7b; session=***;&quot;"]}]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/gEhkmTJrnaoMwPv.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"h2","attrs":{"id":"t5：别人的秘密"},"content":["T5：别人的秘密"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/c4BjYs3nVuCpxmH.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["发现有个 API，还有个 UID。"]},"\n",{"tag":"p","content":["最开始没想到需要从代码里面的&quot;初始 UID&quot;开始扫，浪费了我好多时间。"]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs shell"},"content":["for ((i=100336889;$i&lt;9999999999;i=($i+1))); do echo -e &quot;[$i] \\c&quot; &amp;&amp; curl &quot;http://45.113.201.36/api/ctf/5?uid=$&#123;i&#125;&quot; -H &#x27;User-Agent: bilibili Security Browser&#x27; -H &#x27;Cookie: session=*****; role=ee11cbb19052e40b07aac0ca060c23ee&#x27; ; done"]}]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/m1Hr4u8FOJe7ycI.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"h2","attrs":{"id":"t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～"},"content":["T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～"]},"\n",{"tag":"p","content":["先扫了扫端口，发现有个 redis"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/E29tLxSiC6Qzn5O.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs shell"},"content":["redis-cli -h 120.92.151.189 -p 6379"]}]},"\n",{"tag":"p","content":["登上去看看，发现了第八题的 flag 。"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/Oo5vyeEsChmSt2H.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["然后爆破下目录"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/QEnxZsg8FpiOKwm.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["有个 test.php ，访问下发现是个 JSfuck 加密，丢进浏览器里面解密下"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/G7TWPndrhqBmvAI.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["程序员最多的地方，那就肯定是 Github 了。"]},"\n",{"tag":"p","content":["然后找到了一个仓库 ",{"tag":"a","attrs":{"href":"https://github.com/interesting-1024/end","rel":"external nofollow noreferrer"},"content":["interesting-1024/end"]}]},"\n",{"tag":"p","content":["有个 ",{"tag":"code","content":["end.php"]}]},"\n",{"tag":"pre","content":[{"tag":"code","attrs":{"class":"hljs php"},"content":[{"tag":"span","attrs":{"class":"hljs-meta"},"content":["&lt;?php"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["//filename end.php"]},"\n\n",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$bilibili"]}," = ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;bilibili1024havefun&quot;"]},";\n\n",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$str"]}," = ",{"tag":"span","attrs":{"class":"hljs-title function_ invoke__"},"content":["intval"]},"(",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$_GET"]},"[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;id&#x27;"]},"]);\n",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$reg"]}," = ",{"tag":"span","attrs":{"class":"hljs-title function_ invoke__"},"content":["preg_match"]},"(",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;/\\d/is&#x27;"]},", ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$_GET"]},"[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;id&#x27;"]},"]);\n\n",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["if"]},"(!",{"tag":"span","attrs":{"class":"hljs-title function_ invoke__"},"content":["is_numeric"]},"(",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$_GET"]},"[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;id&#x27;"]},"]) ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["and"]}," ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$reg"]}," !== ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]}," ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["and"]}," ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$str"]}," === ",{"tag":"span","attrs":{"class":"hljs-number"},"content":["1"]},")&#123;\n    ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$content"]}," = ",{"tag":"span","attrs":{"class":"hljs-title function_ invoke__"},"content":["file_get_contents"]},"(",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$_GET"]},"[",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&#x27;url&#x27;"]},"]);\n\n    ",{"tag":"span","attrs":{"class":"hljs-comment"},"content":["//文件路径猜解"]},"\n    ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["if"]}," (",{"tag":"span","attrs":{"class":"hljs-literal"},"content":["false"]},")&#123;\n        ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["echo"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;还差一点点啦～&quot;"]},";\n    &#125;",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["else"]},"&#123;\n        ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["echo"]}," ",{"tag":"span","attrs":{"class":"hljs-variable"},"content":["$flag"]},";\n    &#125;\n&#125;",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["else"]},"&#123;\n    ",{"tag":"span","attrs":{"class":"hljs-keyword"},"content":["echo"]}," ",{"tag":"span","attrs":{"class":"hljs-string"},"content":["&quot;你想要的不在这儿～&quot;"]},";\n&#125;\n",{"tag":"span","attrs":{"class":"hljs-meta"},"content":["?&gt;"]}]}]},"\n",{"tag":"p","content":["然后需要构造出一个 符合 ",{"tag":"code","content":["!is_numeric($_GET['id']) and preg_match('/\\d/is', $_GET['id']) !== 1 and intval($_GET['id']) === 1"]}," 的请求即可。"]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/mCIevr1HSMBpkdi.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["可以得到一个图片的链接 ",{"tag":"code","content":["http://45.113.201.36/blog/imgs/bilibili_224a634752448def6c0ec064e49fe797_havefun.jpg"]}]},"\n",{"tag":"p","content":[{"tag":"img","attrs":{"src":"https://s1.baoshuo.ren/2020/11/28/iXEgYzjPtH2NhQw.png","alt":"","loading":"lazy"},"content":[""]}]},"\n",{"tag":"p","content":["这个图片的末尾就是第十个 flag 了（图中标蓝的地方）。"]},"\n"],"thumb":"https://s1.baoshuo.ren/2020/12/01/cZoPxLHXlkFSjrt.jpg","date":"2020-10-26","updated":"2020-10-26","isoDate":"2020-10-26T10:02:08.000Z","isoUpdate":"2020-10-26T10:02:08.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"CTF","url":"/tags/CTF/"},{"name":"Bilibili","url":"/tags/Bilibili/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/bilibili-1024-ctf-write-up/","url":"/post/bilibili-1024-ctf-write-up/","prev":{"title":"USTC Hackergame 2020 Write Up","url":"/post/ustc-hackergame-2020-write-up/"},"next":{"title":"使用树莓派+Nginx搭建 Rtmp 直播服务","url":"/post/raspberry-pi-rtmp-live/"},"toc":{"1":{"text":"T1：页面的背后是什么？","id":"t1：页面的背后是什么？"},"2":{"text":"T2：真正的秘密只有特殊的设备才能看到","id":"t2：真正的秘密只有特殊的设备才能看到"},"3":{"text":"T3：密码是啥？","id":"t3：密码是啥？"},"4":{"text":"T4：对不起，权限不足～","id":"t4：对不起，权限不足～"},"5":{"text":"T5：别人的秘密","id":"t5：别人的秘密"},"6":{"text":"T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～","id":"t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～"}},"hasToc":true,"comments":true,"wordCount":"592 字"},"__post":true},"__N_SSG":true}