{"pageProps":{"title":"配置 nginx 只允许 Cloudflare 的 IP 回源 - 宝硕博客","post":{"title":"配置 nginx 只允许 Cloudflare 的 IP 回源","date":"2020-08-18T13:32:04.000Z","updated":"2020-08-18T13:32:04.000Z","type":"post","excerpt":"配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。\n","thumb":null,"tags":["笔记本"],"categories":["技术向"],"content":"<p>配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。</p>\n\n<h2 id=配置><a class=anchor href=#配置 target=_blank></a>配置</h2>\n<p>在站点配置文件中增加以下内容：</p>\n<pre><code class=\"hljs language-nginx\"><span class=hljs-comment># Cloudflare (IPv4 - https://www.cloudflare.com/ips-v4)</span>\n<span class=hljs-attribute>allow</span> <span class=hljs-number>173.245.48.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.21.244.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.22.200.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.31.4.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>141.101.64.0</span>/<span class=hljs-number>18</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>108.162.192.0</span>/<span class=hljs-number>18</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>190.93.240.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>188.114.96.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>197.234.240.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>198.41.128.0</span>/<span class=hljs-number>17</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>162.158.0.0</span>/<span class=hljs-number>15</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>104.16.0.0</span>/<span class=hljs-number>12</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>172.64.0.0</span>/<span class=hljs-number>13</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>131.0.72.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>36.27.212.0</span>/<span class=hljs-number>24</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>123.129.232.0</span>/<span class=hljs-number>24</span>;\n\n<span class=hljs-comment># Cloudflare (IPv6 - https://www.cloudflare.com/ips-v6)</span>\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2400</span>:cb00::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2405</span>:<span class=hljs-number>8100</span>::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2405</span>:b500::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2606</span>:<span class=hljs-number>4700</span>::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2803</span>:f800::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> 2c0f:f248::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> 2a06:98c0::/<span class=hljs-number>29</span>;\n\n<span class=hljs-comment># Others</span>\n<span class=hljs-attribute>deny</span> all;\n</code></pre>\n<h2 id=后记><a class=anchor href=#后记 target=_blank></a>后记</h2>\n<p>这个配置文件可以自己生成。</p>\n<h2 id=参考资料><a class=anchor href=#参考资料 target=_blank></a>参考资料</h2>\n<ol>\n<li><a href=https://www.cloudflare.com/ips/ target=_blank>Cloudflare IP Ranges (Last updated: February 21, 2019)</a></li>\n</ol>\n","katex":false,"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E8%AE%B0\"><span class=\"toc-text\">后记</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\"><span class=\"toc-text\">参考资料</span></a></li></ol>","comment":true,"path":"/post/nginx-cloudflare-ip-only/","url":"https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/"},"__post":true},"__N_SSG":true}