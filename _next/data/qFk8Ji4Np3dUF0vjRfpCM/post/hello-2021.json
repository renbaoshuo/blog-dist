{"pageProps":{"title":"你好，2021 —— 博客迁移记录 - 宝硕博客","post":{"title":"你好，2021 —— 博客迁移记录","excerpt":"再见，2020。","content":[["$","p",{},["再见，2020。"]],["$","span",{"id":"more"},[]],["$","p",{},["最近总是觉得博客太慢了，于是乎，我把博客迁移到自己的服务器上面了。"]],["$","h2",{"id":"服务器端操作"},["服务器端操作"]],["$","h3",{"id":"安装-nginx"},["安装 nginx"]],["$","p",{},["apt 一把梭，省时又省力。"]],["$","pre",{},[["$","code",{"class":"hljs shell"},["apt install nginx -y"]]]],["$","h3",{"id":"配置-nginx"},["配置 nginx"]],["$","p",{},["简简单单配置了一下，没有什么过于复杂的东西。"]],["$","p",{},["在申请 SSL 证书之前，不要写 HTTPS 的配置。"]],["$","pre",{},[["$","code",{"class":"hljs nginx"},[["$","span",{"class":"hljs-section"},["server"]]," {\n    ",["$","span",{"class":"hljs-attribute"},["listen"]],"      ",["$","span",{"class":"hljs-number"},["80"]],";\n    ",["$","span",{"class":"hljs-attribute"},["listen"]],"      [::]:",["$","span",{"class":"hljs-number"},["80"]],";\n    ",["$","span",{"class":"hljs-attribute"},["server_name"]]," blog.baoshuo.ren;\n\n    ",["$","span",{"class":"hljs-comment"},["# ACME-challenge"]],"\n    ",["$","span",{"class":"hljs-section"},["location"]],["$","span",{"class":"hljs-regexp"},[" ^~"]]," /.well-known/acme-challenge/ {\n        ",["$","span",{"class":"hljs-attribute"},["allow"]]," all;\n        ",["$","span",{"class":"hljs-attribute"},["root"]]," /var/www/_letsencrypt;\n    }\n\n    ",["$","span",{"class":"hljs-section"},["location"]]," / {\n        ",["$","span",{"class":"hljs-attribute"},["return"]]," ",["$","span",{"class":"hljs-number"},["301"]]," https://blog.baoshuo.ren",["$","span",{"class":"hljs-variable"},["$request_uri"]],";\n    }\n}"]]]],["$","h3",{"id":"申请-ssl-证书"},["申请 SSL 证书"]],["$","p",{},["由于笔者懒得每年换证书，所以就用了 ",["$","a",{"href":"https://letsencrypt.org/","rel":"external nofollow noreferrer"},["Let’s Encrypt"]]," + ",["$","a",{"href":"https://acme.sh","rel":"external nofollow noreferrer"},["acme.sh"]]," 的组合套装来配置 SSL 。 当然，ECC 证书也是少不了的。"]],["$","pre",{},[["$","code",{"class":"hljs bash"},["acme.sh --issue -d baoshuo.ren -d www.baoshuo.ren -d blog.baoshuo.ren \\\n    -w /var/www/_letsencrypt/ \\\n    --renew-hook ",["$","span",{"class":"hljs-string"},["\"acme.sh --install-cert -d baoshuo.ren \\"]],"\n",["$","span",{"class":"hljs-string"},["    --key-file /***/baoshuo.ren.key \\"]],"\n",["$","span",{"class":"hljs-string"},["    --fullchain-file /***/baoshuo.ren.cer \\"]],"\n",["$","span",{"class":"hljs-string"},["    --reloadcmd \\\"service nginx force-reload\\\"\""]],"\nacme.sh --issue --keylength ec-256 \\\n    -d baoshuo.ren -d www.baoshuo.ren -d blog.baoshuo.ren \\\n    -w /var/www/_letsencrypt/ \\\n    --renew-hook ",["$","span",{"class":"hljs-string"},["\"acme.sh --install-cert -d baoshuo.ren --ecc \\"]],"\n",["$","span",{"class":"hljs-string"},["    --key-file /***/baoshuo.ren.ecc.key \\"]],"\n",["$","span",{"class":"hljs-string"},["    --fullchain-file /***/baoshuo.ren.ecc.cer \\"]],"\n",["$","span",{"class":"hljs-string"},["    --reloadcmd \\\"service nginx force-reload\\\"\""]]]]]],["$","p",{},["申请完成后，将 RSA 和 ECC 证书添加到 nginx 配置中，在配置文件中写入以下内容："]],["$","pre",{},[["$","code",{"class":"hljs nginx"},[["$","span",{"class":"hljs-section"},["server"]]," {\n    ",["$","span",{"class":"hljs-attribute"},["listen"]],"                               ",["$","span",{"class":"hljs-number"},["443"]]," ssl http2;\n    ",["$","span",{"class":"hljs-attribute"},["listen"]],"                               [::]:",["$","span",{"class":"hljs-number"},["443"]]," ssl http2;\n    ",["$","span",{"class":"hljs-attribute"},["server_name"]],"                          blog.baoshuo.ren;\n    ",["$","span",{"class":"hljs-attribute"},["root"]],"                                 /var/www/blog/;\n\n    ",["$","span",{"class":"hljs-comment"},["# SSL"]],"\n    ",["$","span",{"class":"hljs-attribute"},["ssl_certificate"]],"                      /***/baoshuo.ren.cer;\n    ",["$","span",{"class":"hljs-attribute"},["ssl_certificate_key"]],"                  /***/baoshuo.ren.key;\n    ",["$","span",{"class":"hljs-attribute"},["ssl_certificate"]],"                      /***/baoshuo.ren.ecc.cer;\n    ",["$","span",{"class":"hljs-attribute"},["ssl_certificate_key"]],"                  /***/baoshuo.ren.ecc.key;\n    ",["$","span",{"class":"hljs-attribute"},["ssl_protocols"]],"                        TLSv1.",["$","span",{"class":"hljs-number"},["2"]]," TLSv1.",["$","span",{"class":"hljs-number"},["3"]],";\n    ",["$","span",{"class":"hljs-attribute"},["ssl_ciphers"]],"                          ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n    ",["$","span",{"class":"hljs-attribute"},["ssl_prefer_server_ciphers"]]," ",["$","span",{"class":"hljs-literal"},["off"]],";\n\n    ",["$","span",{"class":"hljs-comment"},["# HSTS"]],"\n    ",["$","span",{"class":"hljs-attribute"},["add_header"]]," Strict-Transport-Security ",["$","span",{"class":"hljs-string"},["'max-age=31536000'"]],";\n\n    ",["$","span",{"class":"hljs-comment"},["# logging"]],"\n    ",["$","span",{"class":"hljs-attribute"},["error_log"]],"                            /var/log/nginx/blog.baoshuo.ren.",["$","span",{"class":"hljs-literal"},["error"]],".log ",["$","span",{"class":"hljs-literal"},["warn"]],";\n\n    ",["$","span",{"class":"hljs-comment"},["# 404 page"]],"\n    ",["$","span",{"class":"hljs-attribute"},["error_page"]],"                           ",["$","span",{"class":"hljs-number"},["404"]]," /",["$","span",{"class":"hljs-number"},["404"]],".html;\n}"]]]],["$","p",{},["上方使用的 SSL 配置是 Mozilla 推荐的现代化配置 ，如果需要更好的兼容性，可以使用 Mozilla 提供的中等安全性配置 ："]],["$","pre",{},[["$","code",{"class":"hljs ruby"},["ssl_protocols TLSv1 TLSv1.",["$","span",{"class":"hljs-number"},["1"]]," TLSv1.",["$","span",{"class":"hljs-number"},["2"]]," TLSv1.",["$","span",{"class":"hljs-number"},["3"]],";\nssl_ciphers ",["$","span",{"class":"hljs-variable constant_"},["ECDHE"]],"-",["$","span",{"class":"hljs-variable constant_"},["ECDSA"]],"-",["$","span",{"class":"hljs-variable constant_"},["AES128"]],"-",["$","span",{"class":"hljs-variable constant_"},["GCM"]],"-",["$","span",{"class":"hljs-variable constant_"},["SHA256"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES128-GCM-SHA256"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-AES256-GCM-SHA384"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES256-GCM-SHA384"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-CHACHA20-POLY1305"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-CHACHA20-POLY1305"]],["$","span",{"class":"hljs-symbol"},[":DHE-RSA-AES128-GCM-SHA256"]],["$","span",{"class":"hljs-symbol"},[":DHE-RSA-AES256-GCM-SHA384"]],["$","span",{"class":"hljs-symbol"},[":DHE-RSA-CHACHA20-POLY1305"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-AES128-SHA256"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES128-SHA256"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-AES128-SHA"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES128-SHA"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-AES256-SHA384"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES256-SHA384"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-ECDSA-AES256-SHA"]],["$","span",{"class":"hljs-symbol"},[":ECDHE-RSA-AES256-SHA"]],["$","span",{"class":"hljs-symbol"},[":DHE-RSA-AES128-SHA256"]],["$","span",{"class":"hljs-symbol"},[":DHE-RSA-AES256-SHA256"]],["$","span",{"class":"hljs-symbol"},[":AES128-GCM-SHA256"]],["$","span",{"class":"hljs-symbol"},[":AES256-GCM-SHA384"]],["$","span",{"class":"hljs-symbol"},[":AES128-SHA256"]],["$","span",{"class":"hljs-symbol"},[":AES256-SHA256"]],["$","span",{"class":"hljs-symbol"},[":AES128-SHA"]],["$","span",{"class":"hljs-symbol"},[":AES256-SHA"]],["$","span",{"class":"hljs-symbol"},[":DES-CBC3-SHA"]],";\nssl_prefer_server_ciphers on;"]]]],["$","h2",{"id":"将博客文件同步到服务器上"},["将博客文件同步到服务器上"]],["$","p",{},["在 ",["$","code",{},[".github/workflows"]]," 目录下创建一个 ",["$","code",{},["server.yml"]]," 文件，写入以下内容："]],["$","pre",{},[["$","code",{"class":"hljs yaml"},[["$","span",{"class":"hljs-attr"},["name:"]]," ",["$","span",{"class":"hljs-string"},["Deploy"]]," ",["$","span",{"class":"hljs-string"},["blog"]]," ",["$","span",{"class":"hljs-string"},["to"]]," ",["$","span",{"class":"hljs-string"},["Server"]],"\n\n",["$","span",{"class":"hljs-attr"},["on:"]],"\n  ",["$","span",{"class":"hljs-attr"},["push:"]],"\n    ",["$","span",{"class":"hljs-attr"},["branches:"]]," [ ",["$","span",{"class":"hljs-string"},["master"]]," ]\n  ",["$","span",{"class":"hljs-attr"},["workflow_dispatch:"]],"\n\n",["$","span",{"class":"hljs-attr"},["jobs:"]],"\n  ",["$","span",{"class":"hljs-attr"},["deploy:"]],"\n    ",["$","span",{"class":"hljs-attr"},["runs-on:"]]," ",["$","span",{"class":"hljs-string"},["ubuntu-latest"]],"\n    ",["$","span",{"class":"hljs-attr"},["steps:"]],"\n      ",["$","span",{"class":"hljs-bullet"},["-"]]," ",["$","span",{"class":"hljs-attr"},["name:"]]," ",["$","span",{"class":"hljs-string"},["Checkout"]],"\n        ",["$","span",{"class":"hljs-attr"},["uses:"]]," ",["$","span",{"class":"hljs-string"},["actions/checkout@v2"]],"\n      ",["$","span",{"class":"hljs-bullet"},["-"]]," ",["$","span",{"class":"hljs-attr"},["name:"]]," ",["$","span",{"class":"hljs-string"},["Deploy"]],"\n        ",["$","span",{"class":"hljs-attr"},["uses:"]]," ",["$","span",{"class":"hljs-string"},["easingthemes/ssh-deploy@v2.1.5"]],"\n        ",["$","span",{"class":"hljs-attr"},["env:"]],"\n          ",["$","span",{"class":"hljs-attr"},["SSH_PRIVATE_KEY:"]]," ",["$","span",{"class":"hljs-string"},["${{"]]," ",["$","span",{"class":"hljs-string"},["secrets.SSH_PRIVATE_KEY"]]," ",["$","span",{"class":"hljs-string"},["}}"]],"\n          ",["$","span",{"class":"hljs-attr"},["ARGS:"]]," ",["$","span",{"class":"hljs-string"},["\"-avz --delete  --exclude '.git/*' --exclude '.github/*' --exclude '.gitlab-ci.yml' --exclude '.nojekyll'\""]],"\n          ",["$","span",{"class":"hljs-attr"},["REMOTE_HOST:"]]," ",["$","span",{"class":"hljs-string"},["${{"]]," ",["$","span",{"class":"hljs-string"},["secrets.REMOTE_HOST"]]," ",["$","span",{"class":"hljs-string"},["}}"]],"\n          ",["$","span",{"class":"hljs-attr"},["REMOTE_USER:"]]," ",["$","span",{"class":"hljs-string"},["${{"]]," ",["$","span",{"class":"hljs-string"},["secrets.REMOTE_USER"]]," ",["$","span",{"class":"hljs-string"},["}}"]],"\n          ",["$","span",{"class":"hljs-attr"},["TARGET:"]]," ",["$","span",{"class":"hljs-string"},["${{"]]," ",["$","span",{"class":"hljs-string"},["secrets.TARGET"]]," ",["$","span",{"class":"hljs-string"},["}}"]]]]]],["$","p",{},["之后在 ",["$","code",{},["https://github.com/{username}/{repo}/settings/secrets/actions"]]," 中添加四个 Secrets 。"]],["$","table",{},[["$","thead",{},[["$","tr",{},[["$","th",{},["名称"]],["$","th",{},["内容"]]]]]],["$","tbody",{},[["$","tr",{},[["$","td",{},["REMOTE_HOST"]],["$","td",{},["服务器 IP 地址"]]]],["$","tr",{},[["$","td",{},["REMOTE_USER"]],["$","td",{},["服务器用户名"]]]],["$","tr",{},[["$","td",{},["SSH_PRIVATE_KEY"]],["$","td",{},["连接到服务器的 SSH 私钥"]]]],["$","tr",{},[["$","td",{},["TARGET"]],["$","td",{},["存放文件的路径"]]]]]]]],["$","p",{},["将博客文件 push 到仓库中，就能在服务器上查看到文件了。"]],["$","h2",{"id":"参考资料-7"},["参考资料"]],["$","ol",{},[["$","li",{},[["$","a",{"href":"https://ssl-config.mozilla.org/#server=nginx&version=1.18.0&config=modern&openssl=1.1.1f&ocsp=false&guideline=5.6","rel":"external nofollow noreferrer"},["nginx 1.18.0, modern config, OpenSSL 1.1.1f - Mozilla SSL Configuration Generator"]]]],["$","li",{},[["$","a",{"href":"https://ssl-config.mozilla.org/#server=nginx&version=1.18.0&config=intermediate&openssl=1.1.1f&ocsp=false&guideline=5.6","rel":"external nofollow noreferrer"},["nginx 1.18.0, intermediate config, OpenSSL 1.1.1f - Mozilla SSL Configuration Generator"]]]]]]],"thumb":null,"date":"2020-12-31","updated":"2020-12-31","isoDate":"2020-12-31T16:00:00.000Z","isoUpdate":"2020-12-31T16:00:00.000Z","categories":[{"name":"分享境","url":"/categories/%E5%88%86%E4%BA%AB%E5%A2%83/"}],"tags":[{"name":"折腾","url":"/tags/%E6%8A%98%E8%85%BE/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/hello-2021/","url":"/post/hello-2021/","prev":{"title":"Linux Systemd 入门","url":"/post/linux-systemd/"},"next":{"title":"NOIP 2020 游记","url":"/post/noip-2020/"},"toc":{"0":{"0":{"text":"安装 nginx","id":"安装-nginx"},"1":{"text":"配置 nginx","id":"配置-nginx"},"2":{"text":"申请 SSL 证书","id":"申请-ssl-证书"},"text":"服务器端操作","id":"服务器端操作"},"1":{"text":"将博客文件同步到服务器上","id":"将博客文件同步到服务器上"},"2":{"text":"参考资料","id":"参考资料-7"}},"hasToc":true,"comments":true,"wordCount":"793 字"}},"__N_SSG":true}