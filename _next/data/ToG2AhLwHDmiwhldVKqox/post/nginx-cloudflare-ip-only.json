{"pageProps":{"title":"配置 Nginx 只允许 Cloudflare 的 IP 回源 - 宝硕博客","post":{"title":"配置 Nginx 只允许 Cloudflare 的 IP 回源","excerpt":"配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。","content":"<p>配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。</p><span id=more></span><h2 id=配置>配置</h2><p>在站点配置文件中增加以下内容：</p><pre><code class=\"hljs nginx\"><span class=hljs-comment># Cloudflare (IPv4 - https://www.cloudflare.com/ips-v4)</span>\n<span class=hljs-attribute>allow</span> <span class=hljs-number>173.245.48.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.21.244.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.22.200.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>103.31.4.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>141.101.64.0</span>/<span class=hljs-number>18</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>108.162.192.0</span>/<span class=hljs-number>18</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>190.93.240.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>188.114.96.0</span>/<span class=hljs-number>20</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>197.234.240.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>198.41.128.0</span>/<span class=hljs-number>17</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>162.158.0.0</span>/<span class=hljs-number>15</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>104.16.0.0</span>/<span class=hljs-number>12</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>172.64.0.0</span>/<span class=hljs-number>13</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>131.0.72.0</span>/<span class=hljs-number>22</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>36.27.212.0</span>/<span class=hljs-number>24</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>123.129.232.0</span>/<span class=hljs-number>24</span>;\n\n<span class=hljs-comment># Cloudflare (IPv6 - https://www.cloudflare.com/ips-v6)</span>\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2400</span>:cb00::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2405</span>:<span class=hljs-number>8100</span>::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2405</span>:b500::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2606</span>:<span class=hljs-number>4700</span>::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> <span class=hljs-number>2803</span>:f800::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> 2c0f:f248::/<span class=hljs-number>32</span>;\n<span class=hljs-attribute>allow</span> 2a06:98c0::/<span class=hljs-number>29</span>;\n\n<span class=hljs-comment># Others</span>\n<span class=hljs-attribute>deny</span> all;</code></pre><h2 id=后记-3>后记</h2><p>这个配置文件可以自己生成。</p><h2 id=参考资料-8>参考资料</h2><ol><li><a href=https://www.cloudflare.com/ips/ rel=\"external nofollow noreferrer\">Cloudflare IP Ranges (Last updated: February 21, 2019)</a></li></ol>","thumb":null,"date":"2020-08-18","updated":"2020-08-18","isoDate":"2020-08-18T05:32:04.000Z","isoUpdate":"2020-08-18T05:32:04.000Z","categories":[{"name":"技术向","url":"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"笔记本","url":"/tags/%E7%AC%94%E8%AE%B0%E6%9C%AC/"}],"license":null,"permalink":"https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/","url":"/post/nginx-cloudflare-ip-only/","prev":{"title":"给腾讯云服务器免费增加第二个 IP","url":"/post/tencent-cloud-cvm-dual-ip/"},"next":{"title":"在 VMware 上安装 macOS 11 Big Sur Beta","url":"/post/vmware-macos-bigsur/"},"toc":{"1":{"text":"配置","id":"配置"},"2":{"text":"后记","id":"后记-3"},"3":{"text":"参考资料","id":"参考资料-8"}},"hasToc":true,"comments":true,"wordCount":"213 字"},"__post":true},"__N_SSG":true}