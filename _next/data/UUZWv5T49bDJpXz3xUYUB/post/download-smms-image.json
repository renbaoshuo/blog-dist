{"pageProps":{"title":"【随笔】下载自己在 SM.MS 图床上的所有图片 - 宝硕博客","post":{"title":"【随笔】下载自己在 SM.MS 图床上的所有图片","date":"2020-11-28T21:39:32.000Z","updated":"2020-11-28T21:39:32.000Z","type":"post","excerpt":"","thumb":null,"tags":[],"categories":["笔记本"],"content":"<p>前提条件：有 <a href=http://SM.MS target=_blank>SM.MS</a> 图床账号，并且图片存储在该账号下。</p>\n<p>思路：先请求 API，获取图片列表。遍历列表，判断本地是否存在该图片，若不存在则下载该图片。</p>\n<p>代码如下。</p>\n<pre><code class=\"hljs language-python\"><span class=hljs-keyword>import</span> requests\n<span class=hljs-keyword>import</span> os\n<span class=hljs-keyword>import</span> json\n<span class=hljs-keyword>import</span> pathlib\n<span class=hljs-keyword>import</span> sys\n\n<span class=hljs-keyword>def</span> <span class=\"hljs-title function_\">getUploadedImages</span>(<span class=hljs-params>token</span>) -&gt; <span class=hljs-built_in>str</span>:\n    url = <span class=hljs-string>&quot;https://sm.ms/api/v2/upload_history&quot;</span>\n    headers = {<span class=hljs-string>&quot;Authorization&quot;</span>: token}\n    <span class=hljs-keyword>return</span> requests.get(url, headers=headers).text\n\ndata = json.loads(getUploadedImages(sys.argv[<span class=hljs-number>1</span>]))\n\n<span class=hljs-keyword>for</span> img <span class=hljs-keyword>in</span> data[<span class=hljs-string>&quot;data&quot;</span>]:\n    path = <span class=hljs-string>&quot;./data/&quot;</span> + img[<span class=hljs-string>&quot;storename&quot;</span>]\n    <span class=hljs-keyword>if</span> <span class=hljs-keyword>not</span> pathlib.Path(path).is_file():\n        pic = requests.get(img[<span class=hljs-string>&quot;url&quot;</span>]).content\n        f = <span class=hljs-built_in>open</span>(path, <span class=hljs-string>&quot;wb&quot;</span>)\n        f.write(pic)\n        f.close()\n        <span class=hljs-keyword>del</span> pic\n        <span class=hljs-built_in>print</span>(<span class=hljs-string>&quot;Successfully get &quot;</span>+img[<span class=hljs-string>&quot;storename&quot;</span>]+<span class=hljs-string>&quot; .&quot;</span>)\n    <span class=hljs-keyword>else</span>:\n        <span class=hljs-built_in>print</span>(<span class=hljs-string>&quot;&quot;</span>+img[<span class=hljs-string>&quot;storename&quot;</span>]+<span class=hljs-string>&quot; is already exists.&quot;</span>)\n</code></pre>\n<p>使用方法：<code>python3 smms-image.py &quot;[your token here]&quot;</code></p>\n<p>下载下来的图片会存到 <code>./data/</code> 目录下（请提前新建）。</p>\n","katex":false,"toc":"","path":"/post/download-smms-image/","url":"https://blog.baoshuo.ren/post/download-smms-image/"},"__post":true},"__N_SSG":true}