{"pageProps":{"title":"给腾讯云服务器免费增加第二个 IP - 宝硕博客","post":{"title":"给腾讯云服务器免费增加第二个 IP","date":"2020-08-20T13:22:47.000Z","updated":"2020-08-20T13:22:47.000Z","type":"post","excerpt":"前言\n良心云果然是良心云，增加了一个 IP 四舍五入居然不要钱，不过还是要登进系统配置一下双 IP 的。\n","thumb":null,"tags":["腾讯云"],"categories":["笔记本"],"content":"<h2 id=前言><a class=anchor href=#前言 target=_blank></a>前言</h2>\n<p>良心云果然是良心云，增加了一个 IP 四舍五入居然不要钱，不过还是要登进系统配置一下双 IP 的。</p>\n\n<p><img src=https://s1.baoshuo.ren/2020/11/26/rAyvBmDw2bdMP6t.jpg alt=\"\"></p>\n<p>和客服的对话</p>\n<h2 id=增加网卡-公网-ip><a class=anchor href=#增加网卡-公网-ip target=_blank></a>增加网卡&amp;公网 IP</h2>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/SWwlbLRaHACnuBz.png alt=\"\"></p>\n<p>点击按钮新建一个弹性网卡并绑定</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/sJqBfdbv4eRzZFm.png alt=\"\"></p>\n<p>绑定完以后可以在服务器的弹性网卡管理页面看到详情</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/ivPFgfH69XTCo8Z.png alt=\"\"></p>\n<p>点击新建的弹性网卡，进入管理页面，并记录下这张网卡的<strong>内网 IP</strong>，稍后会用到</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/FAy8U5lpzNtuMTi.png alt=\"\"></p>\n<p>点击绑定按钮，并申请一个弹性公网 IP</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/AbZ4vTwr1UCdz2n.png alt=\"\">\n<img src=https://s1.baoshuo.ren/2020/11/26/2G5jsdTSZrocqwh.png alt=\"\"></p>\n<p>此时弹性公网 IP 已经绑定成功，并且可以看到已经变为不收取 IP 资源费的状态了</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/x8q7I5E2dMSDt4B.png alt=\"\"></p>\n<p>查看主网卡的<strong>内网 IP</strong>，并记录下这个 IP，稍后会用到</p>\n<h2 id=配置服务器的网络设置><a class=anchor href=#配置服务器的网络设置 target=_blank></a>配置服务器的网络设置</h2>\n<p>使用 <code>ip addr</code> 查看网卡名称，并记录下来</p>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/Ofh8CzvnYKPGsH7.png alt=\"\"></p>\n<p>切换到网卡配置文件目录</p>\n<pre><code class=\"hljs language-bash\"><span class=hljs-built_in>cd</span> /etc/sysconfig/network-scripts/\n</code></pre>\n<p>编辑 <code>ifcfg-eth0</code> 文件，将下方内容修改后填入</p>\n<pre><code class=hljs><span class=hljs-attr>DEVICE</span>=<span class=hljs-string>&quot;eth0&quot;</span>             <span class=hljs-comment># 弹性网卡名称</span>\n<span class=hljs-attr>NM_CONTROLLED</span>=<span class=hljs-string>&quot;yes&quot;</span>       <span class=hljs-comment># 是否由 Network Manager 控制该网络接口</span>\n<span class=hljs-attr>ONBOOT</span>=<span class=hljs-string>&quot;yes&quot;</span>              <span class=hljs-comment># 系统启动时是否激活</span>\n<span class=hljs-attr>IPADDR</span>=<span class=hljs-string>&quot;172.21.0.10&quot;</span>      <span class=hljs-comment># 弹性网卡上的 IP 地址</span>\n<span class=hljs-attr>NETMASK</span>=<span class=hljs-string>&quot;255.255.240.0&quot;</span>   <span class=hljs-comment># 子网掩码</span>\n<span class=hljs-attr>GATEWAY</span>=<span class=hljs-string>&quot;172.21.0.1&quot;</span>      <span class=hljs-comment># 网关</span>\n</code></pre>\n<ul>\n<li>其中 <code>IPADDR</code> 填写主网卡的<strong>内网 IP</strong>。</li>\n<li>子网掩码可以使用 <a href=https://www.v2ex.com/tools/ipv4 target=_blank>V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>\n<li>网关根据创建网卡时选择的子网而定。</li>\n</ul>\n<p>新建 <code>ifcfg-eth1</code> 文件，将下方内容修改后填入</p>\n<pre><code class=hljs><span class=hljs-attr>DEVICE</span>=<span class=hljs-string>&quot;eth1&quot;</span>             <span class=hljs-comment># 需配置的弹性网卡名称（此处是新添加的网卡名称）</span>\n<span class=hljs-attr>NM_CONTROLLED</span>=<span class=hljs-string>&quot;yes&quot;</span>       <span class=hljs-comment># 是否由 Network Manager 控制该网络接口</span>\n<span class=hljs-attr>ONBOOT</span>=<span class=hljs-string>&quot;yes&quot;</span>              <span class=hljs-comment># 系统启动时是否激活</span>\n<span class=hljs-attr>IPADDR</span>=<span class=hljs-string>&quot;172.21.0.12&quot;</span>      <span class=hljs-comment># 弹性网卡上的 IP 地址</span>\n<span class=hljs-attr>NETMASK</span>=<span class=hljs-string>&quot;255.255.240.0&quot;</span>   <span class=hljs-comment># 子网掩码</span>\n<span class=hljs-comment># GATEWAY=&quot;172.21.0.1&quot;    # 网关（若与eth0的网关不同，需要删除注释并修改为正确的网关）</span>\n</code></pre>\n<ul>\n<li>其中 <code>IPADDR</code> 填写新添加网卡的<strong>内网 IP</strong>。</li>\n<li>子网掩码可以 <a href=https://www.v2ex.com/tools/ipv4 target=_blank>V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>\n<li>网关根据创建网卡时选择的子网而定。</li>\n</ul>\n<p>保存后重启网络服务。</p>\n<pre><code class=\"hljs language-bash\">service network restart\n</code></pre>\n<p><img src=https://s1.baoshuo.ren/2020/11/26/ReBSM4C9oF2HbVi.png alt=\"\"></p>\n<h2 id=配置路由（可选）><a class=anchor href=#配置路由（可选） target=_blank></a>配置路由（可选）</h2>\n<blockquote>\n<p>按照上述步骤配置好后，Linux 还是默认都从主网卡发包。\n您可通过策略路由让报文从哪个网卡进，并从该网卡返回。</p>\n</blockquote>\n<h3 id=创建路由表><a class=anchor href=#创建路由表 target=_blank></a>创建路由表</h3>\n<pre><code class=\"hljs language-bash\"><span class=hljs-built_in>echo</span> <span class=hljs-string>&quot;10 t1&quot;</span> &gt;&gt; /etc/iproute2/rt_tables\n<span class=hljs-built_in>echo</span> <span class=hljs-string>&quot;20 t2&quot;</span> &gt;&gt; /etc/iproute2/rt_tables\n</code></pre>\n<h3 id=添加默认路由><a class=anchor href=#添加默认路由 target=_blank></a>添加默认路由</h3>\n<pre><code class=\"hljs language-bash\">ip route add default dev eth0 via 172.21.0.1 table 10\nip route add default dev eth1 via 172.21.0.1 table 20\n</code></pre>\n<blockquote>\n<p>上述两个命令中，172.21.0.1 要分别替换成主网卡所属子网的网关，以及辅助网卡所属子网的网关。</p>\n</blockquote>\n<h3 id=配置策略路由><a class=anchor href=#配置策略路由 target=_blank></a>配置策略路由</h3>\n<pre><code class=\"hljs language-bash\">ip rule add from 172.21.0.10 table 10\nip rule add from 172.21.0.12 table 20\n</code></pre>\n","katex":false,"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A2%9E%E5%8A%A0%E7%BD%91%E5%8D%A1-%E5%85%AC%E7%BD%91-ip\"><span class=\"toc-text\">增加网卡&amp;公网 IP</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">配置服务器的网络设置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89\"><span class=\"toc-text\">配置路由（可选）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%E8%A1%A8\"><span class=\"toc-text\">创建路由表</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1\"><span class=\"toc-text\">添加默认路由</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1\"><span class=\"toc-text\">配置策略路由</span></a></li></ol></li></ol>","path":"/post/tencent-cloud-cvm-dual-ip/","url":"https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/"},"__post":true},"__N_SSG":true}